generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  }

model UserUsage {
  id                 String    @id @default(cuid())
  userId             String    @unique
  tokensUsedMonthly  Int       @default(0)
  tokensUsedDaily    Int       @default(0)
  requestsThisMinute Int       @default(0)
  requestsThisHour   Int       @default(0)
  voiceMinutesUsed   Float     @default(0)
  studioCreditsUsed  Int       @default(0)
  monthlyResetAt     DateTime
  dailyResetAt       DateTime
  minuteResetAt      DateTime
  hourResetAt        DateTime
  lastRequestAt      DateTime  @default(now())
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  extensionShownAt   DateTime?
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model User {
  id                          String                      @id @default(uuid())
  email                       String                      @unique
  password                    String?
  name                        String?
  googleId                    String?                     @unique
  googleEmail                 String?
  googleAvatar                String?
  authProvider                String                      @default("email")
  subscriptionPlan            String                      @default("starter")
  createdAt                   DateTime                    @default(now())
  updatedAt                   DateTime                    @updatedAt
  planEndDate                 DateTime?
  planStartDate               DateTime                    @default(now())
  avatar                      String?
  lastLoginAt                 DateTime?
  trialEndDate                DateTime?
  trialStartDate              DateTime?
  trialUsed                   Boolean                     @default(false)
  documentWordsUsed           Int                         @default(0)
  jailbreakAttempts           Int                         @default(0)
  lastStudioReset             DateTime                    @default(now())
  lastSuspiciousActivity      DateTime?
  studioCreditsCarryForward   Int                         @default(0)
  studioCreditsRemaining      Int                         @default(0)
  studioCreditsUsed           Int                         @default(0)
  suspiciousActivityCount     Int                         @default(0)
  trialExtended               Boolean                     @default(false)
  averageSessionDuration      Int?
  lastGreetingAt              DateTime?
  lastSeenAt                  DateTime?
  loginPattern                Json?
  memoryDays                  Int                         @default(5)
  preferredTimeSlots          String[]                    @default([])
  responseDelay               Float                       @default(5.0)
  sessionCount                Int                         @default(0)
  gender                      String?                     @default("other")
  cooldownPurchasesThisPeriod Int                         @default(0)
  cooldownResetDate           DateTime?
  lastCooldownPurchaseAt      DateTime?
  trialDaysUsed               Int                         @default(0)
  planStatus                  PlanStatus                  @default(ACTIVE)
  securityStatus              SecurityStatus              @default(TRUSTED)
  activityTrend               ActivityTrend               @default(NEW)
  planType                    PlanType                    @default(STARTER)
  studioCreditsBooster        Int                         @default(0)
  studioCreditsMonthly        Int                         @default(0)
  forges                      Forge[]
  workspacePowerPacks    WorkspacePowerPack[]
  workspaceFreeQuota     WorkspaceFreeQuota?
  workspaceGenerations   WorkspaceGeneration[]
  region                      Region                      @default(IN)
  currency                    Currency                    @default(INR)
  country                     String?                     @default("IN")
  detectedCountry             String?
  countryName                 String?
  timezone                    String?
  defaultAgeGroup             AgeGroup?                   @default(NOT_SPECIFIED)
  defaultGender               Gender?                     @default(NOT_SPECIFIED)
  githubId                    String?                     @unique
  usages                      Usage?
  usage                       UserUsage?
  boosters                    Booster[]
  chatSessions                ChatSession[]
  conversationMessages        ConversationMessage[]
  credits                     Credit[]
  documentChunks              DocumentChunk[]
  documentEmbeddings          DocumentEmbedding[]
  documentOperations          DocumentOperation[]         @relation("UserDocumentOperations")
  documentQueries             DocumentQuery[]             @relation("UserDocumentQueries")
  documentUsage               DocumentUsage?              @relation("UserDocumentUsage")
  documents                   Document[]
  exportLogs                  ExportLog[]
  fileUploads                 FileUpload[]
  healthAlerts                HealthAlert[]
  healthChats                 HealthChat[]
  healthComparisons           HealthComparison[]
  healthEmergencyContacts     HealthEmergencyContact[]
  healthFamilyMembers         HealthFamilyMember[]
  healthReports               HealthReport[]
  healthSavedProviders        HealthSavedProvider[]
  healthSubscription          HealthSubscription?
  healthSummaries             HealthSummary[]
  healthUsage                 HealthUsage[]
  jobs                        Job[]
  messages                    Message[]
  personalizationSuggestions  PersonalizationSuggestion[]
  queryLogs                   QueryLog[]
  securityLogs                SecurityLog[]
  studioBoosterPurchases      StudioBoosterPurchase[]
  studioGenerations           StudioGeneration[]
  studioPreviews              StudioPreview[]
  subscriptions               Subscription[]
  transactions                Transaction[]
  usageAudits                 UsageAudit[]
  userDocuments               UserDocument[]              @relation("UserDocuments")
  // ⭐ NEW: ABUSE CONTROL FIELDS
  deviceFingerprint           String?
  ipAddressHash               String?
  lastLoginIP                 String?
  emailVerified               Boolean                     @default(false)
  mobileVerified              Boolean                     @default(false)
  mobileNumber                String?
  refundCount                 Int                         @default(0)
  refundsThisYear             Int                         @default(0)
  lastRefundAt                DateTime?
  accidentalBoosterRefunds    Int                         @default(0)
  accountFlagged              Boolean                     @default(false)
  flaggedReason               String?

  // ⭐ NEW: Relation
  signupLogs                  SignupLog[]
  @@index([email])
  @@index([googleId])
  @@index([subscriptionPlan])
  @@index([planStatus])
  @@index([securityStatus])
  @@index([lastSeenAt])
  @@index([activityTrend])
  @@index([sessionCount])
  @@index([planType])
  @@index([cooldownResetDate])
  @@index([lastStudioReset])
  @@index([region])
  @@index([currency])
  @@index([country])
  @@index([defaultGender])
  @@index([defaultAgeGroup])
  @@index([deviceFingerprint])
  @@index([ipAddressHash])
  @@index([emailVerified])
  @@index([mobileVerified])
  @@index([accountFlagged])
  @@map("users")
}
model BlockedDevice {
  id          String   @id @default(cuid())
  fingerprint String   @unique
  reason      String
  blockedBy   String
  blockedAt   DateTime @default(now())

  @@index([fingerprint])
  @@map("blocked_devices")
}

model SignupLog {
  id                String   @id @default(cuid())
  userId            String
  deviceFingerprint String?
  ipAddressHash     String?
  userAgent         String?
  screenResolution  String?
  timezone          String?
  platform          String?
  createdAt         DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deviceFingerprint])
  @@index([ipAddressHash])
  @@map("signup_logs")
}

model SystemSettings {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String
  category    String
  description String?
  isPublic    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("system_settings")
}

model Subscription {
  id                    String     @id @default(uuid())
  userId                String
  planName              String
  planPrice             Int
  billingCycle          BillingCycle    @default(MONTHLY)
  startDate             DateTime   @default(now())
  endDate               DateTime
  autoRenew             Boolean    @default(true)
  paymentGateway        String?
  gatewaySubscriptionId String?    @unique
  gatewayCustomerId     String?
  gatewayMetadata       Json?
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt
  cancelReason          String?
  cancelledAt           DateTime?
  isTrial               Boolean    @default(false)
  trialDays             Int?       @default(14)
  status                PlanStatus @default(ACTIVE)
  currency              Currency   @default(INR)
  region                Region     @default(IN)
  bonusTokensLimit      Int        @default(0)
  bonusTokensUsed       Int        @default(0)
  lastResetAt           DateTime   @default(now())
  monthlyTokens         Int        @default(0)
  tokensUsed            Int        @default(0)
  usageResetDay         Int        @default(1)
  user                  User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([planName])
  @@index([status])
  @@index([endDate])
  @@index([currency])
  @@index([region])
  @@index([lastResetAt])
  @@map("subscriptions")
  @@index([billingCycle])
}

model Usage {
  id                     String    @id @default(cuid())
  userId                 String    @unique
  planName               String
  
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  // WORD/TOKEN USAGE (existing)
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  wordsUsed              Int       @default(0)
  dailyWordsUsed         Int       @default(0)
  remainingWords         Int       @default(0)
  bonusWords             Int       @default(0)
  monthlyLimit           Int       @default(0)
  dailyLimit             Int       @default(0)
  premiumTokensTotal     Int       @default(0)
  premiumTokensUsed      Int       @default(0)
  premiumTokensRemaining Int       @default(0)
  bonusTokensTotal       Int       @default(0)
  bonusTokensUsed        Int       @default(0)
  bonusTokensRemaining   Int       @default(0)
  dailyTokenLimit        Int       @default(0)
  dailyTokensUsed        Int       @default(0)
  dailyTokensRemaining   Int       @default(0)
  rolledOverTokens       Int       @default(0)
  totalAvailableToday    Int       @default(0)

  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  // VOICE USAGE - ONAIR (Monthly billing)
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  voiceMinutesUsed       Float     @default(0)
  voiceSecondsInput      Float     @default(0)
  voiceSecondsOutput     Float     @default(0)
  voiceRequestCount      Int       @default(0)
  voiceUsageResetAt      DateTime?
  lastVoiceUsedAt        DateTime?
  voiceRequestsThisHour  Int       @default(0)
  voiceHourlyResetAt     DateTime?

  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  // BILLING CYCLE & TIMESTAMPS
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  cycleStartDate         DateTime
  cycleEndDate           DateTime
  lastUsedAt             DateTime?
  lastDailyReset         DateTime  @default(now())
  lastMonthlyReset       DateTime  @default(now())
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  // RELATIONS & INDEXES
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([lastDailyReset])
  @@index([cycleEndDate])
}
model Booster {
  id                String          @id @default(uuid())
  userId            String
  boosterType       String
  boosterPrice      Int
  status            String          @default("active")
  activatedAt       DateTime        @default(now())
  expiresAt         DateTime
  wordsUsed         Int             @default(0)
  paymentGateway    String?
  gatewayPaymentId  String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  cooldownEnd       DateTime?
  boosterName       String
  cooldownDuration  Int?            @default(0)
  creditsAdded      Int?
  creditsRemaining  Int?
  creditsUsed       Int             @default(0)
  description       String?
  gatewayMetadata   Json?
  gatewayOrderId    String?         @unique
  planName          String
  validity          Int?            @default(10)
  wordsAdded        Int?
  wordsRemaining    Int?
  wordsUnlocked     Int?
  distributionLogic String?
  docsBonus         Int?
  maxPerPlanPeriod  Int?            @default(2)
  priceMultiplier   Float?
  purchaseNumber    Int?
  resetOn           String?         @default("plan_renewal")
  boosterCategory   BoosterCategory
  currency          Currency        @default(INR)
  region            Region          @default(IN)
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([boosterCategory])
  @@index([status])
  @@index([expiresAt])
  @@index([planName])
  @@index([purchaseNumber])
  @@index([currency])
  @@index([region])
  @@map("boosters")
}

model Credit {
  id               String   @id @default(uuid())
  userId           String
  totalCredits     Int      @default(0)
  usedCredits      Int      @default(0)
  remainingCredits Int      @default(0)
  planName         String
  month            Int
  year             Int
  lastReset        DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, month, year])
  @@index([userId])
  @@map("credits")
}

model Transaction {
  id               String   @id @default(uuid())
  userId           String
  type             String
  amount           Int
  currency         String   @default("INR")
  status           String
  planName         String?
  boosterType      String?
  creditsAdded     Int?
  paymentGateway   String?
  gatewayPaymentId String?  @unique
  gatewayOrderId   String?
  gatewaySignature String?
  gatewayMetadata  Json?
  description      String?
  receiptUrl       String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  refundReason     String?
  region           Region   @default(IN)
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([gatewayPaymentId])
  @@index([currency])
  @@map("transactions")
}

model ChatSession {
  id                        String                     @id @default(uuid())
  userId                    String
  title                     String                     @default("New Chat")
  aiModel                   String                     @default("claude-sonnet-4")
  brainMode                 String?
  messageCount              Int                        @default(0)
  totalTokens               Int                        @default(0)
  isActive                  Boolean                    @default(true)
  isPinned                  Boolean                    @default(false)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  lastMessageAt             DateTime                   @default(now())
  isArchived                Boolean                    @default(false)
  personality               String?
  sessionAgeGroup           AgeGroup                   @default(NOT_SPECIFIED)
  sessionGender             Gender                     @default(NOT_SPECIFIED)
  sessionName               String?                    @default("User")
  user                      User                       @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages                  Message[]
  personalizationSuggestion PersonalizationSuggestion?

  @@index([userId])
  @@index([isActive])
  @@index([isPinned])
  @@index([isArchived])
  @@index([lastMessageAt])
  @@index([personality])
  @@index([sessionGender])
  @@index([sessionAgeGroup])
  @@map("chat_sessions")
}

model Message {
  id                String      @id @default(uuid())
  userId            String
  sessionId         String
  role              String
  content           String
  aiModel           String?
  tokens            Int?
  hasAttachments    Boolean     @default(false)
  attachmentIds     String[]
  rating            Int?
  feedback          String?
  createdAt         DateTime    @default(now())
  isDocumentRequest Boolean     @default(false)
  wordsUsed         Int?
  branchId          String?
  parentMessageId   String?
  metadata          Json?
  aiProvider        String?
  encryptedContent  String?
  encryptionAuthTag String?
  encryptionIV      String?
  session           ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionId])
  @@index([createdAt])
  @@index([branchId])
  @@index([parentMessageId])
  @@index([aiProvider])
  @@map("messages")
}

model Job {
  id             String    @id @default(uuid())
  userId         String
  category       String
  feature        String
  status         String    @default("pending")
  priority       Int       @default(1)
  inputData      Json
  outputData     Json?
  aiModel        String?
  aiProvider     String?
  creditsUsed    Int?
  tokensUsed     Int?
  processingTime Int?
  inputFileIds   String[]
  outputFileIds  String[]
  errorMessage   String?
  retryCount     Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  completedAt    DateTime?
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([feature])
  @@index([status])
  @@index([createdAt])
  @@map("jobs")
}

model FileUpload {
  id              String    @id @default(uuid())
  userId          String
  filename        String
  originalName    String
  mimeType        String
  fileSize        Int
  storageProvider String    @default("cloudinary")
  storageUrl      String
  storageKey      String?
  thumbnailUrl    String?
  width           Int?
  height          Int?
  duration        Int?
  category        String
  purpose         String?
  isPublic        Boolean   @default(false)
  isProcessed     Boolean   @default(true)
  createdAt       DateTime  @default(now())
  expiresAt       DateTime?
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([purpose])
  @@index([createdAt])
  @@map("file_uploads")
}

model UsageAudit {
  id            String   @id @default(uuid())
  userId        String
  actionType    String
  category      String
  wordsUsed     Int?
  creditsUsed   Int?
  planName      String
  sessionId     String?
  messageId     String?
  jobId         String?
  metadata      Json?
  deductedFrom  String?
  balanceBefore Int?
  balanceAfter  Int?
  createdAt     DateTime @default(now())
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([actionType])
  @@index([category])
  @@index([planName])
  @@index([createdAt])
  @@map("usage_audits")
}

model SecurityPattern {
  id             String    @id @default(uuid())
  name           String    @unique
  pattern        String
  category       String
  severity       String
  action         String    @default("BLOCK")
  description    String
  examples       String[]
  falsePositives String[]
  isActive       Boolean   @default(true)
  priority       Int       @default(100)
  matchCount     Int       @default(0)
  blockCount     Int       @default(0)
  lastMatched    DateTime?
  version        Int       @default(1)
  createdBy      String?
  updatedBy      String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([category])
  @@index([severity])
  @@index([isActive])
  @@index([priority])
  @@map("security_patterns")
}

model SecurityConfig {
  id            String    @id @default(uuid())
  configKey     String    @unique
  configValue   String
  dataType      String
  description   String
  category      String
  minValue      Float?
  maxValue      Float?
  allowedValues String[]
  isActive      Boolean   @default(true)
  isEditable    Boolean   @default(true)
  previousValue String?
  changedBy     String?
  changedAt     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([configKey])
  @@index([category])
  @@index([isActive])
  @@map("security_configs")
}

model BlockedModelName {
  id             String    @id @default(uuid())
  modelName      String    @unique
  aliases        String[]
  provider       String?
  blockType      String    @default("REMOVE")
  replacement    String?   @default("Soriva")
  isActive       Boolean   @default(true)
  priority       Int       @default(100)
  detectionCount Int       @default(0)
  lastDetected   DateTime?
  reason         String?
  addedBy        String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([modelName])
  @@index([provider])
  @@index([isActive])
  @@map("blocked_model_names")
}

model ProviderConfiguration {
  id                   String    @id @default(uuid())
  providerName         String    @unique
  displayName          String
  isEnabled            Boolean   @default(true)
  priority             Int       @default(100)
  modelsConfig         Json
  baseUrl              String?
  apiVersion           String?
  timeout              Int?      @default(30000)
  retryAttempts        Int?      @default(3)
  supportsStreaming    Boolean   @default(false)
  supportsImages       Boolean   @default(false)
  supportsAudio        Boolean   @default(false)
  maxRequestsPerMinute Int?
  maxTokensPerRequest  Int?
  isHealthy            Boolean   @default(true)
  lastHealthCheck      DateTime?
  healthCheckUrl       String?
  configuredBy         String?
  notes                String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@index([providerName])
  @@index([isEnabled])
  @@index([priority])
  @@map("provider_configurations")
}

model SecurityLog {
  id                  String    @id @default(uuid())
  userId              String?
  ipAddress           String
  userAgent           String?
  requestPath         String?
  requestMethod       String?
  threatType          String
  severity            String
  riskScore           Int       @default(0)
  matchedPatterns     String[]
  detectionMethod     String[]
  userInput           String
  sanitizedInput      String?
  wasBlocked          Boolean   @default(false)
  blockReason         String?
  aiResponse          String?
  sessionId           String?
  conversationContext Json?
  flags               Json?
  reviewStatus        String    @default("pending")
  reviewedBy          String?
  reviewedAt          DateTime?
  reviewNotes         String?
  createdAt           DateTime  @default(now())
  user                User?     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([threatType])
  @@index([severity])
  @@index([riskScore])
  @@index([wasBlocked])
  @@index([reviewStatus])
  @@index([createdAt])
  @@map("security_logs")
}

model Document {
  id              String              @id @default(uuid())
  userId          String
  filename        String
  originalName    String
  fileType        String
  fileSize        Int
  mimeType        String
  storageUrl      String
  storageProvider String              @default("cloudinary")
  storageKey      String?
  textContent     String?
  contentLanguage String?             @default("en")
  wordCount       Int?
  pageCount       Int?
  metadata        Json?
  title           String?
  description     String?
  tags            String[]            @default([])
  status          String              @default("pending")
  processingStage String?
  errorMessage    String?
  chunkingMethod  String              @default("fixed")
  chunkSize       Int                 @default(512)
  chunkOverlap    Int                 @default(50)
  embeddingModel  String              @default("text-embedding-3-small")
  totalChunks     Int                 @default(0)
  totalEmbeddings Int                 @default(0)
  visibility      String              @default("private")
  sharedWith      String[]            @default([])
  processingTime  Int?
  indexingTime    Int?
  lastAccessedAt  DateTime?
  accessCount     Int                 @default(0)
  uploadedAt      DateTime            @default(now())
  processedAt     DateTime?
  indexedAt       DateTime?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  expiresAt       DateTime?
  chunks          DocumentChunk[]
  embeddings      DocumentEmbedding[]
  operations      DocumentOperation[] @relation("DocumentOperations")
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  queryLogs       QueryLog[]

  @@index([userId])
  @@index([status])
  @@index([fileType])
  @@index([visibility])
  @@index([uploadedAt])
  @@index([lastAccessedAt])
  @@map("documents")
}

model DocumentChunk {
  id            String             @id @default(uuid())
  documentId    String
  userId        String
  chunkIndex    Int
  content       String
  tokenCount    Int
  wordCount     Int
  charCount     Int
  startPosition Int?
  endPosition   Int?
  pageNumber    Int?
  section       String?
  metadata      Json?
  semanticGroup String?
  hasEmbedding  Boolean            @default(false)
  embeddingId   String?            @unique
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  document      Document           @relation(fields: [documentId], references: [id], onDelete: Cascade)
  embedding     DocumentEmbedding? @relation(fields: [embeddingId], references: [id])
  user          User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([documentId, chunkIndex])
  @@index([documentId])
  @@index([userId])
  @@index([chunkIndex])
  @@index([hasEmbedding])
  @@map("document_chunks")
}

model DocumentEmbedding {
  id             String         @id @default(uuid())
  documentId     String
  chunkId        String         @unique
  userId         String
  embedding      Json
  dimensions     Int
  model          String
  provider       String         @default("openai")
  metadata       Json?
  generationTime Int?
  status         String         @default("active")
  createdAt      DateTime       @default(now())
  lastUsedAt     DateTime?
  chunk          DocumentChunk?
  document       Document       @relation(fields: [documentId], references: [id], onDelete: Cascade)
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([userId])
  @@index([model])
  @@index([status])
  @@map("document_embeddings")
}

model QueryLog {
  id              String    @id @default(uuid())
  userId          String?
  documentId      String?
  query           String
  queryType       String    @default("semantic")
  queryTokens     Int?
  queryWords      Int?
  language        String?   @default("en")
  topK            Int       @default(5)
  threshold       Float?
  filters         Json?
  resultsFound    Int       @default(0)
  resultsReturned Int       @default(0)
  resultChunkIds  String[]  @default([])
  retrievalTime   Int?
  embeddingTime   Int?
  searchTime      Int?
  topScores       Float[]   @default([])
  avgScore        Float?
  wasHelpful      Boolean?
  feedbackRating  Int?
  feedbackComment String?
  sessionId       String?
  messageId       String?
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime  @default(now())
  document        Document? @relation(fields: [documentId], references: [id])
  user            User?     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([documentId])
  @@index([queryType])
  @@index([createdAt])
  @@index([sessionId])
  @@map("query_logs")
}

model RAGConfiguration {
  id            String    @id @default(uuid())
  configKey     String    @unique
  configValue   String
  dataType      String
  scope         String    @default("global")
  scopeId       String?
  category      String
  description   String
  minValue      Float?
  maxValue      Float?
  allowedValues String[]
  isActive      Boolean   @default(true)
  isEditable    Boolean   @default(true)
  previousValue String?
  changedBy     String?
  changedAt     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([configKey])
  @@index([category])
  @@index([scope])
  @@index([isActive])
  @@map("rag_configurations")
}

model LearnedPattern {
  id                  String    @id @default(uuid())
  pattern             String
  patternType         String
  frequency           Int       @default(1)
  uniqueUsers         Int       @default(1)
  successRate         Float     @default(0.0)
  riskScore           Int       @default(0)
  threatLevel         String    @default("UNKNOWN")
  firstSeenAt         DateTime  @default(now())
  lastSeenAt          DateTime  @default(now())
  sourceLogIds        String[]
  status              String    @default("ANALYZING")
  confidence          Float     @default(0.0)
  promotedToPatternId String?
  promotedAt          DateTime?
  promotedBy          String?
  examples            String[]
  context             Json?
  reviewStatus        String    @default("pending")
  reviewedBy          String?
  reviewNotes         String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  @@index([patternType])
  @@index([frequency])
  @@index([riskScore])
  @@index([status])
  @@index([reviewStatus])
  @@index([lastSeenAt])
  @@map("learned_patterns")
}

model ExportLog {
  id           String   @id @default(uuid())
  userId       String
  format       String
  messageCount Int
  fileSize     Int
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("export_logs")
}

model UserDocument {
  id             String          @id @default(uuid())
  userId         String
  fileName       String
  fileSize       Int
  fileType       String
  fileUrl        String
  status         String          @default("uploading")
  processedText  String?
  pageCount      Int?
  ragDocumentId  String?
  chunkCount     Int             @default(0)
  wordCount      Int             @default(0)
  queryCount     Int             @default(0)
  uploadedAt     DateTime        @default(now())
  processedAt    DateTime?
  lastAccessedAt DateTime?
  queries        DocumentQuery[]
  user           User            @relation("UserDocuments", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("user_documents")
}

model DocumentQuery {
  id             String       @id @default(uuid())
  userId         String
  documentId     String
  question       String
  answer         String
  relevantChunks Json
  confidence     Float?
  wordsUsed      Int          @default(0)
  createdAt      DateTime     @default(now())
  document       UserDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)
  user           User         @relation("UserDocumentQueries", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([documentId])
  @@map("document_queries")
}
model StudioGeneration {
  id                String            @id @default(uuid())
  userId            String
  featureType       StudioFeatureType
  featureName       String
  userPrompt        String
  inputImageUrl     String?
  parameters        Json?
  creditsUsed       Int
  previewCredits    Int               @default(1)
  generationCredits Int
  apiCost           Float?
  gpuCost           Float?
  totalCost         Float?
  profitMargin      Float?
  status            GenerationStatus  @default(PENDING)
  outputUrl         String?
  outputType        String?
  metadata          Json?
  processingTime    Int?
  modelUsed         String?
  apiProvider       String?
  featureCategory   String?
  errorMessage      String?
  hasWatermark      Boolean           @default(true)
  watermarkRemoved  Boolean           @default(false)
  downloadCount     Int               @default(0)
  createdAt         DateTime          @default(now())
  completedAt       DateTime?
  updatedAt         DateTime          @updatedAt
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  previews          StudioPreview[]

  @@index([userId])
  @@index([featureType])
  @@index([status])
  @@index([createdAt])
  @@index([apiProvider])
  @@map("studio_generations")
}

model StudioPreview {
  id            String           @id @default(uuid())
  generationId  String
  userId        String
  previewNumber Int
  previewUrl    String
  previewType   String
  resolution    String?
  duration      Int?
  fileSize      Int?
  creditsCost   Int              @default(0)
  apiCost       Float?
  gpuCost       Float?
  approved      Boolean          @default(false)
  regenerated   Boolean          @default(false)
  generatedAt   DateTime         @default(now())
  approvedAt    DateTime?
  generation    StudioGeneration @relation(fields: [generationId], references: [id], onDelete: Cascade)
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([generationId])
  @@index([userId])
  @@index([previewNumber])
  @@map("studio_previews")
}

model StudioBoosterPurchase {
  id               String            @id @default(uuid())
  userId           String
  boosterType      StudioBoosterType
  boosterName      String
  creditsAdded     Int
  price            Float
  currency         String            @default("INR")
  validityDays     Int               @default(30)
  expiresAt        DateTime
  status           String            @default("ACTIVE") 
  active           Boolean           @default(true)
  paymentMethod    String?
  paymentId        String?           @unique
  paymentStatus    String            @default("pending")
  gatewayCost      Float?
  netRevenue       Float?
  creditsUsed      Int               @default(0)
  creditsRemaining Int
  metadata         Json?
  purchasedAt      DateTime          @default(now())
  activatedAt      DateTime?
  updatedAt        DateTime          @updatedAt
  region           Region            @default(IN)
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([boosterType])
  @@index([active])
  @@index([expiresAt])
  @@index([paymentId])
  @@index([purchasedAt])
  @@index([currency])
  @@index([region])
  @@map("studio_booster_purchases")
}

model ConversationMessage {
  id             String   @id @default(cuid())
  userId         String
  conversationId String
  role           String
  content        String
  emotion        String?
  isImportant    Boolean  @default(false)
  metadata       String?
  timestamp      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@index([conversationId])
  @@index([userId, isImportant])
  @@map("conversation_messages")
}

model PersonalizationSuggestion {
  id               String           @id @default(uuid())
  sessionId        String           @unique
  userId           String
  detectedGender   Gender?
  detectedAgeGroup AgeGroup?
  genderConfidence Float            @default(0)
  ageConfidence    Float            @default(0)
  status           SuggestionStatus @default(PENDING)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  expiresAt        DateTime?
  session          ChatSession      @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionId])
  @@index([status])
  @@map("personalization_suggestions")
}

model DocumentOperation {
  id             String          @id @default(uuid())
  documentId     String
  userId         String
  operationType  OperationType
  operationName  String
  category       String          @default("general")
  inputTokens    Int             @default(0)
  outputTokens   Int             @default(0)
  totalTokens    Int             @default(0)
  cost           Float           @default(0)
  aiProvider     String?
  aiModel        String?
  result         String?
  resultPreview  String?
  status         OperationStatus @default(SUCCESS)
  error          String?
  processingTime Int?
  retryCount     Int             @default(0)
  cacheKey       String?
  fromCache      Boolean         @default(false)
  cacheHit       Boolean         @default(false)
  metadata       Json?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  document       Document        @relation("DocumentOperations", fields: [documentId], references: [id], onDelete: Cascade)
  user           User            @relation("UserDocumentOperations", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([documentId])
  @@index([operationType])
  @@index([category])
  @@index([createdAt])
  @@index([cacheKey])
  @@map("document_operations")
}

model DocumentUsage {
  id                  String   @id @default(uuid())
  userId              String   @unique
  documentsThisMonth  Int      @default(0)
  operationsThisMonth Int      @default(0)
  tokensUsedThisMonth Int      @default(0)
  costThisMonth       Float    @default(0)
  freeOpsThisMonth    Int      @default(0)
  paidOpsThisMonth    Int      @default(0)
  documentLimit       Int      @default(5)
  operationLimit      Int      @default(25)
  isPaidUser          Boolean  @default(false)
  totalStorageUsed    BigInt   @default(0)
  storageLimit        BigInt   @default(10485760)
  lastMonthlyReset    DateTime @default(now())
  cycleStartDate      DateTime @default(now())
  cycleEndDate        DateTime
  operationsThisHour  Int      @default(0)
  lastHourlyReset     DateTime @default(now())
  hourlyLimit         Int      @default(10)
  operationsToday     Int      @default(0)
  lastDailyReset      DateTime @default(now())
  metadata            Json?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation("UserDocumentUsage", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([lastMonthlyReset])
  @@index([isPaidUser])
  @@map("document_usage")
}

model HealthSubscription {
  id                    String                   @id @default(cuid())
  userId                String                   @unique
  plan                  HealthPlan               @default(FREE)
  status                HealthSubscriptionStatus @default(ACTIVE)
  price                 Int                      @default(0)
  currency              Currency                 @default(INR)
  region                Region                   @default(IN)
  startDate             DateTime                 @default(now())
  endDate               DateTime?
  maxMembers            Int                      @default(1)
  paymentGateway        String?
  gatewaySubscriptionId String?                  @unique
  gatewayCustomerId     String?
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  familyMembers         HealthFamilyMember[]
  user                  User                     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([plan])
  @@map("health_subscriptions")
}

model HealthFamilyMember {
  id                 String             @id @default(cuid())
  userId             String
  subscriptionId     String
  name               String
  relation           String
  dateOfBirth        DateTime?
  gender             String?
  bloodGroup         String?
  allergies          String[]           @default([])
  chronicConditions  String[]           @default([])
  currentMedications String[]           @default([])
  isActive           Boolean            @default(true)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  chats              HealthChat[]
  subscription       HealthSubscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  reports            HealthReport[]

  @@index([userId])
  @@index([subscriptionId])
  @@map("health_family_members")
}

model HealthReport {
  id               String                 @id @default(cuid())
  userId           String
  familyMemberId   String?
  title            String
  reportType       ReportType             @default(OTHER)
  reportDate       DateTime               @default(now())
  labName          String?
  doctorName       String?
  originalFileName String
  fileUrl          String
  filePublicId     String?
  fileSize         Int
  mimeType         String
  ocrText          String?
  ocrConfidence    Float?
  ocrProcessedAt   DateTime?
  isAnalyzed       Boolean                @default(false)
  analysisJson     Json?
  overallRiskLevel RiskLevel              @default(NORMAL)
  healthScore      Int?
  keyFindings      String[]               @default([])
  recommendations  String[]               @default([])
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  alerts           HealthAlert[]
  biomarkers       HealthBiomarker[]
  comparisons      HealthComparison[]     @relation("ComparisonReport1")
  comparedWith     HealthComparison[]     @relation("ComparisonReport2")
  organBreakdowns  HealthOrganBreakdown[]
  familyMember     HealthFamilyMember?    @relation(fields: [familyMemberId], references: [id])
  user             User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  summaries        HealthSummary[]

  @@index([userId])
  @@index([familyMemberId])
  @@index([reportType])
  @@index([reportDate])
  @@index([overallRiskLevel])
  @@index([createdAt])
  @@map("health_reports")
}

model HealthBiomarker {
  id             String       @id @default(cuid())
  reportId       String
  name           String
  category       String?
  value          Float
  unit           String
  refMin         Float?
  refMax         Float?
  refRange       String?
  status         RiskLevel    @default(NORMAL)
  deviation      Float?
  interpretation String?
  organSystem    OrganSystem?
  createdAt      DateTime     @default(now())
  report         HealthReport @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId])
  @@index([name])
  @@index([status])
  @@index([organSystem])
  @@map("health_biomarkers")
}

model HealthOrganBreakdown {
  id                String       @id @default(cuid())
  reportId          String
  organSystem       OrganSystem
  healthScore       Int
  riskLevel         RiskLevel    @default(NORMAL)
  status            String
  findings          String[]     @default([])
  recommendations   String[]     @default([])
  relatedBiomarkers String[]     @default([])
  createdAt         DateTime     @default(now())
  report            HealthReport @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@unique([reportId, organSystem])
  @@index([reportId])
  @@index([organSystem])
  @@index([riskLevel])
  @@map("health_organ_breakdowns")
}

model HealthComparison {
  id               String       @id @default(cuid())
  userId           String
  report1Id        String
  report2Id        String
  comparisonJson   Json
  improvementAreas String[]     @default([])
  worseningAreas   String[]     @default([])
  stableAreas      String[]     @default([])
  overallTrend     String
  insights         String[]     @default([])
  recommendations  String[]     @default([])
  createdAt        DateTime     @default(now())
  report1          HealthReport @relation("ComparisonReport1", fields: [report1Id], references: [id], onDelete: Cascade)
  report2          HealthReport @relation("ComparisonReport2", fields: [report2Id], references: [id], onDelete: Cascade)
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([report1Id])
  @@index([report2Id])
  @@index([createdAt])
  @@map("health_comparisons")
}

model HealthChat {
  id                  String              @id @default(cuid())
  userId              String
  familyMemberId      String?
  sessionId           String              @default(cuid())
  role                String
  content             String
  referencedReportIds String[]            @default([])
  model               String?
  tokensUsed          Int?
  createdAt           DateTime            @default(now())
  familyMember        HealthFamilyMember? @relation(fields: [familyMemberId], references: [id])
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionId])
  @@index([familyMemberId])
  @@index([createdAt])
  @@map("health_chats")
}

model HealthSummary {
  id           String       @id @default(cuid())
  userId       String
  reportId     String
  title        String
  pdfUrl       String?
  pdfPublicId  String?
  summaryJson  Json
  doctorNotes  String?
  visitDate    DateTime?
  doctorName   String?
  hospitalName String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  report       HealthReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([reportId])
  @@index([createdAt])
  @@map("health_summaries")
}

model HealthAlert {
  id          String              @id @default(cuid())
  userId      String
  reportId    String?
  type        HealthAlertType
  priority    HealthAlertPriority @default(MEDIUM)
  title       String
  message     String
  actionUrl   String?
  actionText  String?
  isRead      Boolean             @default(false)
  isDismissed Boolean             @default(false)
  createdAt   DateTime            @default(now())
  readAt      DateTime?
  report      HealthReport?       @relation(fields: [reportId], references: [id])
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([reportId])
  @@index([type])
  @@index([priority])
  @@index([isRead])
  @@index([createdAt])
  @@map("health_alerts")
}

model HealthUsage {
  id                 String    @id @default(cuid())
  userId             String
  month              Int
  year               Int
  reportsUploaded    Int       @default(0)
  chatsUsed          Int       @default(0)
  comparisonsUsed    Int       @default(0)
  summariesGenerated Int       @default(0)
  dailyChatsUsed     Int       @default(0)
  lastChatDate       DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, month, year])
  @@index([userId])
  @@index([month, year])
  @@map("health_usage")
}

model HealthSavedProvider {
  id           String    @id @default(cuid())
  userId       String
  providerId   String
  providerType String
  notes        String?
  lastVisited  DateTime?
  createdAt    DateTime  @default(now())
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, providerId, providerType])
  @@index([userId])
  @@map("health_saved_providers")
}

model HealthEmergencyContact {
  id        String   @id @default(cuid())
  userId    String
  name      String
  relation  String
  phone     String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("health_emergency_contacts")
}

enum Gender {
  MALE
  FEMALE
  OTHER
  NOT_SPECIFIED
}

enum AgeGroup {
  YOUNG
  MIDDLE
  SENIOR
  NOT_SPECIFIED
}

enum PlanType {
  STARTER
  PLUS
  PRO
  APEX
  SOVEREIGN
}

enum PlanStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  PENDING
  TRIAL
}

enum BoosterCategory {
  COOLDOWN
  ADDON
}
enum BillingCycle {
  MONTHLY
  YEARLY
}

enum SuggestionStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
}

enum SecurityStatus {
  TRUSTED
  FLAGGED
  BLOCKED
}

enum ActivityTrend {
  NEW
  INCREASING
  STABLE
  DECLINING
  IRREGULAR
}

enum Region {
  IN
  INTL
}

enum Currency {
  INR
  USD
}

enum StudioFeatureType {
  // Ideogram Features (10 credits each)
  TEXT_TO_IMAGE
  LOGO_GENERATION
  
  // Banana PRO Features (20 credits each)
  OBJECT_REMOVE
  BACKGROUND_CHANGE
  PORTRAIT_STUDIO
  SKETCH_COMPLETE
  PHOTO_ENHANCE
  BACKGROUND_EXPAND
  STYLE_TRANSFER
  CELEBRITY_MERGE
  BABY_PREDICTION
  
  // Talking Photos
  TALKING_PHOTO_5S
  TALKING_PHOTO_10S
  
  // Video - Coming Soon
  VIDEO_5S
  VIDEO_10S
}
enum StudioBoosterType {
  LITE
  PRO
  MAX
}

enum GenerationStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum HealthPlan {
  FREE
  BASIC
  PRO
  FAMILY
}

enum HealthSubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  PENDING
}

enum ReportType {
  BLOOD_TEST
  URINE_TEST
  LIPID_PROFILE
  LIVER_FUNCTION
  KIDNEY_FUNCTION
  THYROID
  DIABETES
  VITAMIN
  HORMONE
  CARDIAC
  IMAGING
  OTHER
}

enum RiskLevel {
  NORMAL
  LOW
  MODERATE
  HIGH
  CRITICAL
}

enum OrganSystem {
  CARDIOVASCULAR
  RESPIRATORY
  DIGESTIVE
  NERVOUS
  ENDOCRINE
  IMMUNE
  MUSCULOSKELETAL
  URINARY
  REPRODUCTIVE
  INTEGUMENTARY
  LYMPHATIC
  HEPATIC
  RENAL
  HEMATOLOGICAL
  OTHER
}

enum HealthAlertType {
  CRITICAL_VALUE
  TREND_WARNING
  CHECKUP_REMINDER
  MEDICATION_REMINDER
  LIFESTYLE_TIP
}

enum HealthAlertPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum OperationType {
  SUMMARY_SHORT
  SUMMARY_LONG
  SUMMARY_BULLET
  KEYWORD_EXTRACT
  DOCUMENT_CLEANUP
  TRANSLATE_BASIC
  FLASHCARDS
  TEST_GENERATOR
  NOTES_GENERATOR
  TOPIC_BREAKDOWN
  CROSS_PDF_COMPARE
  TABLE_TO_CHARTS
  SUMMARIES_ADVANCED
  INSIGHTS_EXTRACTION
  DOCUMENT_CLEANUP_ADVANCED
  KEYWORD_INDEX_EXTRACTOR
  WORKFLOW_CONVERSION
  PRESENTATION_MAKER
  QUESTION_BANK
  FILL_IN_BLANKS
  DOCUMENT_CHAT_MEMORY
  TRANSLATE_SIMPLIFY_ADVANCED
  DIAGRAM_INTERPRETATION
  TREND_ANALYSIS
  CONTRACT_LAW_SCAN
  MULTI_DOC_REASONING
  VOICE_MODE
  REPORT_BUILDER
  AI_DETECTION_REDACTION
  EXPLAIN_SIMPLE
  EXTRACT_DEFINITIONS
}

enum OperationStatus {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
  TIMEOUT
  CANCELLED
  CACHED
}
// ============================================
// 🔥 SORIVA FORGE - AI Content Generation
// ============================================

model Forge {
  id              String       @id @default(uuid())
  userId          String
  sessionId       String?
  messageId       String?
  
  // Content
  title           String
  content         String
  contentType     ForgeType
  language        String?      // For code: js, python, etc.
  
  // Metadata
  version         Int          @default(1)
  isPublic        Boolean      @default(false)
  shareToken      String?      @unique
  
  // Stats
  copyCount       Int          @default(0)
  downloadCount   Int          @default(0)
  viewCount       Int          @default(0)
  
  // Timestamps
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  expiresAt       DateTime?
  
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionId])
  @@index([contentType])
  @@index([shareToken])
  @@index([createdAt])
  @@map("forges")
}

enum ForgeType {
  CODE
  DOCUMENT
  MARKDOWN
  HTML
  TABLE
  JSON
  CSV
  DIAGRAM
}
// ============================================
// 🛠️ WORKSPACE TOOLS ENUMS
// ============================================

enum WorkspaceTool {
  RESUME
  INVOICE
  PORTFOLIO
  CRM
  CONTENT
}

enum PowerPackTier {
  PLUS
  PRO
  APEX
}

enum WorkspaceStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}
// ============================================
// 📦 Power Pack Purchase
// ============================================
model WorkspacePowerPack {
  id                 String        @id @default(uuid())
  userId             String
  tier               PowerPackTier
  packName           String
  price              Float
  currency           Currency      @default(INR)
  region             Region        @default(IN)
  
  // Uses per tool (5 each)
  resumeUsesTotal    Int           @default(5)
  resumeUsesUsed     Int           @default(0)
  invoiceUsesTotal   Int           @default(5)
  invoiceUsesUsed    Int           @default(0)
  portfolioUsesTotal Int           @default(5)
  portfolioUsesUsed  Int           @default(0)
  crmUsesTotal       Int           @default(5)
  crmUsesUsed        Int           @default(0)
  contentUsesTotal   Int           @default(5)
  contentUsesUsed    Int           @default(0)
  
  // Token budget
  totalTokenBudget   Int           @default(125000)
  tokensUsed         Int           @default(0)
  
  // LLM
  llmModel           String
  llmProvider        String
  
  // Status
  status             String        @default("active")
  
  // Payment
  paymentGateway     String?
  gatewayPaymentId   String?       @unique
  gatewayOrderId     String?
  
  // Timestamps
  purchasedAt        DateTime      @default(now())
  expiresAt          DateTime?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  generations        WorkspaceGeneration[]
  
  @@index([userId])
  @@index([tier])
  @@index([status])
  @@map("workspace_power_packs")
}

// ============================================
// 🎁 Free Quota (Paid Subscribers)
// ============================================
model WorkspaceFreeQuota {
  id                 String   @id @default(uuid())
  userId             String   @unique
  
  // Free uses
  resumeUsesTotal    Int      @default(2)
  resumeUsesUsed     Int      @default(0)
  invoiceUsesTotal   Int      @default(3)
  invoiceUsesUsed    Int      @default(0)
  portfolioUsesTotal Int      @default(0)
  portfolioUsesUsed  Int      @default(0)
  crmUsesTotal       Int      @default(0)
  crmUsesUsed        Int      @default(0)
  contentUsesTotal   Int      @default(0)
  contentUsesUsed    Int      @default(0)
  
  // Tokens
  tokensUsed         Int      @default(0)
  
  // Reset tracking
  lastResetAt        DateTime @default(now())
  subscriptionPlan   String
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@map("workspace_free_quotas")
}

// ============================================
// 📄 Workspace Generations
// ============================================
model WorkspaceGeneration {
  id                  String              @id @default(uuid())
  userId              String
  powerPackId         String?
  
  // Tool
  tool                WorkspaceTool
  toolName            String
  
  // Input/Output
  userInput           Json
  userPrompt          String?
  outputJson          Json?
  outputHtml          String?
  
  // Exports
  pdfUrl              String?
  docxUrl             String?
  pngUrl              String?
  
  // Tokens
  inputTokens         Int                 @default(0)
  outputTokens        Int                 @default(0)
  totalTokens         Int                 @default(0)
  
  // Cost
  llmModel            String?
  llmProvider         String?
  estimatedCost       Float               @default(0)
  
  // Status
  status              WorkspaceStatus     @default(PENDING)
  errorMessage        String?
  processingTime      Int?
  
  // Edit tracking
  isEdit              Boolean             @default(false)
  parentGenerationId  String?
  editNumber          Int                 @default(0)
  
  // Meta
  templateUsed        String?
  version             Int                 @default(1)
  
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  completedAt         DateTime?
  
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  powerPack           WorkspacePowerPack? @relation(fields: [powerPackId], references: [id])
  parentGeneration    WorkspaceGeneration? @relation("GenerationEdits", fields: [parentGenerationId], references: [id])
  edits               WorkspaceGeneration[] @relation("GenerationEdits")
  
  @@index([userId])
  @@index([powerPackId])
  @@index([tool])
  @@index([status])
  @@index([parentGenerationId])
  @@map("workspace_generations")
}