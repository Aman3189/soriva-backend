const _0x5357b7=_0x43c5;function _0x28e2(){const _0xe17648=['u2vYDMLJzq','D2fYBG','AhfAv04','BwjLCKLK','y21XB1q','Bg9N','zgvZyW','AxnRtgv2zwW','ExnPCYbJB20','kcGOlISPkYK','rKLmrv9msu0','B3jNyw5cCMu','x0zbsuXfra','zw5JEvjLC3a','B2nYu2vYDMK','z2v0tw9UDgG','AgvHBhrOrMe','zfjLCg9YDa','mZe3mdiWENHpCunx','Ce96sKK','DxbSB2fKuMu','uKvqt1jux04','ufjp','C3bVBMrPBMC','z2v0t3jdCMu','vwzKEKO','Dgf0Aw9U','AgvHBhrOvxm','z2LnAg4','zvrLEhq','B3vKAw5HCNK','zuz4rw4','zxj2AwnL','CMvMzxjLBMm','zxj0','BhrOlxbSyw4','BwfYA0fSzxi','B3jNyw5tExm','ifvWBg9Hzca','su5wquXjrf8','AxnfBwvYz2u','ugXHBLr5Cgu','A1fuyKK','BYbLEhrYywm','quXmt1Dfrf8','B21HCMTLCG','zxjYB3i','CMLUzW','x19LC01Vzhu','B3jPz2LUywW','zwrszxbVCNq','CNvXveu','CNzPy2u','lIbqBgvHC2u','z2v0q2HHDeG','CMvszxbVCNq','CMvWB3j0rge','qhbYAxnTys8','q0XVsum','u05fzve','AgvHBhrOu2u','Cgu6ia','BNrvC2fNzq','BMDZ','CgXLDguUieG','mJmZmZzHyK1jtwe','kqPizwfSDgG','Dej5swq','Dg9tDhjPBMC','u3vTBwfYEq','cKzPBMrPBMC','qM9RsLq','y2XVDwrPBMe','z2v0uMvWB3i','BhLZAxmGD2K','ihLVDxiGCMu','zxH0CMfJDfq','Cg9YDfr5Cgu','mJi4thj4r0Df','BgvKoG','y3jLyxrLzee','C2uGzw5ZDxi','z2v0rMfTAwW','y2XLyxjLCIa','y3vYCMvUDe0','C2uGDhj5ige','y291BNq','ztOG','CMvJB21Tzw4','u1H4tKm','ugXLyxnLihu','y2HHDhm','revdteLosu4','yxnJ','CLrmAe0','ExnPCYbMywK','Aw5JBhvKzxm','y2HHDhnqzxi','EsWGssDTigG','Dcb0zxH0igy','C3rHDhvZ','CZOG','q0Hbva','u1nbr0vt','ief1Dg8Tzgu','C0DLBMvYyxq','z2v0rNvSBfK','yxnZAxn0yw4','z2fUqNjLywS','DxnLCG','C2vJDxjLvxi','C2vZC2LVBKK','vevova','BxbHCMLZB24','svndtefjtuu','DMfSDwu','z2v0rw1LCMC','t0rcChG','AgvHBhrOu3u','yMLVBwfYA2u','rLjfrq','BNn0yw50CW','rvjst1jFtuu','AgvHBhrOu2m','yNnJCMLWDgK','y29UC3rYDwm','zgf0Aw9UCW','B2jQzwn0','sevbtfrix0q','AgvHBhrOt3i','rKLmrv9dt04','BgfItMfTzq','B2fYzfn0yxq','y1DZrxO','z2v0rgfZAgi','q0vfreve','u1rbqKXf','rKLmrv9ut08','EhDXs04','BgfZDenOyxq','y2fUr2vUzxi','tK9stufm','y2HYB25Py0m','ENnoD2y','AgvHBhrOuMu','yxrLu3vIC2m','tuLnrv9uwva','yw5HBhL6zvi','Dgv4Da','ifvWBg9HzgK','B3jL','DMLZAxreyxq','Aw1Hz2u','Aw1Hz2uGB2y','vfDir3a','s05PyMi','B3bLCNr5','u3vTBwfYEsa','zxbVCNq','ihrYEsbHz2e','z2v0vxnHz2u','zwfY','CNLtzxj2Awm','DNPsCgG','uIb0zxH0igy','y3jLyxrL','C2L6zq','y3HJyw8','t1rirvi','ywLizwfSDgG','Aw5JCMvTzw4','ntmXmtKYofLSq050ta','ywrPBMCGysa','Bwf4','DfvZywDL','z2v0qwXLCNq','ywXS','DxbKyxrLtwe','B25MAwrLBMm','DgGGCgXHBJO','rKLmrq','qu5btfLtsvm','lI9Zzxj2Awm','AwXLzdO','CMvWB3j0C1u','BNrO','lI4VlI4Vy28','rgvvExy','teLnsvrFrvG','ieLUC3vMzMK','lI9OzwfSDgG','CgXHBG','z2vUzxjHDgu','ifn0yxj0Aw4','y29TCgfYzvi','DxbZzxj0','zg9JDg9YtMe','zxbVCNrZ','ugvJCeK','y29TCgfYAxm','AufsB0C','tufyx0zjteu','C1bLCK1VBNq','ihjPz2H0ig4','BMfTzq','n2zkse50Ca','mJy3mJG4nNHSvuT5DG','zxmVy2XVDwq','kYKRja','su1jvf9srue','yxbUyxO','CM9TihjLCg8','Agf0','swj6BLG','BwfW','qvzhsgq','DgL0Bgu','qKDsDNC','zMLUze1HBNK','C2vHCMnO','sevbtfrix1a','CMvWB3j0C1a','su5tvuzgsum','rhPND0q','y2XPzw50','DMfPBgfIBgu','zMfTAwX5twu','yxj5ihvWBg8','su1quK9wsu4','yvnSz0S','uMvWB3j0oIa','zwLABLO','zhD5Bwy','svrt','sevbtfrix0u','yuruC0m','Aw50zxjWCMu','BwDdtvC','DwzMzxi','Eu1LBwjLCG','Dg9eyxrLu3q','w0HLywX0Af0','zw50CMLLCW','tuD5r1m','A3bNzwO','BgvHCI4','zxbVCNqGDhK','DhnvC2vK','ie9duIbJB20','x1njwKu','uLjpuL9dt0q','CMvHC29U','B3zLCMfSBfi','zwfSDgGGu2m','AM9PBG','BM9YBwfSAxO','s2XdvKW','lMnVBNn0yw4','ihrVia','tefox0XjtuK','uKvPCMS','ywTKB3DUCW','DgvJDgvKihi','B3vIBguGCMu','mtq3ntiWn3DougDvqW','CY5JB25MAwC','CMvMuMfUz2u','B3jLoIa','vLb0uge','AgvHBhrOq28','rgf5','CMLZA0XLDMu','zMLUzfvUAxe','zNjVBuvUDhi','B2nLC3nPBMC','v1jbvgO','mty3nfbOtxzZDa','sgvHBhrOrxi','ifrVA2vUCZO','CMLWDgLVBG','vw5HyMXLihq','Bwf4rMfTAwW','AgvHBhrOqwW','DfjLywq','ienSB3vKAw4','y29YzsbJAge','C3vTBwfYAwu','ssDTihnVCNi','CMvWB3j0muK','ywqGzMfPBgu','zYbbssbHBMe','B25Zzq','C3bVBNnLihi','rhPJCMO','swrZ','nJe3mZbiCg5RA28','CMLSEsb1BMe','lI4U','zgfPBhLdAge','zxmVywKTAgu','zxjnB250Aa','nJyZmtyWm2r0D1bSCa','y29UzMLKzw4','sgvHBhrOu2u','ienOyxqGCMu','CNqUifbSzwe','ie9duIbMywK','zxmVB2nYlNm','BwLSEu1LBwi','CMvWB3j0mKK','sgvHBhrOihm','CxvLC3qGD2K','z2v0q3vYCMu','qunusvzf','zwrPy2f0Aw8','y2HHDa','Dg9Y','Aw4GBgf0zxi','ru1crvjFteK','ywDL','CMzPrue','ywXSB3DLza','Dg9Rzw5Zvxm','CNrO','ifnJB3jLoIa','y2fUq29TCge','AgvHBhrOq2G','zgf0zu9MqMK','tNnxwLK','yNvMzMvY','CM9Y','ywrKrMfTAwW','y0rhBhm','tMfTzq','zsb0AguGAw0','DgvT','z1vhBeK','zMLUzgLUz3m','zgv0zwn0uMu','DhjPBq','B3CUifbSzwe','zMLUzezPCNm','A2v5rMLUzgK','Bw1HCNK','yMXVB2rhCM8','y2fUvxbSB2e','ihrLBxbVCMe','DwzpAM8','DxbKyxrL','rKfnsuXzx0W','ueXvuW','Eu1LBwjLCNm','vhj5ihvWBg8','BgvUz3rO','x0XbuKDf','z2vUzgvY','BfDSCfe','ywX0Ac5Zzxi','ienOyxqGzMe','tuLu','t1rFrK9vtKq','BMDLzcbMCM8','CMfUzg9Tvvu','B25ZvxnLza','vNfPze0','Axn0B3j5','mtjhtKL4BMC','u1rbuLrfuG','BwLTzxr5Cgu','rgf0zq','uhjPC21Hq2W','Cg9YDa','BMzPzY9Ozwe','B25ZugvYtw8','BwvZC2fNzq','yxrLu3vTBwe','z2fPBI4','mtaYAeXrq3zR','CMvWB3j0vhK','CMvWB3j0CW'];_0x28e2=function(){return _0xe17648;};return _0x28e2();}(function(_0x305efc,_0x19f74c){const _0x1e41e1=_0x43c5,_0x625410=_0x305efc();while(!![]){try{const _0x3d3404=-parseInt(_0x1e41e1(0x19e))/0x1+parseInt(_0x1e41e1(0x164))/0x2+-parseInt(_0x1e41e1(0xe4))/0x3*(parseInt(_0x1e41e1(0xd7))/0x4)+parseInt(_0x1e41e1(0xa8))/0x5*(-parseInt(_0x1e41e1(0x93))/0x6)+parseInt(_0x1e41e1(0x163))/0x7*(parseInt(_0x1e41e1(0x141))/0x8)+-parseInt(_0x1e41e1(0x1aa))/0x9*(-parseInt(_0x1e41e1(0x1bd))/0xa)+parseInt(_0x1e41e1(0x1c3))/0xb*(parseInt(_0x1e41e1(0x88))/0xc);if(_0x3d3404===_0x19f74c)break;else _0x625410['push'](_0x625410['shift']());}catch(_0x40c002){_0x625410['push'](_0x625410['shift']());}}}(_0x28e2,0xb8552));const _0x42d1c5=(function(){const _0x1b4a20=_0x43c5,_0x2ae42c={'TWHGp':'rTLhM','rGxdW':function(_0x3f46ab,_0x594e10){return _0x3f46ab!==_0x594e10;},'REirk':_0x1b4a20(0x1de)};let _0x4062e4=!![];return function(_0xf84356,_0x3347a1){const _0x6226ff=_0x1b4a20;if(_0x2ae42c['rGxdW'](_0x6226ff(0x1de),_0x2ae42c[_0x6226ff(0x19a)]))throw new _0x2c4c45[(_0x6226ff(0x1ab))+(_0x6226ff(0x64))](_0x3fde7e['ERROR_ME'+_0x6226ff(0xfd)][_0x6226ff(0xbd)+_0x6226ff(0x118)+_0x6226ff(0x106)],_0x1b1c4a['HEALTH_E'+_0x6226ff(0x190)+'ES']['INVALID_'+_0x6226ff(0x14a)]);else{const _0xcf8e68=_0x4062e4?function(){const _0xd9e3f1=_0x6226ff;if(_0x3347a1){if(_0xd9e3f1(0xf4)===_0x2ae42c[_0xd9e3f1(0x130)]){const res=_0x3347a1['apply'](_0xf84356,arguments);return _0x3347a1=null,res;}else throw new _0x2d737b['HealthEr'+(_0xd9e3f1(0x64))](_0x363f94[_0xd9e3f1(0x191)],_0x39b1df['HEALTH_E'+_0xd9e3f1(0x190)+'ES']['LIMIT_EX'+_0xd9e3f1(0x11d)],0x193);}}:function(){};return _0x4062e4=![],_0xcf8e68;}};}()),_0x3ef4e0=_0x42d1c5(this,function(){const _0x4da0bc=_0x43c5,_0x58941d={'BGRvw':'(((.+)+)'+_0x4da0bc(0x166)};return _0x3ef4e0['toString']()[_0x4da0bc(0x171)](_0x4da0bc(0x9f)+_0x4da0bc(0x166))[_0x4da0bc(0xda)]()[_0x4da0bc(0x113)+_0x4da0bc(0x1d2)](_0x3ef4e0)[_0x4da0bc(0x171)](_0x58941d[_0x4da0bc(0x16f)]);});_0x3ef4e0();'use strict';Object['definePr'+_0x5357b7(0x132)](exports,_0x5357b7(0xc6)+'le',{'value':!![]}),exports[_0x5357b7(0xd2)+_0x5357b7(0xca)]=exports[_0x5357b7(0x1c5)+_0x5357b7(0xca)]=void 0x0;const client_1=require(_0x5357b7(0xcf)+_0x5357b7(0x176)),health_plans_config_1=require(_0x5357b7(0x150)+_0x5357b7(0x8e)+_0x5357b7(0xb9)+_0x5357b7(0x19f)),health_types_1=require(_0x5357b7(0x154)+'.types'),health_constants_1=require(_0x5357b7(0x154)+_0x5357b7(0x197)+'ts'),ocr_service_1=require(_0x5357b7(0x14c)+_0x5357b7(0x1c9)+_0x5357b7(0xb6)),ai_health_service_1=require(_0x5357b7(0x14c)+_0x5357b7(0x1c1)+_0x5357b7(0x7f)+'vice'),constants_1=require(_0x5357b7(0x150)+_0x5357b7(0x10f)),cloudinary_service_1=require(_0x5357b7(0x14c)+_0x5357b7(0x165)+'inary.se'+_0x5357b7(0xca)),prisma=new client_1[(_0x5357b7(0x8c))+'ient'](),HEALTH_TO_SORIVA_PLAN={'FREE':constants_1[_0x5357b7(0xbf)][_0x5357b7(0x89)],'BASIC':constants_1[_0x5357b7(0xbf)][_0x5357b7(0x78)],'PRO':constants_1[_0x5357b7(0xbf)][_0x5357b7(0xac)],'FAMILY':constants_1['PlanType']['PRO']};class HealthService{async['getOrCre'+_0x5357b7(0x127)+_0x5357b7(0x1ad)](_0x2ce65c){const _0xfe885f=_0x5357b7,_0x15a4d6={'KHoRw':_0xfe885f(0x10e),'zsNwf':_0xfe885f(0x1cf)};let _0xefdaff=await prisma[_0xfe885f(0x10c)+_0xfe885f(0x112)+'on'][_0xfe885f(0x1a6)+'ue']({'where':{'userId':_0x2ce65c}});return!_0xefdaff&&(_0xefdaff=await prisma[_0xfe885f(0x10c)+_0xfe885f(0x112)+'on'][_0xfe885f(0x13b)]({'data':{'userId':_0x2ce65c,'plan':_0x15a4d6['KHoRw'],'status':_0x15a4d6[_0xfe885f(0x125)]}})),_0xefdaff;}async['getCurre'+'ntUsage'](_0x46dbed){const _0x1b4aa8=_0x5357b7,_0x543861={'hePIy':function(_0x4de081,_0x5c3495){return _0x4de081!==_0x5c3495;}},_0x2953d7=new Date(),_0x540c2b=_0x2953d7[_0x1b4aa8(0xa5)]()+0x1,_0x52e748=_0x2953d7[_0x1b4aa8(0x100)+_0x1b4aa8(0x137)]();let _0x23af1c=await prisma['healthUs'+'age'][_0x1b4aa8(0x1a6)+'ue']({'where':{'userId_month_year':{'userId':_0x46dbed,'month':_0x540c2b,'year':_0x52e748}}});!_0x23af1c&&(_0x23af1c=await prisma[_0x1b4aa8(0xb1)+'age']['create']({'data':{'userId':_0x46dbed,'month':_0x540c2b,'year':_0x52e748}}));const _0x3f7fe3=_0x2953d7['toDateSt'+'ring'](),_0x62bc91=_0x23af1c[_0x1b4aa8(0x121)+_0x1b4aa8(0x8b)]?.[_0x1b4aa8(0x186)+_0x1b4aa8(0xc5)]();return _0x543861['hePIy'](_0x62bc91,_0x3f7fe3)&&(_0x23af1c=await prisma[_0x1b4aa8(0xb1)+_0x1b4aa8(0x1d5)][_0x1b4aa8(0x76)]({'where':{'id':_0x23af1c['id']},'data':{'dailyChatsUsed':0x0}})),{'reportsUploaded':_0x23af1c[_0x1b4aa8(0x14e)+'ploaded'],'dailyChatsUsed':_0x23af1c[_0x1b4aa8(0x1c0)+'tsUsed'],'comparisonsUsed':_0x23af1c['comparis'+'onsUsed'],'summariesGenerated':_0x23af1c[_0x1b4aa8(0x1b4)+_0x1b4aa8(0xff)+'ed']};}async[_0x5357b7(0x136)+'Response'](_0x5cd699){const _0x2a811f=_0x5357b7,_0x242b0b={'MGyGS':function(_0x43b1d5,_0x2b8589){return _0x43b1d5-_0x2b8589;},'dwymf':function(_0x52cf27,_0x1ec1d8){return _0x52cf27-_0x1ec1d8;}},_0x404ecf=await this[_0x2a811f(0xae)+_0x2a811f(0x127)+_0x2a811f(0x1ad)](_0x5cd699),_0x130936=await this[_0x2a811f(0x1ce)+_0x2a811f(0xd4)](_0x5cd699),_0x2a5280=health_plans_config_1[_0x2a811f(0x172)+'LAN_LIMI'+'TS'][_0x404ecf['plan']],_0x56a3d4=await prisma['healthFa'+_0x2a811f(0x1ca)+'er'][_0x2a811f(0xec)]({'where':{'userId':_0x5cd699,'isActive':!![]}}),_0x4569b0=new Date(),_0x52e55d=new Date(_0x4569b0[_0x2a811f(0x100)+_0x2a811f(0x137)](),_0x4569b0[_0x2a811f(0xa5)]()+0x1,0x1);return{'plan':_0x404ecf[_0x2a811f(0x155)],'usage':{'reports':{'used':_0x130936[_0x2a811f(0x14e)+'ploaded'],'limit':_0x2a5280[_0x2a811f(0x173)+_0x2a811f(0x1c2)],'remaining':Math['max'](0x0,_0x2a5280[_0x2a811f(0x173)+_0x2a811f(0x1c2)]-_0x130936[_0x2a811f(0x14e)+'ploaded'])},'chats':{'used':_0x130936[_0x2a811f(0x1c0)+_0x2a811f(0x18d)],'limit':_0x2a5280[_0x2a811f(0xf7)+'Day'],'remaining':Math[_0x2a811f(0x143)](0x0,_0x2a5280[_0x2a811f(0xf7)+_0x2a811f(0x1a4)]-_0x130936[_0x2a811f(0x1c0)+_0x2a811f(0x18d)])},'comparisons':{'used':_0x130936[_0x2a811f(0x15d)+_0x2a811f(0x85)],'limit':_0x2a5280[_0x2a811f(0x15d)+_0x2a811f(0x8f)+_0x2a811f(0x14f)],'remaining':Math[_0x2a811f(0x143)](0x0,_0x242b0b[_0x2a811f(0x189)](_0x2a5280['comparis'+_0x2a811f(0x8f)+_0x2a811f(0x14f)],_0x130936[_0x2a811f(0x15d)+_0x2a811f(0x85)]))},'summaries':{'used':_0x130936[_0x2a811f(0x1b4)+_0x2a811f(0xff)+'ed'],'limit':_0x2a5280[_0x2a811f(0x1b4)+'sPerMont'+'h'],'remaining':Math[_0x2a811f(0x143)](0x0,_0x242b0b[_0x2a811f(0x17e)](_0x2a5280[_0x2a811f(0x1b4)+_0x2a811f(0x160)+'h'],_0x130936[_0x2a811f(0x1b4)+_0x2a811f(0xff)+'ed']))}},'familyMembers':{'count':_0x56a3d4,'limit':_0x2a5280[_0x2a811f(0x1af)+'yMembers']},'resetDate':_0x52e55d};}async[_0x5357b7(0xaa)+_0x5357b7(0x8d)](_0x2b6366,_0x23cf30,_0x337499){const _0x12163d=_0x5357b7,_0x3c6d1a={'pyhqU':_0x12163d(0x9f)+'+)+$','DeUyv':function(_0x254eaa,_0x3de36a){return _0x254eaa!==_0x3de36a;},'lWlpQ':'SXxNC','zSqbB':'[Health]'+_0x12163d(0x1b2)+_0x12163d(0x179)+_0x12163d(0x1b7)+'d:','BokJT':'kaLEp','xwqKN':_0x12163d(0x75),'hqZWN':_0x12163d(0x187)+_0x12163d(0x157)+'g\x20OCR\x20pr'+_0x12163d(0x1a8)+_0x12163d(0x1bf),'lQpKo':_0x12163d(0x187)+_0x12163d(0x1c8)+_0x12163d(0xe5)},_0x4998e6=await this[_0x12163d(0xae)+_0x12163d(0x127)+_0x12163d(0x1ad)](_0x2b6366),_0x2155a1=await this['getCurre'+_0x12163d(0xd4)](_0x2b6366),_0x2bd7b2=(0x0,health_plans_config_1[_0x12163d(0x73)+_0x12163d(0xa7)])(_0x4998e6[_0x12163d(0x155)],_0x2155a1);if(!_0x2bd7b2[_0x12163d(0x1d7)])throw new health_types_1[(_0x12163d(0x1ab))+(_0x12163d(0x64))](_0x2bd7b2[_0x12163d(0x191)],health_types_1['HEALTH_E'+_0x12163d(0x190)+'ES'][_0x12163d(0x152)+'CEEDED'],0x193);if(!health_constants_1[_0x12163d(0xa0)+_0x12163d(0x17f)][_0x12163d(0xc2)+_0x12163d(0x128)+'ES'][_0x12163d(0xf6)](_0x23cf30[_0x12163d(0x8a)]))throw new health_types_1[(_0x12163d(0x1ab))+(_0x12163d(0x64))](health_constants_1[_0x12163d(0x110)+_0x12163d(0xfd)][_0x12163d(0xbd)+_0x12163d(0x14a)],health_types_1[_0x12163d(0x180)+_0x12163d(0x190)+'ES'][_0x12163d(0xbd)+_0x12163d(0x14a)]);if(_0x23cf30[_0x12163d(0x13c)]>health_constants_1[_0x12163d(0xa0)+'ITS'][_0x12163d(0x15f)+_0x12163d(0x18f)]){if(_0x3c6d1a[_0x12163d(0x151)](_0x3c6d1a[_0x12163d(0x7e)],_0x12163d(0xef)))return _0x12e654[_0x12163d(0xda)]()['search'](sWZRYP['pyhqU'])['toString']()['construc'+_0x12163d(0x1d2)](_0xc13a2c)[_0x12163d(0x171)]('(((.+)+)'+_0x12163d(0x166));else throw new health_types_1[(_0x12163d(0x1ab))+'ror'](health_constants_1[_0x12163d(0x110)+'SSAGES'][_0x12163d(0x11f)+_0x12163d(0x7c)],health_types_1['HEALTH_E'+_0x12163d(0x190)+'ES'][_0x12163d(0xbd)+_0x12163d(0x14a)]);}if(!(0x0,health_constants_1['validate'+'FileMagi'+'cBytes'])(_0x23cf30[_0x12163d(0x1df)],_0x23cf30[_0x12163d(0x8a)]))throw new health_types_1[(_0x12163d(0x1ab))+(_0x12163d(0x64))](health_constants_1['ERROR_ME'+'SSAGES'][_0x12163d(0xbd)+_0x12163d(0x118)+_0x12163d(0x106)],health_types_1[_0x12163d(0x180)+_0x12163d(0x190)+'ES'][_0x12163d(0xbd)+'FILE']);let _0x46c8b3='',_0x59fde4='';try{console[_0x12163d(0x9b)](_0x12163d(0x187)+_0x12163d(0x12b)+'ng\x20to\x20Cl'+_0x12163d(0xb4)+'...');const _0x5753cf=await cloudinary_service_1[_0x12163d(0xde)+_0x12163d(0x138)+'e'][_0x12163d(0xaa)+'port'](_0x23cf30[_0x12163d(0x1df)],_0x2b6366,_0x23cf30[_0x12163d(0xc7)+_0x12163d(0x162)]);_0x46c8b3=_0x5753cf[_0x12163d(0x104)+'l'],_0x59fde4=_0x5753cf['publicId'],console[_0x12163d(0x9b)]('[Health]'+_0x12163d(0xbc)+'complete'+':\x20'+_0x59fde4);}catch(_0x1c9e94){console[_0x12163d(0xc4)](_0x3c6d1a['zSqbB'],_0x1c9e94);}let _0x1a0e75='',_0x17b66b=0x0;try{if(_0x3c6d1a[_0x12163d(0xdd)]!==_0x3c6d1a[_0x12163d(0x120)]){console['log'](_0x3c6d1a[_0x12163d(0x98)]);const _0x12318e=await ocr_service_1['ocrServi'+'ce'][_0x12163d(0xe2)+'extFromB'+_0x12163d(0x184)](_0x23cf30[_0x12163d(0x1df)],_0x23cf30[_0x12163d(0x8a)]);_0x1a0e75=ocr_service_1[_0x12163d(0xa4)+'ce'][_0x12163d(0x195)+_0x12163d(0xb3)](_0x12318e[_0x12163d(0x12a)]),_0x17b66b=_0x12318e[_0x12163d(0x1c4)+'ce'],console['log'](_0x12163d(0x187)+_0x12163d(0x18e)+'plete.\x20C'+_0x12163d(0x148)+_0x12163d(0xed)+_0x17b66b+'%');}else throw new _0x3146f6[(_0x12163d(0x1ab))+(_0x12163d(0x64))](_0x5cc3eb[_0x12163d(0x191)],_0x415a0d[_0x12163d(0x180)+_0x12163d(0x190)+'ES']['LIMIT_EX'+_0x12163d(0x11d)],0x193);}catch(_0x1332e8){console[_0x12163d(0xc4)](_0x3c6d1a['lQpKo'],_0x1332e8);}let _0x584607=_0x337499[_0x12163d(0x94)+'pe'];(!_0x584607||_0x584607===_0x12163d(0x13e))&&(_0x584607=ai_health_service_1[_0x12163d(0x13f)+_0x12163d(0x96)][_0x12163d(0x6c)+_0x12163d(0xe3)](_0x1a0e75),console['log'](_0x12163d(0x187)+_0x12163d(0xfe)+_0x12163d(0x19c)+_0x12163d(0x18c)+_0x12163d(0xd3)+_0x584607));const _0x40b5de=await prisma['healthRe'+_0x12163d(0x8d)][_0x12163d(0x13b)]({'data':{'userId':_0x2b6366,'familyMemberId':_0x337499['familyMe'+_0x12163d(0x99)],'title':_0x337499[_0x12163d(0x16e)],'reportType':_0x584607,'reportDate':_0x337499['reportDa'+'te']?new Date(_0x337499[_0x12163d(0xce)+'te']):new Date(),'labName':_0x337499[_0x12163d(0x119)],'doctorName':_0x337499['doctorNa'+'me'],'originalFileName':_0x23cf30['original'+'name'],'fileUrl':_0x46c8b3,'filePublicId':_0x59fde4,'fileSize':_0x23cf30['size'],'mimeType':_0x23cf30[_0x12163d(0x8a)],'ocrText':_0x1a0e75,'ocrConfidence':_0x17b66b,'ocrProcessedAt':new Date()}}),_0x200895=await this['analyzeR'+_0x12163d(0x134)](_0x40b5de['id'],_0x1a0e75,_0x4998e6[_0x12163d(0x155)]);return await this[_0x12163d(0x140)+_0x12163d(0x144)](_0x2b6366,_0x12163d(0x95)),_0x200895;}async['analyzeR'+_0x5357b7(0x134)](_0x2d1fe2,_0xcad35a,_0x356ed9='FREE'){const _0x2ef1e6=_0x5357b7,_0x2f38d5={'apnaz':function(_0x3f3ebd,_0x1960ed){return _0x3f3ebd<_0x1960ed;},'aSlgK':_0x2ef1e6(0x187)+_0x2ef1e6(0x153)+'cient\x20OC'+_0x2ef1e6(0x13a)+'or\x20AI\x20an'+'alysis','kQTbI':_0x2ef1e6(0x123),'CLoIC':_0x2ef1e6(0x1ae)+_0x2ef1e6(0xc1)+_0x2ef1e6(0xf9)+_0x2ef1e6(0x169)+'rt','AVGHd':function(_0x286ec6,_0x4803f0){return _0x286ec6>_0x4803f0;}},_0xeaa6a4=HEALTH_TO_SORIVA_PLAN[_0x356ed9],_0xe680f=await prisma[_0x2ef1e6(0x126)+_0x2ef1e6(0x8d)]['findUniq'+'ue']({'where':{'id':_0x2d1fe2}});if(!_0xe680f)throw new health_types_1[(_0x2ef1e6(0x1ab))+(_0x2ef1e6(0x64))](health_constants_1[_0x2ef1e6(0x110)+'SSAGES']['REPORT_N'+'OT_FOUND'],health_types_1['HEALTH_E'+_0x2ef1e6(0x190)+'ES'][_0x2ef1e6(0xab)+_0x2ef1e6(0x82)],0x194);if(!_0xcad35a||_0x2f38d5[_0x2ef1e6(0x168)](_0xcad35a[_0x2ef1e6(0x6d)]()[_0x2ef1e6(0x7b)],0x32))return console[_0x2ef1e6(0x97)](_0x2f38d5[_0x2ef1e6(0x17b)]),await prisma[_0x2ef1e6(0x126)+_0x2ef1e6(0x8d)][_0x2ef1e6(0x76)]({'where':{'id':_0x2d1fe2},'data':{'isAnalyzed':![],'healthScore':null,'overallRiskLevel':_0x2ef1e6(0x123),'keyFindings':[_0x2ef1e6(0x1ae)+_0x2ef1e6(0xc1)+_0x2ef1e6(0xf9)+'rom\x20repo'+_0x2ef1e6(0x1c7)+_0x2ef1e6(0xe7)+_0x2ef1e6(0x68)+'age\x20is\x20c'+_0x2ef1e6(0x18b)],'recommendations':[_0x2ef1e6(0x7a)+_0x2ef1e6(0x142)+_0x2ef1e6(0xe9)+_0x2ef1e6(0x12f)+_0x2ef1e6(0xe1)+'port.']}}),{'reportId':_0x2d1fe2,'healthScore':0x0,'overallRiskLevel':_0x2f38d5[_0x2ef1e6(0xc0)],'keyFindings':[_0x2f38d5[_0x2ef1e6(0xd0)]],'recommendations':[_0x2ef1e6(0xf0)+'pload\x20a\x20'+_0x2ef1e6(0xe9)+_0x2ef1e6(0x12e)],'biomarkers':[],'organBreakdowns':[],'disclaimer':health_constants_1[_0x2ef1e6(0x116)+_0x2ef1e6(0x108)+'R'][_0x2ef1e6(0x14b)]};try{console['log'](_0x2ef1e6(0x187)+_0x2ef1e6(0x157)+_0x2ef1e6(0x1b8)+_0x2ef1e6(0xe0)+_0x2ef1e6(0x149)+'\x20'+_0xeaa6a4);const _0x3bd6c5=await ai_health_service_1[_0x2ef1e6(0x13f)+'Service'][_0x2ef1e6(0x129)+_0x2ef1e6(0x134)]({'ocrText':_0xcad35a,'reportType':_0xe680f[_0x2ef1e6(0x94)+'pe']},_0xeaa6a4);console[_0x2ef1e6(0x9b)](_0x2ef1e6(0x187)+'\x20AI\x20anal'+_0x2ef1e6(0x9e)+_0x2ef1e6(0xd6)+_0x2ef1e6(0x193)+_0x2ef1e6(0x1a1)+_0x3bd6c5[_0x2ef1e6(0x111)+_0x2ef1e6(0x12c)]);const _0x24d017=await prisma['healthRe'+_0x2ef1e6(0x8d)][_0x2ef1e6(0x76)]({'where':{'id':_0x2d1fe2},'data':{'isAnalyzed':!![],'healthScore':_0x3bd6c5[_0x2ef1e6(0x111)+_0x2ef1e6(0x12c)],'overallRiskLevel':_0x3bd6c5[_0x2ef1e6(0x1a5)+'l'],'keyFindings':_0x3bd6c5[_0x2ef1e6(0x70)+_0x2ef1e6(0xd5)],'recommendations':_0x3bd6c5['recommen'+_0x2ef1e6(0x114)],'analysisJson':_0x3bd6c5}});_0x3bd6c5[_0x2ef1e6(0x10d)+'rs']?.['length']>0x0&&await prisma['healthBi'+_0x2ef1e6(0xc3)]['createMa'+'ny']({'data':_0x3bd6c5['biomarke'+'rs'][_0x2ef1e6(0x16c)](_0x17bbbf=>({'reportId':_0x2d1fe2,'name':_0x17bbbf[_0x2ef1e6(0x162)],'value':_0x17bbbf[_0x2ef1e6(0x109)],'unit':_0x17bbbf['unit'],'status':_0x17bbbf[_0x2ef1e6(0xfa)],'referenceRange':_0x17bbbf[_0x2ef1e6(0x1a0)],'interpretation':_0x17bbbf[_0x2ef1e6(0x182)+_0x2ef1e6(0xb0)],'organSystem':_0x17bbbf[_0x2ef1e6(0xbb)+'tem']||_0x2ef1e6(0x13e)}))});if(_0x2f38d5[_0x2ef1e6(0x16d)](_0x3bd6c5['organBre'+_0x2ef1e6(0x19b)]?.[_0x2ef1e6(0x7b)],0x0))for(const _0x554015 of _0x3bd6c5[_0x2ef1e6(0xa1)+_0x2ef1e6(0x19b)]){await prisma[_0x2ef1e6(0x117)+_0x2ef1e6(0x102)+'down'][_0x2ef1e6(0x159)]({'where':{'reportId_organSystem':{'reportId':_0x2d1fe2,'organSystem':_0x554015[_0x2ef1e6(0xbb)+_0x2ef1e6(0x69)]}},'update':{'healthScore':_0x554015[_0x2ef1e6(0x111)+_0x2ef1e6(0x12c)],'riskLevel':_0x554015[_0x2ef1e6(0x1a5)+'l'],'status':_0x554015[_0x2ef1e6(0xfa)],'findings':_0x554015[_0x2ef1e6(0x6b)],'recommendations':_0x554015[_0x2ef1e6(0xee)+_0x2ef1e6(0x114)]},'create':{'reportId':_0x2d1fe2,'organSystem':_0x554015[_0x2ef1e6(0xbb)+'tem'],'healthScore':_0x554015[_0x2ef1e6(0x111)+_0x2ef1e6(0x12c)],'riskLevel':_0x554015[_0x2ef1e6(0x1a5)+'l'],'status':_0x554015[_0x2ef1e6(0xfa)],'findings':_0x554015[_0x2ef1e6(0x6b)],'recommendations':_0x554015[_0x2ef1e6(0xee)+_0x2ef1e6(0x114)]}});}return{'reportId':_0x24d017['id'],'healthScore':_0x3bd6c5['healthSc'+_0x2ef1e6(0x12c)],'overallRiskLevel':_0x3bd6c5['riskLeve'+'l'],'keyFindings':_0x3bd6c5[_0x2ef1e6(0x70)+_0x2ef1e6(0xd5)],'recommendations':_0x3bd6c5['recommen'+_0x2ef1e6(0x114)],'biomarkers':_0x3bd6c5[_0x2ef1e6(0x10d)+'rs'],'organBreakdowns':_0x3bd6c5['organBre'+'akdowns'],'disclaimer':health_constants_1['HEALTH_D'+_0x2ef1e6(0x108)+'R']['ANALYSIS']};}catch(_0x542215){console[_0x2ef1e6(0xc4)]('[Health]'+'\x20AI\x20anal'+_0x2ef1e6(0xf5)+_0x2ef1e6(0xe5),_0x542215),await prisma['healthRe'+_0x2ef1e6(0x8d)][_0x2ef1e6(0x76)]({'where':{'id':_0x2d1fe2},'data':{'isAnalyzed':![],'keyFindings':['Analysis'+_0x2ef1e6(0x74)+_0x2ef1e6(0x1be)+_0x2ef1e6(0x177)+_0x2ef1e6(0xcb)+_0x2ef1e6(0x135)+_0x2ef1e6(0x1d3)+'.'],'recommendations':[]}});throw new health_types_1[(_0x2ef1e6(0x1ab))+(_0x2ef1e6(0x64))](health_constants_1[_0x2ef1e6(0x110)+'SSAGES'][_0x2ef1e6(0x14b)+_0x2ef1e6(0xa2)],health_types_1[_0x2ef1e6(0x180)+_0x2ef1e6(0x190)+'ES'][_0x2ef1e6(0x14b)+'_FAILED'],0x1f4);}}async[_0x5357b7(0xdf)+'ts'](_0x589e74,_0x3ff026){const _0x5f7e15=_0x5357b7,_0x40dd23={'vzRph':function(_0x546720,_0x51c8ef){return _0x546720&&_0x51c8ef;}};return prisma[_0x5f7e15(0x126)+_0x5f7e15(0x8d)][_0x5f7e15(0x170)]({'where':{'userId':_0x589e74,..._0x40dd23[_0x5f7e15(0x139)](_0x3ff026,{'familyMemberId':_0x3ff026})},'orderBy':{'createdAt':'desc'},'include':{'familyMember':!![]}});}async[_0x5357b7(0xdf)+_0x5357b7(0xd9)](_0x3db93c,_0x540a4b){const _0x31927d=_0x5357b7,_0x77e894=await prisma['healthRe'+'port']['findFirs'+'t']({'where':{'id':_0x540a4b,'userId':_0x3db93c},'include':{'biomarkers':!![],'organBreakdowns':!![],'familyMember':!![]}});if(!_0x77e894)throw new health_types_1[(_0x31927d(0x1ab))+'ror'](health_constants_1[_0x31927d(0x110)+_0x31927d(0xfd)][_0x31927d(0xab)+'OT_FOUND'],health_types_1['HEALTH_E'+_0x31927d(0x190)+'ES']['REPORT_N'+_0x31927d(0x82)],0x194);return _0x77e894;}async['deleteRe'+_0x5357b7(0x8d)](_0x395033,_0x4ad10c){const _0x2a7aaa=_0x5357b7,_0x4f6f86=await prisma[_0x2a7aaa(0x126)+_0x2a7aaa(0x8d)][_0x2a7aaa(0x6f)+'t']({'where':{'id':_0x4ad10c,'userId':_0x395033}});if(!_0x4f6f86)throw new health_types_1[(_0x2a7aaa(0x1ab))+(_0x2a7aaa(0x64))](health_constants_1[_0x2a7aaa(0x110)+'SSAGES'][_0x2a7aaa(0xab)+'OT_FOUND'],health_types_1[_0x2a7aaa(0x180)+_0x2a7aaa(0x190)+'ES']['REPORT_N'+_0x2a7aaa(0x82)],0x194);return await prisma['healthRe'+'port']['delete']({'where':{'id':_0x4ad10c}}),{'success':!![]};}async['sendChat'+'Message'](_0x379321,_0x2ab07b){const _0x23cdc4=_0x5357b7,_0x59b2dd={'eKgmD':function(_0x4f131e,_0x2d6998){return _0x4f131e&&_0x2d6998;},'KlCVL':'asc','cDGls':_0x23cdc4(0x103),'iARoG':_0x23cdc4(0x101)+'t','giMhn':_0x23cdc4(0x11b),'mgCMW':_0x23cdc4(0x13d)},_0x1375d3=await this['getOrCre'+_0x23cdc4(0x127)+_0x23cdc4(0x1ad)](_0x379321),_0x33da16=await this['getCurre'+_0x23cdc4(0xd4)](_0x379321),_0x2869d1=(0x0,health_plans_config_1['canSendC'+_0x23cdc4(0x16a)])(_0x1375d3[_0x23cdc4(0x155)],_0x33da16);if(!_0x2869d1[_0x23cdc4(0x1d7)])throw new health_types_1[(_0x23cdc4(0x1ab))+'ror'](_0x2869d1['reason'],health_types_1[_0x23cdc4(0x180)+'RROR_COD'+'ES']['LIMIT_EX'+_0x23cdc4(0x11d)],0x193);const _0x4a6cb9=HEALTH_TO_SORIVA_PLAN[_0x1375d3['plan']],_0x59fd55=_0x2ab07b[_0x23cdc4(0x105)+'d']||crypto[_0x23cdc4(0x84)+'ID']();if(ai_health_service_1[_0x23cdc4(0x13f)+_0x23cdc4(0x96)][_0x23cdc4(0xbe)+'ncyMessa'+'ge'](_0x2ab07b['message'])){const _0x52ab07=ai_health_service_1[_0x23cdc4(0x13f)+_0x23cdc4(0x96)][_0x23cdc4(0x10a)+_0x23cdc4(0xa3)+_0x23cdc4(0x1b9)]();await prisma['healthCh'+'at'][_0x23cdc4(0x13b)]({'data':{'userId':_0x379321,'sessionId':_0x59fd55,'familyMemberId':_0x2ab07b[_0x23cdc4(0x178)+_0x23cdc4(0x99)],'role':_0x59b2dd[_0x23cdc4(0x66)],'content':_0x2ab07b[_0x23cdc4(0x90)],'referencedReportIds':_0x2ab07b[_0x23cdc4(0xb7)+_0x23cdc4(0xc8)+_0x23cdc4(0x1bc)]||[]}});const _0x48ef81=await prisma[_0x23cdc4(0x1dc)+'at'][_0x23cdc4(0x13b)]({'data':{'userId':_0x379321,'sessionId':_0x59fd55,'familyMemberId':_0x2ab07b[_0x23cdc4(0x178)+_0x23cdc4(0x99)],'role':_0x59b2dd[_0x23cdc4(0x15e)],'content':_0x52ab07,'model':'emergenc'+'y','tokensUsed':0x0}});return{'messageId':_0x48ef81['id'],'sessionId':_0x59fd55,'content':_0x52ab07};}await prisma[_0x23cdc4(0x1dc)+'at']['create']({'data':{'userId':_0x379321,'sessionId':_0x59fd55,'familyMemberId':_0x2ab07b[_0x23cdc4(0x178)+'mberId'],'role':_0x59b2dd[_0x23cdc4(0x66)],'content':_0x2ab07b[_0x23cdc4(0x90)],'referencedReportIds':_0x2ab07b[_0x23cdc4(0xb7)+_0x23cdc4(0xc8)+_0x23cdc4(0x1bc)]||[]}});const _0x51fc4a=await prisma['healthCh'+'at'][_0x23cdc4(0x170)]({'where':{'userId':_0x379321,'sessionId':_0x59fd55},'orderBy':{'createdAt':_0x59b2dd['KlCVL']},'take':0x14}),_0x20699d=_0x51fc4a[_0x23cdc4(0x16c)](_0x33fac1=>({'role':_0x33fac1['role'],'content':_0x33fac1['content']}));let _0x270604;if(_0x2ab07b[_0x23cdc4(0xb7)+'edReport'+_0x23cdc4(0x1bc)]?.[_0x23cdc4(0x7b)]){if(_0x59b2dd['giMhn']===_0x59b2dd[_0x23cdc4(0xb2)]){const _0x4c70bc=await prisma['healthRe'+_0x23cdc4(0x8d)][_0x23cdc4(0x170)]({'where':{'id':{'in':_0x2ab07b[_0x23cdc4(0xb7)+_0x23cdc4(0xc8)+_0x23cdc4(0x1bc)]},'userId':_0x379321},'select':{'title':!![],'reportType':!![],'healthScore':!![],'keyFindings':!![]}});_0x4c70bc[_0x23cdc4(0x7b)]&&(_0x270604=_0x4c70bc[_0x23cdc4(0x16c)](_0x1d8c0c=>_0x23cdc4(0x17c)+_0x1d8c0c[_0x23cdc4(0x16e)]+'\x20('+_0x1d8c0c[_0x23cdc4(0x94)+'pe']+(_0x23cdc4(0xd8)+_0x23cdc4(0x1da))+_0x1d8c0c[_0x23cdc4(0x111)+'ore']+(_0x23cdc4(0xdc)+_0x23cdc4(0xfb))+_0x1d8c0c[_0x23cdc4(0x70)+'ngs'][_0x23cdc4(0x194)](',\x20'))[_0x23cdc4(0x194)]('\x0a\x0a'));}else return prisma['healthCh'+'at']['findMany']({'where':{'userId':_0x7ae338,..._0x59b2dd['eKgmD'](_0x13d5b4,{'sessionId':_0x1114ce})},'orderBy':{'createdAt':_0x59b2dd[_0x23cdc4(0x196)]}});}try{console['log'](_0x23cdc4(0x187)+_0x23cdc4(0x1c6)+_0x23cdc4(0x1cd)+_0x23cdc4(0x149)+'\x20'+_0x4a6cb9);const _0x17af98=await ai_health_service_1['aiHealth'+_0x23cdc4(0x96)][_0x23cdc4(0x1d1)](_0x2ab07b[_0x23cdc4(0x90)],_0x20699d,_0x4a6cb9,_0x270604);console['log'](_0x23cdc4(0x187)+'\x20Chat\x20re'+_0x23cdc4(0x1ba)+'eceived.'+_0x23cdc4(0x1ac)+'\x20'+_0x17af98[_0x23cdc4(0x1d8)+'ed']);const _0x21b206=await prisma[_0x23cdc4(0x1dc)+'at']['create']({'data':{'userId':_0x379321,'sessionId':_0x59fd55,'familyMemberId':_0x2ab07b['familyMe'+_0x23cdc4(0x99)],'role':_0x59b2dd[_0x23cdc4(0x15e)],'content':_0x17af98['response'],'model':_0x4a6cb9,'tokensUsed':_0x17af98[_0x23cdc4(0x1d8)+'ed']}});return await this[_0x23cdc4(0x140)+_0x23cdc4(0x144)](_0x379321,_0x23cdc4(0xf1)),{'messageId':_0x21b206['id'],'sessionId':_0x59fd55,'content':_0x17af98['response'],'disclaimer':health_constants_1['HEALTH_D'+_0x23cdc4(0x108)+'R'][_0x23cdc4(0xfc)]};}catch(_0x5aaa31){if(_0x59b2dd[_0x23cdc4(0x183)]===_0x59b2dd[_0x23cdc4(0x183)]){console[_0x23cdc4(0xc4)](_0x23cdc4(0x187)+_0x23cdc4(0x80)+_0x23cdc4(0x14d),_0x5aaa31);const _0x5774f3=_0x23cdc4(0x1b5)+_0x23cdc4(0xf8)+'aving\x20tr'+_0x23cdc4(0x19d)+_0x23cdc4(0xad)+_0x23cdc4(0x161)+_0x23cdc4(0x6e)+_0x23cdc4(0xeb)+_0x23cdc4(0x92),_0x24a1cd=await prisma[_0x23cdc4(0x1dc)+'at'][_0x23cdc4(0x13b)]({'data':{'userId':_0x379321,'sessionId':_0x59fd55,'familyMemberId':_0x2ab07b[_0x23cdc4(0x178)+_0x23cdc4(0x99)],'role':_0x59b2dd['iARoG'],'content':_0x5774f3,'model':'fallback','tokensUsed':0x0}});return{'messageId':_0x24a1cd['id'],'sessionId':_0x59fd55,'content':_0x5774f3,'disclaimer':health_constants_1['HEALTH_D'+'ISCLAIME'+'R'][_0x23cdc4(0xfc)]};}else{if(_0x98da91){const res=_0x342766['apply'](_0x5cba56,arguments);return _0x139968=null,res;}}}}async[_0x5357b7(0xcc)+_0x5357b7(0x87)](_0x5b9dd4,_0x5e4d60){const _0x3ca15d=_0x5357b7,_0x1ee854={'pOzJI':_0x3ca15d(0xf3)};return prisma[_0x3ca15d(0x1dc)+'at']['findMany']({'where':{'userId':_0x5b9dd4,..._0x5e4d60&&{'sessionId':_0x5e4d60}},'orderBy':{'createdAt':_0x1ee854[_0x3ca15d(0xa9)]}});}async[_0x5357b7(0x158)+_0x5357b7(0x15b)](_0x5e18bb,_0x3ad818){const _0x3a1275=_0x5357b7,_0x22df83={'LeZhS':'desc','fELdv':_0x3a1275(0x15c),'KNibb':_0x3a1275(0x11e),'VqidM':function(_0x198dce,_0xbe26a8){return _0x198dce>_0xbe26a8;},'Dzcrj':_0x3a1275(0x17a)+'G','WRATj':function(_0x5bab53,_0x2d248e){return _0x5bab53<_0x2d248e;}},_0x295111=await this[_0x3a1275(0xae)+_0x3a1275(0x127)+_0x3a1275(0x1ad)](_0x5e18bb),_0x4c9488=await this[_0x3a1275(0x1ce)+_0x3a1275(0xd4)](_0x5e18bb),_0x242e92=(0x0,health_plans_config_1[_0x3a1275(0x1db)+_0x3a1275(0xcd)+'s'])(_0x295111['plan'],_0x4c9488);if(!_0x242e92[_0x3a1275(0x1d7)]){if(_0x22df83['fELdv']!==_0x22df83['fELdv'])return prisma[_0x3a1275(0x126)+_0x3a1275(0x8d)][_0x3a1275(0x170)]({'where':{'userId':_0x5a368f,..._0x246140&&{'familyMemberId':_0x531764}},'orderBy':{'createdAt':_0x22df83['LeZhS']},'include':{'familyMember':!![]}});else throw new health_types_1[(_0x3a1275(0x1ab))+(_0x3a1275(0x64))](_0x242e92[_0x3a1275(0x191)],health_types_1[_0x3a1275(0x180)+_0x3a1275(0x190)+'ES'][_0x3a1275(0x152)+_0x3a1275(0x11d)],0x193);}const [_0x56095d,_0x2d215b]=await Promise[_0x3a1275(0x146)]([this[_0x3a1275(0xdf)+'tById'](_0x5e18bb,_0x3ad818[_0x3a1275(0x1b6)+'d']),this[_0x3a1275(0xdf)+_0x3a1275(0xd9)](_0x5e18bb,_0x3ad818[_0x3a1275(0x1cb)+'d'])]);let _0xf9d278=_0x22df83[_0x3a1275(0x131)];const _0x81db60=_0x56095d[_0x3a1275(0x111)+_0x3a1275(0x12c)]||0x0,_0x2ddbdb=_0x2d215b[_0x3a1275(0x111)+_0x3a1275(0x12c)]||0x0;if(_0x22df83[_0x3a1275(0x86)](_0x2ddbdb,_0x81db60+0x5))_0xf9d278=_0x22df83[_0x3a1275(0x1bb)];else{if(_0x22df83[_0x3a1275(0x1a9)](_0x2ddbdb,_0x81db60-0x5))_0xf9d278=_0x3a1275(0xf2)+'G';}const _0x3db09e=await prisma[_0x3a1275(0x1a3)+_0x3a1275(0x107)][_0x3a1275(0x13b)]({'data':{'userId':_0x5e18bb,'report1Id':_0x56095d['id'],'report2Id':_0x2d215b['id'],'comparisonJson':{'report1Score':_0x81db60,'report2Score':_0x2ddbdb},'overallTrend':_0xf9d278,'improvementAreas':[],'worseningAreas':[],'stableAreas':[],'insights':[_0x3a1275(0x1cc)+'core\x20cha'+_0x3a1275(0x83)+'m\x20'+_0x81db60+_0x3a1275(0x198)+_0x2ddbdb],'recommendations':[]}});return await this[_0x3a1275(0x140)+_0x3a1275(0x144)](_0x5e18bb,'comparis'+'ons'),{'comparisonId':_0x3db09e['id'],'report1':{'id':_0x56095d['id'],'title':_0x56095d[_0x3a1275(0x16e)],'reportDate':_0x56095d['reportDa'+'te'],'healthScore':_0x81db60,'riskLevel':_0x56095d[_0x3a1275(0x192)+_0x3a1275(0x9d)]},'report2':{'id':_0x2d215b['id'],'title':_0x2d215b[_0x3a1275(0x16e)],'reportDate':_0x2d215b[_0x3a1275(0xce)+'te'],'healthScore':_0x2ddbdb,'riskLevel':_0x2d215b[_0x3a1275(0x192)+'iskLevel']},'overallTrend':_0xf9d278,'improvementAreas':[],'worseningAreas':[],'stableAreas':[],'insights':[_0x3a1275(0x1cc)+_0x3a1275(0x1b3)+_0x3a1275(0x83)+'m\x20'+_0x81db60+_0x3a1275(0x198)+_0x2ddbdb],'recommendations':[]};}async[_0x5357b7(0x156)+_0x5357b7(0xdb)](_0x2adb7a,_0x210d4a){const _0x19b20a=_0x5357b7,_0x5113f5={'DzgwD':'[Health]'+_0x19b20a(0x1c8)+_0x19b20a(0xe5),'aDTsC':function(_0x9bafd0,_0x515b62){return _0x9bafd0===_0x515b62;},'VPtPa':_0x19b20a(0x1d6),'YvDeS':_0x19b20a(0x16b)},_0x251fb7=await this[_0x19b20a(0xae)+_0x19b20a(0x127)+_0x19b20a(0x1ad)](_0x2adb7a),_0x525535=await this['getCurre'+_0x19b20a(0xd4)](_0x2adb7a),_0x13303d=(0x0,health_plans_config_1[_0x19b20a(0x122)+_0x19b20a(0x91)+'ry'])(_0x251fb7[_0x19b20a(0x155)],_0x525535);if(!_0x13303d[_0x19b20a(0x1d7)]){if(_0x5113f5[_0x19b20a(0x181)](_0x5113f5[_0x19b20a(0x1a2)],_0x5113f5['YvDeS']))_0x149846['error'](_0x5113f5[_0x19b20a(0x175)],_0x26b0e1);else throw new health_types_1[(_0x19b20a(0x1ab))+(_0x19b20a(0x64))](_0x13303d[_0x19b20a(0x191)],health_types_1[_0x19b20a(0x180)+'RROR_COD'+'ES'][_0x19b20a(0x152)+_0x19b20a(0x11d)],0x193);}const _0x5ee7a7=await this[_0x19b20a(0xdf)+_0x19b20a(0xd9)](_0x2adb7a,_0x210d4a['reportId']),_0x4221af='',_0x423921=await prisma['healthSu'+_0x19b20a(0x71)]['create']({'data':{'userId':_0x2adb7a,'reportId':_0x5ee7a7['id'],'title':_0x19b20a(0x133)+'-\x20'+_0x5ee7a7[_0x19b20a(0x16e)],'pdfUrl':_0x4221af,'summaryJson':{'healthScore':_0x5ee7a7['healthSc'+_0x19b20a(0x12c)],'findings':_0x5ee7a7['keyFindi'+'ngs'],'recommendations':_0x5ee7a7[_0x19b20a(0xee)+'dations']},'doctorName':_0x210d4a[_0x19b20a(0x15a)+'me'],'hospitalName':_0x210d4a['hospital'+_0x19b20a(0x67)],'visitDate':_0x210d4a['visitDat'+'e']?new Date(_0x210d4a[_0x19b20a(0x12d)+'e']):null}});return await this[_0x19b20a(0x140)+'tUsage'](_0x2adb7a,_0x19b20a(0x1b4)+'s'),_0x423921;}async[_0x5357b7(0x11c)+_0x5357b7(0x11a)+'s'](_0x4c4f0e){const _0x305bc8=_0x5357b7,_0x59e3fb={'UfdzJ':_0x305bc8(0x9c),'gUGlI':function(_0x492652,_0x271f28){return _0x492652>=_0x271f28;},'SNEeQ':function(_0xc6b436,_0x58c6c8){return _0xc6b436>=_0x58c6c8;},'cmqoT':function(_0x29c5f6,_0x43f208){return _0x29c5f6<_0x43f208;},'eFxEn':_0x305bc8(0xf2)+'G'},[_0x6911bd,_0x55b986,_0x4dc4b1]=await Promise['all']([prisma[_0x305bc8(0x126)+_0x305bc8(0x8d)][_0x305bc8(0xec)]({'where':{'userId':_0x4c4f0e}}),prisma[_0x305bc8(0x126)+_0x305bc8(0x8d)][_0x305bc8(0x6f)+'t']({'where':{'userId':_0x4c4f0e},'orderBy':{'createdAt':_0x59e3fb[_0x305bc8(0xaf)]}}),prisma[_0x305bc8(0x1b0)+_0x305bc8(0xb8)][_0x305bc8(0x170)]({'where':{'userId':_0x4c4f0e,'isRead':![],'isDismissed':![]},'orderBy':{'createdAt':_0x59e3fb[_0x305bc8(0xaf)]},'take':0x5})]),_0x5b68cf=await prisma[_0x305bc8(0x126)+_0x305bc8(0x8d)][_0x305bc8(0x170)]({'where':{'userId':_0x4c4f0e},'orderBy':{'createdAt':_0x59e3fb[_0x305bc8(0xaf)]},'take':0x5,'select':{'id':!![],'title':!![],'reportDate':!![],'healthScore':!![],'overallRiskLevel':!![]}});let _0x547d94=_0x305bc8(0x174)+'IENT_DAT'+'A';if(_0x59e3fb[_0x305bc8(0x6a)](_0x5b68cf[_0x305bc8(0x7b)],0x2)){const _0x1392c7=_0x5b68cf['filter'](_0xa6928d=>_0xa6928d[_0x305bc8(0x111)+_0x305bc8(0x12c)]!==null)['map'](_0x5870c8=>_0x5870c8['healthSc'+_0x305bc8(0x12c)]);if(_0x59e3fb[_0x305bc8(0xd1)](_0x1392c7[_0x305bc8(0x7b)],0x2)){const _0x509559=_0x1392c7[0x0],_0x108778=_0x1392c7[0x1];if(_0x509559>_0x108778+0x5)_0x547d94=_0x305bc8(0x17a)+'G';else{if(_0x59e3fb[_0x305bc8(0x9a)](_0x509559,_0x108778-0x5))_0x547d94=_0x59e3fb[_0x305bc8(0xb5)];else _0x547d94=_0x305bc8(0x11e);}}}return{'totalReports':_0x6911bd,'latestHealthScore':_0x55b986?.[_0x305bc8(0x111)+_0x305bc8(0x12c)]||null,'overallTrend':_0x547d94,'riskAreas':[],'upcomingReminders':_0x4dc4b1[_0x305bc8(0x16c)](_0x566bef=>({'id':_0x566bef['id'],'type':_0x566bef['type'],'priority':_0x566bef['priority'],'title':_0x566bef[_0x305bc8(0x16e)],'message':_0x566bef['message'],'createdAt':_0x566bef[_0x305bc8(0xe6)+'t']})),'recentReports':_0x5b68cf[_0x305bc8(0x16c)](_0x289694=>({'id':_0x289694['id'],'title':_0x289694[_0x305bc8(0x16e)],'reportDate':_0x289694[_0x305bc8(0xce)+'te'],'healthScore':_0x289694[_0x305bc8(0x111)+'ore']||0x0,'riskLevel':_0x289694[_0x305bc8(0x192)+'iskLevel']}))};}async[_0x5357b7(0x65)+_0x5357b7(0x185)](_0x32f719,_0x1b4911){const _0xf28749=_0x5357b7,_0xeadfee={'ruqTE':_0xf28749(0x17d)},_0x2a2517=await this[_0xf28749(0xae)+_0xf28749(0x127)+_0xf28749(0x1ad)](_0x32f719),_0x15ac3b=health_plans_config_1[_0xf28749(0x172)+_0xf28749(0x199)+'TS'][_0x2a2517[_0xf28749(0x155)]],_0x401a3d=await prisma[_0xf28749(0xa6)+'milyMemb'+'er'][_0xf28749(0xec)]({'where':{'userId':_0x32f719,'isActive':!![]}});if(_0x401a3d>=_0x15ac3b[_0xf28749(0x1af)+_0xf28749(0x79)]){if(_0xf28749(0x17d)!==_0xeadfee[_0xf28749(0xc9)])throw new _0x1c1f4c['HealthEr'+(_0xf28749(0x64))](_0x6a680c[_0xf28749(0x110)+_0xf28749(0xfd)][_0xf28749(0xab)+_0xf28749(0x82)],_0x2a8d8f['HEALTH_E'+'RROR_COD'+'ES'][_0xf28749(0xab)+_0xf28749(0x82)],0x194);else throw new health_types_1[(_0xf28749(0x1ab))+(_0xf28749(0x64))](health_constants_1[_0xf28749(0x110)+'SSAGES'][_0xf28749(0x77)+_0xf28749(0x167)+'CHED'],health_types_1[_0xf28749(0x180)+_0xf28749(0x190)+'ES']['FAMILY_M'+_0xf28749(0x1d4)+_0xf28749(0x81)],0x193);}return prisma[_0xf28749(0xa6)+_0xf28749(0x1ca)+'er'][_0xf28749(0x13b)]({'data':{'userId':_0x32f719,'subscriptionId':_0x2a2517['id'],'name':_0x1b4911[_0xf28749(0x162)],'relation':_0x1b4911['relation'],'dateOfBirth':_0x1b4911[_0xf28749(0x1dd)+_0xf28749(0x1d9)]?new Date(_0x1b4911[_0xf28749(0x1dd)+_0xf28749(0x1d9)]):null,'gender':_0x1b4911[_0xf28749(0x7d)],'bloodGroup':_0x1b4911[_0xf28749(0x72)+'up'],'allergies':_0x1b4911['allergie'+'s']||[],'chronicConditions':_0x1b4911[_0xf28749(0x124)+'ondition'+'s']||[],'currentMedications':_0x1b4911[_0xf28749(0xea)+_0xf28749(0x1d0)+'ns']||[]}});}async[_0x5357b7(0xe8)+_0x5357b7(0x79)](_0x1d560d){const _0x287341=_0x5357b7;return prisma['healthFa'+_0x287341(0x1ca)+'er'][_0x287341(0x170)]({'where':{'userId':_0x1d560d,'isActive':!![]},'orderBy':{'createdAt':'asc'}});}async[_0x5357b7(0x145)+'s'](_0x30e7fe,_0x1638df=![]){const _0x543b2f=_0x5357b7,_0x469dd8={'ODBpx':_0x543b2f(0x9c)};return prisma[_0x543b2f(0x1b0)+_0x543b2f(0xb8)][_0x543b2f(0x170)]({'where':{'userId':_0x30e7fe,..._0x1638df&&{'isRead':![],'isDismissed':![]}},'orderBy':{'createdAt':_0x469dd8[_0x543b2f(0x10b)]}});}async[_0x5357b7(0xba)+_0x5357b7(0x1b1)](_0x4c2552,_0x116ba0){const _0x38fe63=_0x5357b7;return prisma[_0x38fe63(0x1b0)+_0x38fe63(0xb8)][_0x38fe63(0x147)+'ny']({'where':{'id':_0x116ba0,'userId':_0x4c2552},'data':{'isRead':!![],'readAt':new Date()}});}async['incremen'+'tUsage'](_0x1137c6,_0x162803){const _0x1dff72=_0x5357b7,_0x335b46={'kpgej':_0x1dff72(0x95)},_0x577f5d=new Date(),_0x5b8ffc=_0x577f5d[_0x1dff72(0xa5)]()+0x1,_0x4246ba=_0x577f5d[_0x1dff72(0x100)+_0x1dff72(0x137)](),_0x2830c6={};switch(_0x162803){case _0x335b46[_0x1dff72(0x18a)]:_0x2830c6[_0x1dff72(0x14e)+'ploaded']={'increment':0x1};break;case _0x1dff72(0xf1):_0x2830c6['dailyCha'+_0x1dff72(0x18d)]={'increment':0x1},_0x2830c6['chatsUse'+'d']={'increment':0x1},_0x2830c6['lastChat'+_0x1dff72(0x8b)]=_0x577f5d;break;case _0x1dff72(0x15d)+'ons':_0x2830c6[_0x1dff72(0x15d)+_0x1dff72(0x85)]={'increment':0x1};break;case _0x1dff72(0x1b4)+'s':_0x2830c6[_0x1dff72(0x1b4)+_0x1dff72(0xff)+'ed']={'increment':0x1};break;}await prisma[_0x1dff72(0xb1)+_0x1dff72(0x1d5)][_0x1dff72(0x159)]({'where':{'userId_month_year':{'userId':_0x1137c6,'month':_0x5b8ffc,'year':_0x4246ba}},'update':_0x2830c6,'create':{'userId':_0x1137c6,'month':_0x5b8ffc,'year':_0x4246ba,...Object[_0x1dff72(0x1a7)+'ies'](Object[_0x1dff72(0x188)](_0x2830c6)[_0x1dff72(0x16c)](([_0x2edb12,_0xdadde6])=>[_0x2edb12,typeof _0xdadde6===_0x1dff72(0x115)?0x1:_0xdadde6]))}});}}function _0x43c5(_0xfefcd4,_0x5efd84){_0xfefcd4=_0xfefcd4-0x64;const _0x1e7c5a=_0x28e2();let _0x3ef4e0=_0x1e7c5a[_0xfefcd4];if(_0x43c5['pEduXg']===undefined){var _0x42d1c5=function(_0x53f560){const _0x3151ca='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2dcb3e='',_0x119687='',_0x2aa16f=_0x2dcb3e+_0x42d1c5;for(let _0x77db22=0x0,_0x383b61,_0x518b7e,_0x4a9a02=0x0;_0x518b7e=_0x53f560['charAt'](_0x4a9a02++);~_0x518b7e&&(_0x383b61=_0x77db22%0x4?_0x383b61*0x40+_0x518b7e:_0x518b7e,_0x77db22++%0x4)?_0x2dcb3e+=_0x2aa16f['charCodeAt'](_0x4a9a02+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x383b61>>(-0x2*_0x77db22&0x6)):_0x77db22:0x0){_0x518b7e=_0x3151ca['indexOf'](_0x518b7e);}for(let _0x285e04=0x0,_0x26cd02=_0x2dcb3e['length'];_0x285e04<_0x26cd02;_0x285e04++){_0x119687+='%'+('00'+_0x2dcb3e['charCodeAt'](_0x285e04)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x119687);};_0x43c5['sUlIDK']=_0x42d1c5,_0x43c5['ZNKKjL']={},_0x43c5['pEduXg']=!![];}const _0x28e275=_0x1e7c5a[0x0],_0x43c5a9=_0xfefcd4+_0x28e275,_0x5d41af=_0x43c5['ZNKKjL'][_0x43c5a9];if(!_0x5d41af){const _0x11d8a6=function(_0x371e55){this['JrdNoF']=_0x371e55,this['YvjvqQ']=[0x1,0x0,0x0],this['UOiprr']=function(){return'newState';},this['XuwwJT']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['QKNabY']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x11d8a6['prototype']['EkVZNH']=function(){const _0xb8a4e4=new RegExp(this['XuwwJT']+this['QKNabY']),_0x12ad4f=_0xb8a4e4['test'](this['UOiprr']['toString']())?--this['YvjvqQ'][0x1]:--this['YvjvqQ'][0x0];return this['aaTzmM'](_0x12ad4f);},_0x11d8a6['prototype']['aaTzmM']=function(_0x22926d){if(!Boolean(~_0x22926d))return _0x22926d;return this['KIVZJA'](this['JrdNoF']);},_0x11d8a6['prototype']['KIVZJA']=function(_0x3d2d6a){for(let _0x3bf0b1=0x0,_0x1d24ca=this['YvjvqQ']['length'];_0x3bf0b1<_0x1d24ca;_0x3bf0b1++){this['YvjvqQ']['push'](Math['round'](Math['random']())),_0x1d24ca=this['YvjvqQ']['length'];}return _0x3d2d6a(this['YvjvqQ'][0x0]);},new _0x11d8a6(_0x43c5)['EkVZNH'](),_0x3ef4e0=_0x43c5['sUlIDK'](_0x3ef4e0),_0x43c5['ZNKKjL'][_0x43c5a9]=_0x3ef4e0;}else _0x3ef4e0=_0x5d41af;return _0x3ef4e0;}exports[_0x5357b7(0x1c5)+_0x5357b7(0xca)]=HealthService,exports['healthSe'+_0x5357b7(0xca)]=new HealthService();