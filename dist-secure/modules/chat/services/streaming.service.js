const _0x252c9c=_0x5787;(function(_0x1f5698,_0x4063fb){const _0x1a0308=_0x5787,_0xf8e782=_0x1f5698();while(!![]){try{const _0x48ded9=parseInt(_0x1a0308(0x294))/0x1*(parseInt(_0x1a0308(0x230))/0x2)+parseInt(_0x1a0308(0x221))/0x3*(-parseInt(_0x1a0308(0x2a2))/0x4)+-parseInt(_0x1a0308(0x2a1))/0x5*(-parseInt(_0x1a0308(0x211))/0x6)+-parseInt(_0x1a0308(0x1b5))/0x7+-parseInt(_0x1a0308(0x23a))/0x8+parseInt(_0x1a0308(0x2cb))/0x9+parseInt(_0x1a0308(0x240))/0xa*(parseInt(_0x1a0308(0x1ab))/0xb);if(_0x48ded9===_0x4063fb)break;else _0xf8e782['push'](_0xf8e782['shift']());}catch(_0x24d892){_0xf8e782['push'](_0xf8e782['shift']());}}}(_0x127c,0xc37ba));const _0x4b0bda=(function(){let _0x2c6fb2=!![];return function(_0x42ada1,_0xa5d38f){const _0x5bf1c4=_0x5787,_0xd46203={'ycqaO':_0x5bf1c4(0x250)+_0x5bf1c4(0x208)+_0x5bf1c4(0x1e3)+_0x5bf1c4(0x214)+_0x5bf1c4(0x28d)+':'},_0x1f1e6c=_0x2c6fb2?function(){const _0x198082=_0x5bf1c4,_0x4d22e7={'zrDiS':_0xd46203[_0x198082(0x2d9)]};if(_0xa5d38f){if(_0x198082(0x26f)!=='vFwFk')_0x56a9f9['log'](_0x4d22e7[_0x198082(0x1ca)],_0x48cec5),this[_0x198082(0x1d2)+'tream'](_0x3302c0);else{const res=_0xa5d38f['apply'](_0x42ada1,arguments);return _0xa5d38f=null,res;}}}:function(){};return _0x2c6fb2=![],_0x1f1e6c;};}()),_0x419138=_0x4b0bda(this,function(){const _0x471a14=_0x5787,_0x5f39d3={'MNXkA':_0x471a14(0x1a1)+'+)+$'};return _0x419138[_0x471a14(0x228)]()[_0x471a14(0x1f0)](_0x471a14(0x1a1)+_0x471a14(0x1e0))['toString']()[_0x471a14(0x280)+_0x471a14(0x1ee)](_0x419138)[_0x471a14(0x1f0)](_0x5f39d3[_0x471a14(0x1d1)]);});function _0x127c(){const _0x30f494=['z2v0vxnLCKe','suDvAva','Dg9Y','x19LC01Vzhu','C2vHCMnO','wLHir2e','Eu1HBMfNzxi','se1NCfu','C3rYAw5NAwy','y2HHDfnLC3m','vf9jtLrfuLy','zYbPCYbKAxm','Eg9vqMK','B3bLCNr5','zw50CMLLCW','DgjLyxq','lI4VBwvTB3i','ue5TChG','u3rYzwfTswq','r19ftKfcteu','zgvSyxK','l2nVBMzPzY8','BenVBNrLEhq','C2vUzev2zw4','ru5bqKXfra','y29UDgvUDa','y3rPDMvtDhi','tKLVC2q','BMDtzxj2Awm','t1jjveLfuW','Aw5PDgLHBgK','zw1VDgLVBMe','tuLu','BgXPBMCVDxm','tNLtBgC','Bgv0ztO','A2vLCc1HBgK','nZyYBMvjuvbT','ANnmqwi','ChvZAa','zw50igrPC2m','x19PBxbVCNq','tMv3ienOyxq','tLftsfe','z2v0vgLTzq','ExfRs1q','zv0G8j+BKsbtDhi','s255vvy','s3j6su0','yNvPBgrqzxi','r19bvvrpx1i','s294tKK','su9o','ndmZnZq5uxHcyMnQ','zwXSzwq6','BsbLCNjVCJO','C3rYzwfTAw4','ywLnB2rLBhm','yMvHDcbLCNi','rufux0Loveu','Dg9tDhjPBMC','ihDPDgGGu1m','qurbvee','l2nVCMuVywK','quH3tfy','B21WDa','DgLVBLbSyw4','B2jUwK8','nJmZmJi0Aff5q1fh','Bwv0ywrHDge','ywDLqxq','zxzLBNq6ia','yxbWBhK','DM9MCNK','C2rut1u','rvrswq','wKPRuNK','AwnL','ndm1mdCXmMvTsenIAW','zvvSsKK','y3jLyxrL','y2vPBa','r19tse9xx1a','igzVDw5K','mta4mtCWuwLTENbj','sfnqz2W','C3rYzwfTxW','C3bSAxq','C3rYzwfTq2G','zxzLBNqGzxi','CM9Szq','rKn3svu','lI4VlI4VyMK','AwfSAxPLzdO','zwv3z3i','zwrLza','Aw9U','zgvSzxrL','BMfTzq','u1rsrufnx0m','w1n0CMvHBwK','B3jkv1i','CgXHBNnnyw4','DhLWzq','vxnHz2uGBgK','C250Exe','r19irufsvei','DhnSAwi','suvt','B3i6','CM5SBeu','z2v0sw5ZDge','Bg9N','y3nvCMm','vKrKuwy','zv0Gu3rYzwe','rvrbrefuqq','lI4VlI4VlI4','zxjYB3i','sNz0vfC','rsbZDhjLyw0','suPkvwe','AgvHCNrIzwe','u0vtu0LptL8','CM91BMq','z2vUzxjHDgu','B2XdvKq','zMfSC2u','y2HHDa','D0fOAKK','oIbOzwfYDgi','DKz3rMS','CMvHBxm','y29TCgXLDgu','C3vIC2nYAxa','u3rYzwfTigm','B0DuBgy','y2XLyxjdywm','u1rbuLrfuG','uKfusu9o','ze5SC2W','DxnLCG','y2H1BMS','CMfUzg9T','Bw9KzwW','C29UywXPDhK','u1rsrufnsu4','cGPvC2vYoIa','y29UC3rYDwm','t3PiyuG','ChjVz3jLC3m','revmqvLFtvm','zv0G8j+mIIbjBMK','u2vZC2LVBIa','ueXbtL9quKK','Auf4sLq','CY9HAs9Wzxi','vvnfuL9ot1q','ueXvuW','BM8Ty2fJAgu','vK1otK8','B25Uzwn0zwq','DwPVtvG','z2v0','BMnL','ugXHBLr5Cgu','DMzyEuq','z2vUzgvY','ngHlEvPSra','D3jPDgvizwe','zw52','C2vYDMLJzq','lMvUz2LUzq','q291BNq','ywLtzxj2Awm','z2v0qwn0Axy','zwfTignHBMm','ywjVCNrLza','AeLKr1C','zwfTigLUAxq','l3bYB3zPzgu','ndGXmtvpshf2B3e','mtjOCLbJzfy','sNbkuLm','CuLhCKu','uLLhy3C','z3jLzxrPBMC','r19nqvHFuKu','tufyx1jfvfi','zw5K','DxbKyxrL','rgvMyxvSDa','z1nLCNzPy2u','qvbfwa','yw5JzwXSzwq','C2L6zq','Egzzv3a','C2v0','r19nqvHFrfu','C3LZDgvTuhi','uff5Aey','BgvUz3rO','r19esvnbqKW','zv0G4PYfifn0CG','zgvMAw5Luhi','q0HvtKTFreu','yxnZAxn0yw4','CMrZ','uLzbta','tufyx1nuuKu','u0vorf9nrvq','DhjPBq','B3rOzxi','DeLUDgvYDMe','yxfvAuW','tefzx01t','r1jfu1m','zv0G8j+mIIbtDhi','zwf0cGO','DhjLyw0','z2v0twvTB3i','BwL0igv4y2u','u2L3Bxa','mJi4mZuYnw5OqvrQvG','BNqTC3rYzwe','sevbuLrcrue','r19dsfvos18','u0Hpv19quK8','zgvMyxvSDa','BM93','y2fUy2vSu3q','EfrgBxi','ueXbtG','igj5ihvZzxi','CMvZCg9UC2u','BwvZC2fNzq','q0HvtKTFu0K','EwnXyu8','ChjPC21H','zMLSDgvY','zMLUzfvUAxe','kcGOlISPkYK','vvnbr0vFteK','rerkAvO','ywDjweq','rfjpy1K','Dgv4Dc9LDMu','u1rsrufnx0u','tK9ux0zpvu4','ywDLlNnLCNy','CMvHC29U','mZqXAuzrAwrp','ywDLCG','DxnLCKLK','twvZC2fNzvi','mZaW','BM90igzVDw4','Bw9KzwXjza','Axr5rw5NAw4','AM9PBG','B2XL','ota5ntm0nu9lyMHPuG','wwrqzNm','CgrUuM8','Eu5HBwu','DxnHz2u','y2fUvxnLv28','C2vUzeHLyxi','s3jKB0m','uLjpuG','l3nLCNzPy2u','BwvTB3j5rge','qu1Frfvsqvq','vvnfuG','ywn0AxzLu3q','Dhj1zq','rg9XrKu','r19tru5ex00','vfjjrvm','y2fUvxnL','C2XPy2u','CM9YoG','ENjeAvm','r25nzhK','ENHtwfq','BwfW','Dg90ywXuB2S','qvvut19srvq','CMvHBq','tu5yA0e','y2XLyw51Cfm','Aw5ZDgfUy2u','DhbHDfy','z1HvCKO','u3rYzwfTAw4','zwfTignVBxa','EMvtDhjLyw0','zv0GsgvHCNq','D3jPDgu','s0vXC0i','sw52ywXPzca','zYbMywLSzwq','C3vIC3rYAw4','sKPQte8','kYKRja','l2nVBNn0yw4','qu5druXmruq','zv0G4P2mienSAq','D1n1Bfm','y2XVC2u','zw5Z','yMLXu3C','D29YzhnvC2u','DgXsve8','EeHJs3m','zgf0ytOG'];_0x127c=function(){return _0x30f494;};return _0x127c();}_0x419138();'use strict';Object[_0x252c9c(0x2b8)+_0x252c9c(0x1f9)](exports,_0x252c9c(0x1ef)+'le',{'value':!![]}),exports['streamin'+_0x252c9c(0x2ac)]=exports[_0x252c9c(0x1d6)+_0x252c9c(0x2ac)]=void 0x0;const tslib_1=require(_0x252c9c(0x257)),ai_service_1=require(_0x252c9c(0x261)+_0x252c9c(0x1be)+'s/ai/ai.'+_0x252c9c(0x297)),usage_service_1=tslib_1['__import'+_0x252c9c(0x2ab)](require(_0x252c9c(0x248)+_0x252c9c(0x20d)+_0x252c9c(0x1a9)+_0x252c9c(0x239))),memoryManager_1=tslib_1[_0x252c9c(0x215)+_0x252c9c(0x2ab)](require(_0x252c9c(0x1fc)+_0x252c9c(0x1f2))),personality_engine_1=require(_0x252c9c(0x261)+_0x252c9c(0x1be)+_0x252c9c(0x288)+'sonality'+_0x252c9c(0x298)),prisma_1=require('../../..'+_0x252c9c(0x201)+_0x252c9c(0x2da)),constants_1=require(_0x252c9c(0x261)+_0x252c9c(0x1e1)+'ts'),providers_1=require(_0x252c9c(0x261)+_0x252c9c(0x22b)+_0x252c9c(0x2a0)+'rs');function _0x5787(_0x1e7961,_0x90985a){_0x1e7961=_0x1e7961-0x1a1;const _0x3864c9=_0x127c();let _0x419138=_0x3864c9[_0x1e7961];if(_0x5787['wVVAvE']===undefined){var _0x4b0bda=function(_0x5cabee){const _0x2859c3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3764bb='',_0xfeaa61='',_0x5c5ad2=_0x3764bb+_0x4b0bda;for(let _0x3d065c=0x0,_0x1a9b98,_0x2476ff,_0x3047b3=0x0;_0x2476ff=_0x5cabee['charAt'](_0x3047b3++);~_0x2476ff&&(_0x1a9b98=_0x3d065c%0x4?_0x1a9b98*0x40+_0x2476ff:_0x2476ff,_0x3d065c++%0x4)?_0x3764bb+=_0x5c5ad2['charCodeAt'](_0x3047b3+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x1a9b98>>(-0x2*_0x3d065c&0x6)):_0x3d065c:0x0){_0x2476ff=_0x2859c3['indexOf'](_0x2476ff);}for(let _0x52ad32=0x0,_0x284003=_0x3764bb['length'];_0x52ad32<_0x284003;_0x52ad32++){_0xfeaa61+='%'+('00'+_0x3764bb['charCodeAt'](_0x52ad32)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xfeaa61);};_0x5787['btRZUU']=_0x4b0bda,_0x5787['IFUXBS']={},_0x5787['wVVAvE']=!![];}const _0x127c72=_0x3864c9[0x0],_0x5787f2=_0x1e7961+_0x127c72,_0xcae2ef=_0x5787['IFUXBS'][_0x5787f2];if(!_0xcae2ef){const _0x3c9ff6=function(_0x1b30bb){this['tJnxvH']=_0x1b30bb,this['LWOLla']=[0x1,0x0,0x0],this['swZluv']=function(){return'newState';},this['yqEMdt']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['fVKOLa']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3c9ff6['prototype']['wseWwG']=function(){const _0x181ec2=new RegExp(this['yqEMdt']+this['fVKOLa']),_0x48bfe3=_0x181ec2['test'](this['swZluv']['toString']())?--this['LWOLla'][0x1]:--this['LWOLla'][0x0];return this['zmtfDt'](_0x48bfe3);},_0x3c9ff6['prototype']['zmtfDt']=function(_0x4fb1cb){if(!Boolean(~_0x4fb1cb))return _0x4fb1cb;return this['PasBUN'](this['tJnxvH']);},_0x3c9ff6['prototype']['PasBUN']=function(_0x573e53){for(let _0x43caa1=0x0,_0x2d825e=this['LWOLla']['length'];_0x43caa1<_0x2d825e;_0x43caa1++){this['LWOLla']['push'](Math['round'](Math['random']())),_0x2d825e=this['LWOLla']['length'];}return _0x573e53(this['LWOLla'][0x0]);},new _0x3c9ff6(_0x5787)['wseWwG'](),_0x419138=_0x5787['btRZUU'](_0x419138),_0x5787['IFUXBS'][_0x5787f2]=_0x419138;}else _0x419138=_0xcae2ef;return _0x419138;}class StreamingConfig{}StreamingConfig['ENABLED']=process['env'][_0x252c9c(0x27e)+_0x252c9c(0x1ff)+'D']!==_0x252c9c(0x26b),StreamingConfig[_0x252c9c(0x2d8)+'ZE']=parseInt(process[_0x252c9c(0x296)][_0x252c9c(0x27e)+'G_CHUNK_'+'SIZE']||'5'),StreamingConfig['CHUNK_DE'+_0x252c9c(0x2c3)]=parseInt(process[_0x252c9c(0x296)][_0x252c9c(0x27e)+_0x252c9c(0x2ce)+_0x252c9c(0x283)]||'30'),StreamingConfig['HEARTBEA'+_0x252c9c(0x1f6)+'AL']=parseInt(process[_0x252c9c(0x296)][_0x252c9c(0x27e)+_0x252c9c(0x256)+_0x252c9c(0x227)+_0x252c9c(0x2bc)]||'15'),StreamingConfig[_0x252c9c(0x2bd)+_0x252c9c(0x1c0)+_0x252c9c(0x220)]=parseInt(process[_0x252c9c(0x296)][_0x252c9c(0x27e)+_0x252c9c(0x2b2)+_0x252c9c(0x277)]||_0x252c9c(0x1af)),StreamingConfig[_0x252c9c(0x2cf)+_0x252c9c(0x2c4)]=process[_0x252c9c(0x296)][_0x252c9c(0x27e)+_0x252c9c(0x23e)+'ROGRESS']!==_0x252c9c(0x26b),StreamingConfig['SEND_MET'+_0x252c9c(0x22a)]=process['env'][_0x252c9c(0x27e)+_0x252c9c(0x1c5)+_0x252c9c(0x260)]!=='false',StreamingConfig[_0x252c9c(0x1cf)+'RY']=process[_0x252c9c(0x296)]['STREAMIN'+_0x252c9c(0x21e)+_0x252c9c(0x237)]===_0x252c9c(0x1c3),StreamingConfig[_0x252c9c(0x2a8)+_0x252c9c(0x258)]=parseInt(process[_0x252c9c(0x296)]['STREAMIN'+_0x252c9c(0x2a7)+_0x252c9c(0x1c6)]||'2'),StreamingConfig[_0x252c9c(0x286)+_0x252c9c(0x209)]={[constants_1[_0x252c9c(0x291)][_0x252c9c(0x276)]]:0x1,[constants_1[_0x252c9c(0x291)][_0x252c9c(0x28a)]]:0x2,[constants_1['PlanType']['PRO']]:0x3,[constants_1[_0x252c9c(0x291)][_0x252c9c(0x2ad)]]:0x4,[constants_1['PlanType']['SOVEREIG'+'N']]:0xa};class StreamingService{constructor(){const _0x2f10e4=_0x252c9c,_0x3a47aa={'FGRss':function(_0x4795a0,_0x567b9a){return _0x4795a0+_0x567b9a;}};this['activeSt'+_0x2f10e4(0x270)]=new Map(),console[_0x2f10e4(0x25c)](_0x2f10e4(0x250)+'ngServic'+_0x2f10e4(0x284)+'tialized'+_0x2f10e4(0x229)+_0x2f10e4(0x264)+'ing'),console[_0x2f10e4(0x25c)]('[Streami'+_0x2f10e4(0x208)+'e]\x20Confi'+'g:',{'enabled':StreamingConfig[_0x2f10e4(0x204)],'chunkSize':StreamingConfig[_0x2f10e4(0x2d8)+'ZE'],'chunkDelay':StreamingConfig[_0x2f10e4(0x2b9)+_0x2f10e4(0x2c3)]+'ms','heartbeat':_0x3a47aa['FGRss'](StreamingConfig[_0x2f10e4(0x2cd)+_0x2f10e4(0x1f6)+'AL'],'s'),'maxDuration':StreamingConfig[_0x2f10e4(0x2bd)+_0x2f10e4(0x1c0)+'ION']+'s'});}static[_0x252c9c(0x25b)+_0x252c9c(0x290)](){const _0x1076fb=_0x252c9c;return!StreamingService[_0x1076fb(0x1d3)]&&(StreamingService[_0x1076fb(0x1d3)]=new StreamingService()),StreamingService[_0x1076fb(0x1d3)];}[_0x252c9c(0x20a)+_0x252c9c(0x1d8)](res,_0x471b83){const _0x167519=_0x252c9c,_0x5ca4b4={'orJWR':_0x167519(0x28b),'JTOLq':'[Streami'+_0x167519(0x208)+_0x167519(0x2c5)+_0x167519(0x29f)+_0x167519(0x249)};res[_0x167519(0x295)+'d'](0xc8,{'Content-Type':_0x167519(0x1a6)+_0x167519(0x2cc)+'m','Cache-Control':_0x5ca4b4[_0x167519(0x251)],'Connection':_0x167519(0x210)+'ve','X-Accel-Buffering':'no'}),console[_0x167519(0x25c)](_0x5ca4b4['JTOLq'],_0x471b83);}[_0x252c9c(0x203)+'t'](res,_0x389643){const _0x7e3be6=_0x252c9c,_0xed3183={'AHwLV':function(_0x40f9f1,_0x4e3646){return _0x40f9f1!==_0x4e3646;},'KnyUV':_0x7e3be6(0x236),'aqUiL':_0x7e3be6(0x1a3)};try{const _0x26ee67=JSON[_0x7e3be6(0x1f4)+'y'](_0x389643);return res[_0x7e3be6(0x1da)]('event:\x20'+_0x389643[_0x7e3be6(0x253)]+'\x0a'),res[_0x7e3be6(0x1da)]('data:\x20'+_0x26ee67+'\x0a\x0a'),!![];}catch(_0x4b019d){if(_0xed3183[_0x7e3be6(0x22c)](_0xed3183[_0x7e3be6(0x21b)],_0xed3183[_0x7e3be6(0x2c2)]))return console[_0x7e3be6(0x262)](_0x7e3be6(0x250)+'ngServic'+'e]\x20Send\x20'+_0x7e3be6(0x245)+_0x7e3be6(0x1c9),_0x4b019d),![];else this[_0x7e3be6(0x203)+'t'](res,{'type':_0x7e3be6(0x231),'data':{'model':_0x4ed1b4['aiModels'][0x0][_0x7e3be6(0x1b1)]}});}}['sendHear'+_0x252c9c(0x1fb)](res){const _0xac2ea5=_0x252c9c,_0x5979f9={'YdPfs':'[Streami'+'ngServic'+_0xac2ea5(0x1d9)+_0xac2ea5(0x226)+_0xac2ea5(0x259)};try{res['write'](_0xac2ea5(0x26e)+_0xac2ea5(0x2c6));}catch(_0x1fdd20){console[_0xac2ea5(0x262)](_0x5979f9[_0xac2ea5(0x1b6)],_0x1fdd20);}}async[_0x252c9c(0x244)+'at'](_0x5e4ebe,res){const _0x209f99=_0x252c9c,_0x54754f={'GnMdy':function(_0xebb1c9,_0x5e5bbb){return _0xebb1c9!==_0x5e5bbb;},'xHcKs':_0x209f99(0x2a4),'sntyq':_0x209f99(0x1c4),'yqkKT':function(_0x432891,_0x5642a5){return _0x432891!==_0x5642a5;},'JvtTW':_0x209f99(0x262),'NySlg':function(_0x4bf99b,_0x3be71e){return _0x4bf99b<_0x3be71e;},'PNmpx':_0x209f99(0x24f)+_0x209f99(0x1e2),'wSulS':function(_0x182e5d,_0x38772f){return _0x182e5d===_0x38772f;},'dNlsl':function(_0x447cfc,_0x39770e){return _0x447cfc===_0x39770e;},'IlVJz':'Streamin'+_0x209f99(0x1f7)+'abled','cXhvH':_0x209f99(0x27e)+_0x209f99(0x2b6)+'ED','VDdQf':function(_0x852e8d,_0x509477,_0x1635d5){return _0x852e8d(_0x509477,_0x1635d5);},'HMgpU':'XTndX','ZJkRy':_0x209f99(0x289)+'_FOUND','xfYWp':'INVALID_'+_0x209f99(0x2d4),'jsLAb':function(_0xe2196b,_0xea5e98){return _0xe2196b+_0xea5e98;},'XJDag':function(_0x4ff749,_0x4c50d7){return _0x4ff749===_0x4c50d7;},'KoxNI':_0x209f99(0x1bc),'NIosd':_0x209f99(0x254)+_0x209f99(0x2c9)+_0x209f99(0x24b),'vmWTc':_0x209f99(0x267)+_0x209f99(0x1a8)+'D','vofry':'Siwmp','vfXyD':_0x209f99(0x216),'oGTlf':_0x209f99(0x279),'KrzIM':function(_0x33fbcf,_0x1c6be2){return _0x33fbcf||_0x1c6be2;},'obnZO':function(_0x56c121,_0x20c6af){return _0x56c121*_0x20c6af;},'unoTO':function(_0x535666,_0x12f5f6){return _0x535666/_0x12f5f6;},'csUrc':function(_0x5db06a,_0xaf8c14){return _0x5db06a>_0xaf8c14;},'olCVD':'KEqsB','IJJUa':'metadata','xTFmr':function(_0x1c03c8,_0x4a0624){return _0x1c03c8+_0x4a0624;},'gXUrJ':function(_0x3b13b7,_0x29123d){return _0x3b13b7(_0x29123d);},'ZeAxx':function(_0x57e328,_0x578b05){return _0x57e328*_0x578b05;},'IGUiP':function(_0x4610ac,_0x4e8e2e){return _0x4610ac/_0x4e8e2e;},'zxSXT':_0x209f99(0x282),'tpatV':_0x209f99(0x2ba)+'t','pdnRo':function(_0x183f1f,_0x5cd4f8){return _0x183f1f-_0x5cd4f8;},'btvMe':_0x209f99(0x250)+_0x209f99(0x208)+_0x209f99(0x2b7)+_0x209f99(0x1d7)+_0x209f99(0x20f),'ReeEj':_0x209f99(0x1a7)+_0x209f99(0x1bd)},_0x3ca7e1=this['generate'+_0x209f99(0x1fe)](),_0x164996=Date[_0x209f99(0x2d1)](),_0x8fbe7a=0x0,{userId:_0x460cb5,message:_0x8e9e33,sessionId:_0x28e9bf,parentMessageId:_0x3ab116,temperature:_0x5dfec6,onChunk:_0x24358e}=_0x5e4ebe;try{if(!StreamingConfig[_0x209f99(0x204)]){this[_0x209f99(0x203)+'t'](res,{'type':_0x209f99(0x262),'data':{'error':_0x54754f['IlVJz'],'code':_0x54754f['cXhvH']}}),res['end']();return;}this['initiali'+_0x209f99(0x1d8)](res,_0x3ca7e1);const _0x1c39ff={'id':_0x3ca7e1,'userId':_0x460cb5,'startTime':_0x164996,'response':res,'aborted':![]};this[_0x209f99(0x1c2)+'reams'][_0x209f99(0x2b1)](_0x3ca7e1,_0x1c39ff),_0x1c39ff[_0x209f99(0x266)+'tInterva'+'l']=_0x54754f[_0x209f99(0x25e)](setInterval,()=>{const _0x334aa5=_0x209f99;if(!_0x1c39ff[_0x334aa5(0x29d)]){if(_0x54754f[_0x334aa5(0x1cb)](_0x54754f[_0x334aa5(0x1ea)],_0x54754f[_0x334aa5(0x255)]))this['sendHear'+_0x334aa5(0x1fb)](res);else return'stream_'+_0x300d1a['now']()+'_'+_0x55bf10['random']()[_0x334aa5(0x228)](0x24)[_0x334aa5(0x1de)+'g'](0x7);}},StreamingConfig[_0x209f99(0x2cd)+_0x209f99(0x1f6)+'AL']*0x3e8),res['on'](_0x209f99(0x1e5),()=>{const _0x2bcbb2=_0x209f99,_0x2304df={'HSPgl':_0x2bcbb2(0x262),'rnllE':_0x2bcbb2(0x1a2)+_0x2bcbb2(0x20c)};if(_0x54754f[_0x2bcbb2(0x219)](_0x2bcbb2(0x1f8),_0x2bcbb2(0x1f8))){this[_0x2bcbb2(0x203)+'t'](res,{'type':_0x2304df[_0x2bcbb2(0x241)],'data':{'error':_0x5df613[_0x2bcbb2(0x1aa)]||'Usage\x20li'+_0x2bcbb2(0x2c9)+_0x2bcbb2(0x24b),'code':_0x2304df[_0x2bcbb2(0x25a)]}}),this[_0x2bcbb2(0x1d2)+_0x2bcbb2(0x2c7)](_0x250476);return;}else console[_0x2bcbb2(0x25c)]('[Streami'+'ngServic'+'e]\x20âŒ\x20Cli'+_0x2bcbb2(0x214)+'onnected'+':',_0x3ca7e1),this[_0x2bcbb2(0x1d2)+_0x2bcbb2(0x2c7)](_0x3ca7e1);});const _0x11e1bd=await prisma_1[_0x209f99(0x2da)]['user'][_0x209f99(0x2dc)+'ue']({'where':{'id':_0x460cb5},'select':{'id':!![],'name':!![],'gender':!![],'subscriptionPlan':!![],'memoryDays':!![]}});if(!_0x11e1bd){if(_0x54754f['wSulS'](_0x54754f[_0x209f99(0x1f3)],_0x54754f[_0x209f99(0x1f3)])){this[_0x209f99(0x203)+'t'](res,{'type':_0x54754f[_0x209f99(0x263)],'data':{'error':'User\x20not'+_0x209f99(0x23f),'code':_0x54754f[_0x209f99(0x238)]}}),this[_0x209f99(0x1d2)+_0x209f99(0x2c7)](_0x3ca7e1);return;}else _0x545d79[_0x209f99(0x262)](_0x209f99(0x250)+'ngServic'+'e]\x20Strea'+_0x209f99(0x223),_0x814cf9),this[_0x209f99(0x203)+'t'](res,{'type':_0x54754f[_0x209f99(0x263)],'data':{'error':_0x425578[_0x209f99(0x2d7)]||_0x209f99(0x1d6)+_0x209f99(0x1dd),'code':_0x38622a['code']||_0x209f99(0x1a7)+_0x209f99(0x1bd),'retryable':_0x45b37c[_0x209f99(0x1cf)+'RY']&&_0x54754f[_0x209f99(0x20e)](_0x2a9f26,_0x233b74[_0x209f99(0x2a8)+_0x209f99(0x258)])}}),this[_0x209f99(0x1d2)+_0x209f99(0x2c7)](_0x45d340);}const _0x410e2c=constants_1[_0x209f99(0x252)+_0x209f99(0x1ac)]['getPlanB'+_0x209f99(0x1b8)](_0x11e1bd[_0x209f99(0x272)+_0x209f99(0x22e)]);if(!_0x410e2c){this[_0x209f99(0x203)+'t'](res,{'type':_0x54754f['JvtTW'],'data':{'error':_0x209f99(0x1dc)+'plan','code':_0x54754f[_0x209f99(0x2b0)]}}),this[_0x209f99(0x1d2)+_0x209f99(0x2c7)](_0x3ca7e1);return;}const _0x1b3dcd=_0x54754f[_0x209f99(0x212)](Math[_0x209f99(0x23d)](_0x8e9e33[_0x209f99(0x2b5)]/0x5),0x64),_0x55a9ce=await usage_service_1[_0x209f99(0x2d0)][_0x209f99(0x1ba)+_0x209f99(0x2bb)](_0x460cb5,_0x1b3dcd);if(!_0x55a9ce[_0x209f99(0x1c7)]){if(_0x54754f['XJDag'](_0x54754f[_0x209f99(0x21f)],_0x54754f[_0x209f99(0x21f)])){this[_0x209f99(0x203)+'t'](res,{'type':_0x209f99(0x262),'data':{'error':_0x55a9ce[_0x209f99(0x1aa)]||_0x54754f[_0x209f99(0x207)],'code':_0x209f99(0x1a2)+_0x209f99(0x20c)}}),this[_0x209f99(0x1d2)+_0x209f99(0x2c7)](_0x3ca7e1);return;}else{const _0x31a812=this[_0x209f99(0x1c2)+_0x209f99(0x270)]['get'](_0x337104);if(!_0x31a812)return![];return _0x31a812[_0x209f99(0x29d)]=!![],this[_0x209f99(0x203)+'t'](_0x31a812[_0x209f99(0x2d6)],{'type':'error','data':{'error':'Stream\x20c'+_0x209f99(0x2ae)+'\x20by\x20user','code':_0x54754f[_0x209f99(0x1fd)]}}),this['cleanupS'+_0x209f99(0x2c7)](_0x1c3c72),_0x3404a2['log'](_0x209f99(0x250)+_0x209f99(0x208)+_0x209f99(0x21a)+_0x209f99(0x29c)+_0x209f99(0x222),_0x33b3d6),!![];}}let _0x3d7dc5;if(_0x28e9bf){if('lXhwm'===_0x209f99(0x247))this[_0x209f99(0x1bb)+_0x209f99(0x1fb)](res);else{_0x3d7dc5=await prisma_1['prisma'][_0x209f99(0x1f5)+_0x209f99(0x24c)][_0x209f99(0x2dc)+'ue']({'where':{'id':_0x28e9bf,'userId':_0x460cb5}});if(!_0x3d7dc5){if(_0x209f99(0x23b)===_0x209f99(0x1e7))!_0x53a3b5[_0x209f99(0x29d)]&&this[_0x209f99(0x1bb)+_0x209f99(0x1fb)](res);else{this[_0x209f99(0x203)+'t'](res,{'type':_0x54754f['JvtTW'],'data':{'error':_0x209f99(0x285)+_0x209f99(0x1b0)+'d','code':_0x54754f['vmWTc']}}),this[_0x209f99(0x1d2)+'tream'](_0x3ca7e1);return;}}}}else{if(_0x54754f[_0x209f99(0x219)](_0x54754f[_0x209f99(0x235)],_0x209f99(0x2ca))){const _0x39b0e8=[];for(const [_0x3fa45c,_0x5148a4]of this['activeSt'+_0x209f99(0x270)][_0x209f99(0x1fa)]()){_0x54754f[_0x209f99(0x1e4)](_0x5148a4[_0x209f99(0x1ad)],_0xbf9f48)&&_0x39b0e8[_0x209f99(0x213)](_0x3fa45c);}return _0x39b0e8;}else{const _0x431cff=_0x8e9e33[_0x209f99(0x1de)+'g'](0x0,0x32)[_0x209f99(0x2bf)]()||_0x54754f[_0x209f99(0x292)];_0x3d7dc5=await prisma_1[_0x209f99(0x2da)][_0x209f99(0x1f5)+'ion'][_0x209f99(0x23c)]({'data':{'userId':_0x460cb5,'title':_0x431cff,'aiModel':_0x410e2c[_0x209f99(0x225)][0x0][_0x209f99(0x1b1)]}});}}const _0x55db11=_0x8e9e33['trim']()[_0x209f99(0x243)](/\s+/)[_0x209f99(0x2b5)],_0x5e0c52=await prisma_1[_0x209f99(0x2da)]['message'][_0x209f99(0x23c)]({'data':{'sessionId':_0x3d7dc5['id'],'userId':_0x460cb5,'role':_0x54754f[_0x209f99(0x274)],'content':_0x8e9e33,'wordsUsed':_0x55db11,'parentMessageId':_0x54754f['KrzIM'](_0x3ab116,null)}}),_0x25388a=_0x54754f['obnZO'](_0x11e1bd[_0x209f99(0x1bf)+'ys']||0x5,0xa),_0x9df7b7=await prisma_1[_0x209f99(0x2da)][_0x209f99(0x2d7)]['findMany']({'where':{'sessionId':_0x3d7dc5['id']},'orderBy':{'createdAt':'asc'},'take':_0x25388a}),_0x1f79c6=_0x9df7b7[_0x209f99(0x2db)](_0x1d92ba=>_0x1d92ba['id']!==_0x5e0c52['id'])[_0x209f99(0x1cd)](_0x5aa5d6=>({'role':_0x5aa5d6['role']===_0x209f99(0x279)?providers_1[_0x209f99(0x1ae)+_0x209f99(0x1b4)][_0x209f99(0x1c1)]:providers_1[_0x209f99(0x1ae)+_0x209f99(0x1b4)]['ASSISTAN'+'T'],'content':_0x5aa5d6[_0x209f99(0x205)]})),_0x340af2=await memoryManager_1[_0x209f99(0x2d0)][_0x209f99(0x2c8)+'yContext'](_0x460cb5),_0x504b1b=_0x9df7b7[_0x209f99(0x2b5)]===0x0;let _0x4bc8b5=0x0;if(_0x3d7dc5['lastMess'+_0x209f99(0x232)]){const _0x55707a=_0x54754f['unoTO'](Date[_0x209f99(0x2d1)]()-_0x3d7dc5['lastMess'+_0x209f99(0x232)][_0x209f99(0x218)](),_0x54754f[_0x209f99(0x22f)](_0x54754f[_0x209f99(0x22f)](_0x54754f[_0x209f99(0x22f)](0x3e8,0x3c),0x3c),0x18));_0x4bc8b5=Math['floor'](_0x55707a);}const _0x24cda1=personality_engine_1['personal'+_0x209f99(0x1b2)+'e'][_0x209f99(0x21d)+_0x209f99(0x27d)]({'userName':_0x11e1bd['name']||undefined,'gender':_0x11e1bd[_0x209f99(0x293)]||_0x209f99(0x2c0),'planType':_0x11e1bd[_0x209f99(0x272)+'tionPlan'],'isFirstMessage':_0x504b1b,'isReturningUser':_0x54754f[_0x209f99(0x25d)](_0x4bc8b5,0x0),'daysSinceLastChat':_0x4bc8b5,'userMessage':_0x8e9e33,'conversationHistory':_0x1f79c6[_0x209f99(0x1cd)](_0x562a81=>({'role':_0x562a81[_0x209f99(0x246)],'content':_0x562a81['content']}))});let _0x104503=_0x8e9e33;_0x24cda1['greeting']&&(_0x54754f[_0x209f99(0x26a)]===_0x209f99(0x1db)?_0x104503=_0x24cda1[_0x209f99(0x2a6)]+'\x0a\x0aUser:\x20'+_0x8e9e33:_0x54754f[_0x209f99(0x278)](_0x4ab91f['userId'],_0x4da9ba)&&_0x4cf361[_0x209f99(0x213)](_0x3aa253));if(StreamingConfig[_0x209f99(0x2be)+'ADATA']){if(_0x54754f[_0x209f99(0x1cb)](_0x209f99(0x287),_0x209f99(0x287))){const res=_0x2339bf[_0x209f99(0x234)](_0xcc2a9e,arguments);return _0x14a214=null,res;}else this[_0x209f99(0x203)+'t'](res,{'type':_0x54754f[_0x209f99(0x265)],'data':{'model':_0x410e2c[_0x209f99(0x225)][0x0]['modelId']}});}let _0x15c35a='',_0x42acf8=0x0;const _0x5cc968=await ai_service_1[_0x209f99(0x29a)+'e'][_0x209f99(0x26c)]({'message':_0x104503,'conversationHistory':_0x1f79c6,'memory':_0x340af2,'userId':_0x460cb5,'planType':_0x11e1bd['subscrip'+'tionPlan'],'language':'english','userName':_0x11e1bd[_0x209f99(0x24e)]||undefined,'temperature':_0x54754f[_0x209f99(0x21c)](_0x5dfec6,0.7),'systemPrompt':_0x24cda1[_0x209f99(0x2b3)+_0x209f99(0x22d)],'emotionalContext':_0x24cda1[_0x209f99(0x20b)+_0x209f99(0x202)]}),_0x3e47d2=_0x5cc968[_0x209f99(0x2d7)]['split']('\x20'),_0x318ba9=_0x3e47d2['length'];for(let _0xdc28de=0x0;_0xdc28de<_0x3e47d2[_0x209f99(0x2b5)];_0xdc28de+=StreamingConfig[_0x209f99(0x2d8)+'ZE']){if(_0x1c39ff['aborted'])break;const _0x1bbe2e=_0x54754f[_0x209f99(0x2d3)](_0x3e47d2[_0x209f99(0x1c8)](_0xdc28de,_0xdc28de+StreamingConfig[_0x209f99(0x2d8)+'ZE'])[_0x209f99(0x1b3)]('\x20'),'\x20');_0x15c35a+=_0x1bbe2e,this[_0x209f99(0x203)+'t'](res,{'type':_0x209f99(0x27a),'data':{'content':_0x1bbe2e,'index':_0x42acf8++}});_0x24358e&&_0x54754f[_0x209f99(0x1d5)](_0x24358e,_0x1bbe2e);if(StreamingConfig[_0x209f99(0x2cf)+_0x209f99(0x2c4)]){const _0x51ebaa=Math[_0x209f99(0x268)](_0x54754f['ZeAxx'](_0x54754f[_0x209f99(0x1ed)](_0xdc28de,_0x318ba9),0x64));this['sendEven'+'t'](res,{'type':_0x54754f[_0x209f99(0x1cc)],'data':{'percentage':_0x51ebaa}});}await this[_0x209f99(0x200)](StreamingConfig['CHUNK_DE'+'LAY_MS']);}const _0x4555ab=await prisma_1[_0x209f99(0x2da)][_0x209f99(0x2d7)][_0x209f99(0x23c)]({'data':{'sessionId':_0x3d7dc5['id'],'userId':_0x460cb5,'role':_0x54754f[_0x209f99(0x1d4)],'content':_0x15c35a['trim'](),'aiModel':_0x5cc968['metadata'][_0x209f99(0x27c)],'tokens':_0x5cc968['usage'][_0x209f99(0x1ce)+_0x209f99(0x1e6)],'wordsUsed':_0x5cc968['usage']['wordsUse'+'d']-_0x55db11}});await prisma_1[_0x209f99(0x2da)]['chatSess'+_0x209f99(0x24c)][_0x209f99(0x2aa)]({'where':{'id':_0x3d7dc5['id']},'data':{'messageCount':{'increment':0x2},'totalTokens':{'increment':_0x5cc968[_0x209f99(0x1b9)]['totalTok'+_0x209f99(0x1e6)]},'lastMessageAt':new Date()}});const _0x1c815a=_0x54754f[_0x209f99(0x1b7)](Date[_0x209f99(0x2d1)](),_0x164996);this[_0x209f99(0x203)+'t'](res,{'type':_0x209f99(0x271),'data':{'messageId':_0x4555ab['id'],'totalTokens':_0x5cc968[_0x209f99(0x1b9)]['totalTok'+_0x209f99(0x1e6)],'totalWords':_0x5cc968[_0x209f99(0x1b9)][_0x209f99(0x1e8)+'d'],'streamDuration':_0x1c815a}}),console[_0x209f99(0x25c)](_0x54754f['btvMe'],{'streamId':_0x3ca7e1,'duration':_0x1c815a+'ms','chunks':_0x42acf8,'words':_0x318ba9}),memoryManager_1[_0x209f99(0x2d0)][_0x209f99(0x275)+'he'](_0x460cb5),this[_0x209f99(0x1d2)+_0x209f99(0x2c7)](_0x3ca7e1);}catch(_0x5eeb14){console[_0x209f99(0x262)](_0x209f99(0x250)+_0x209f99(0x208)+_0x209f99(0x25f)+_0x209f99(0x223),_0x5eeb14),this[_0x209f99(0x203)+'t'](res,{'type':'error','data':{'error':_0x5eeb14['message']||_0x209f99(0x1d6)+'g\x20failed','code':_0x5eeb14['code']||_0x54754f['ReeEj'],'retryable':StreamingConfig[_0x209f99(0x1cf)+'RY']&&_0x54754f[_0x209f99(0x20e)](_0x8fbe7a,StreamingConfig[_0x209f99(0x2a8)+_0x209f99(0x258)])}}),this[_0x209f99(0x1d2)+_0x209f99(0x2c7)](_0x3ca7e1);}}[_0x252c9c(0x2d2)+_0x252c9c(0x1d0)](_0x78b8a9){const _0x4353d9=_0x252c9c,_0x1bbef9={'tlRTO':function(_0x44bc7b,_0x271da6){return _0x44bc7b/_0x271da6;},'RYGcw':_0x4353d9(0x1f1),'TCruY':_0x4353d9(0x29e),'agIXD':_0x4353d9(0x273)+'ancelled'+_0x4353d9(0x2d5),'CEeqB':_0x4353d9(0x24f)+_0x4353d9(0x1e2),'eewgr':_0x4353d9(0x250)+_0x4353d9(0x208)+_0x4353d9(0x21a)+_0x4353d9(0x29c)+'elled:'},_0x7c28c1=this[_0x4353d9(0x1c2)+_0x4353d9(0x270)][_0x4353d9(0x28f)](_0x78b8a9);if(!_0x7c28c1){if(_0x1bbef9[_0x4353d9(0x2a5)]!==_0x1bbef9['TCruY'])return![];else{const _0x45e685=_0x334238[_0x4353d9(0x268)](_0x1bbef9[_0x4353d9(0x1e9)](_0x3b7329,_0xe900ae)*0x64);this['sendEven'+'t'](res,{'type':_0x4353d9(0x282),'data':{'percentage':_0x45e685}});}}return _0x7c28c1['aborted']=!![],this['sendEven'+'t'](_0x7c28c1[_0x4353d9(0x2d6)],{'type':_0x4353d9(0x262),'data':{'error':_0x1bbef9[_0x4353d9(0x1a4)],'code':_0x1bbef9['CEeqB']}}),this['cleanupS'+'tream'](_0x78b8a9),console[_0x4353d9(0x25c)](_0x1bbef9[_0x4353d9(0x24a)],_0x78b8a9),!![];}[_0x252c9c(0x29b)+'eStreams'+_0x252c9c(0x299)](){const _0x57d8bc=_0x252c9c;return this['activeSt'+'reams'][_0x57d8bc(0x2af)];}[_0x252c9c(0x1ec)+_0x252c9c(0x206)+'eams'](_0x2d8df9){const _0x36f8f5=_0x252c9c,_0x5262b6={'DROcY':function(_0x1ee2a5,_0x1b3233){return _0x1ee2a5===_0x1b3233;}},_0x535aba=[];for(const [_0x2a518b,_0x3b4dc0]of this[_0x36f8f5(0x1c2)+'reams'][_0x36f8f5(0x1fa)]()){if(_0x36f8f5(0x217)===_0x36f8f5(0x217))_0x5262b6[_0x36f8f5(0x1a5)](_0x3b4dc0['userId'],_0x2d8df9)&&_0x535aba[_0x36f8f5(0x213)](_0x2a518b);else try{const _0x1a55af=_0x1a867b[_0x36f8f5(0x1f4)+'y'](_0x5b68a6);return res['write'](_0x36f8f5(0x233)+_0x6b3fd9[_0x36f8f5(0x253)]+'\x0a'),res[_0x36f8f5(0x1da)](_0x36f8f5(0x1eb)+_0x1a55af+'\x0a\x0a'),!![];}catch(_0xdc775e){return _0x128949[_0x36f8f5(0x262)](_0x36f8f5(0x250)+'ngServic'+'e]\x20Send\x20'+'event\x20er'+_0x36f8f5(0x1c9),_0xdc775e),![];}}return _0x535aba;}[_0x252c9c(0x269)+_0x252c9c(0x1fe)](){const _0x34c7c9=_0x252c9c;return _0x34c7c9(0x242)+Date['now']()+'_'+Math[_0x34c7c9(0x27b)]()[_0x34c7c9(0x228)](0x24)[_0x34c7c9(0x1de)+'g'](0x7);}['cleanupS'+_0x252c9c(0x2c7)](_0x200a36){const _0x3bfc9b=_0x252c9c,_0x156eb2={'VMNNO':_0x3bfc9b(0x281),'JBLqi':_0x3bfc9b(0x26d),'JpJRS':function(_0x42d9ff,_0xf5ba81){return _0x42d9ff(_0xf5ba81);},'JJjLO':function(_0x46a84e,_0x55844c){return _0x46a84e===_0x55844c;},'ujoMX':'DmrsJ'},_0x366b41=this[_0x3bfc9b(0x1c2)+_0x3bfc9b(0x270)][_0x3bfc9b(0x28f)](_0x200a36);if(_0x366b41){if(_0x156eb2[_0x3bfc9b(0x28c)]===_0x3bfc9b(0x281)){_0x366b41[_0x3bfc9b(0x266)+'tInterva'+'l']&&(_0x3bfc9b(0x2b4)===_0x156eb2['JBLqi']?_0x46c0bb=_0xc9d1c5[_0x3bfc9b(0x2a6)]+_0x3bfc9b(0x27f)+_0x56c657:_0x156eb2[_0x3bfc9b(0x2a3)](clearInterval,_0x366b41[_0x3bfc9b(0x266)+_0x3bfc9b(0x2c1)+'l']));try{if(_0x156eb2[_0x3bfc9b(0x1df)](_0x156eb2['ujoMX'],_0x156eb2[_0x3bfc9b(0x28e)]))_0x366b41[_0x3bfc9b(0x2d6)][_0x3bfc9b(0x2a9)]();else return _0x3f874b[_0x3bfc9b(0x228)]()[_0x3bfc9b(0x1f0)](_0x3bfc9b(0x1a1)+'+)+$')[_0x3bfc9b(0x228)]()[_0x3bfc9b(0x280)+_0x3bfc9b(0x1ee)](_0x53a2e9)[_0x3bfc9b(0x1f0)](_0x3bfc9b(0x1a1)+_0x3bfc9b(0x1e0));}catch(_0x1ce155){}this[_0x3bfc9b(0x1c2)+_0x3bfc9b(0x270)][_0x3bfc9b(0x24d)](_0x200a36);}else _0xa38337['response'][_0x3bfc9b(0x2a9)]();}}[_0x252c9c(0x200)](_0x215dca){return new Promise(_0x58d0b9=>setTimeout(_0x58d0b9,_0x215dca));}}exports[_0x252c9c(0x1d6)+_0x252c9c(0x2ac)]=StreamingService,exports[_0x252c9c(0x224)+_0x252c9c(0x2ac)]=StreamingService['getInsta'+_0x252c9c(0x290)]();