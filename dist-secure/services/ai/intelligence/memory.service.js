const _0x22e6ae=_0x20e3;(function(_0x529c82,_0x222968){const _0x354454=_0x20e3,_0x311d19=_0x529c82();while(!![]){try{const _0xd4734b=parseInt(_0x354454(0x17a))/0x1+-parseInt(_0x354454(0x145))/0x2*(-parseInt(_0x354454(0x148))/0x3)+-parseInt(_0x354454(0x1b6))/0x4+parseInt(_0x354454(0x11c))/0x5+parseInt(_0x354454(0x1b0))/0x6+-parseInt(_0x354454(0x135))/0x7*(-parseInt(_0x354454(0x19a))/0x8)+-parseInt(_0x354454(0x17b))/0x9;if(_0xd4734b===_0x222968)break;else _0x311d19['push'](_0x311d19['shift']());}catch(_0x151c15){_0x311d19['push'](_0x311d19['shift']());}}}(_0x3570,0x3d582));function _0x20e3(_0x564516,_0x70d165){_0x564516=_0x564516-0xba;const _0x3bbe51=_0x3570();let _0x33263d=_0x3bbe51[_0x564516];if(_0x20e3['wVXcun']===undefined){var _0xdcc3de=function(_0x39ab24){const _0x21c431='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xe5fbe8='',_0x158918='',_0x122397=_0xe5fbe8+_0xdcc3de;for(let _0x4ed911=0x0,_0x1f0fdb,_0x2f9ed1,_0x3d4120=0x0;_0x2f9ed1=_0x39ab24['charAt'](_0x3d4120++);~_0x2f9ed1&&(_0x1f0fdb=_0x4ed911%0x4?_0x1f0fdb*0x40+_0x2f9ed1:_0x2f9ed1,_0x4ed911++%0x4)?_0xe5fbe8+=_0x122397['charCodeAt'](_0x3d4120+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x1f0fdb>>(-0x2*_0x4ed911&0x6)):_0x4ed911:0x0){_0x2f9ed1=_0x21c431['indexOf'](_0x2f9ed1);}for(let _0x4a145f=0x0,_0x336c47=_0xe5fbe8['length'];_0x4a145f<_0x336c47;_0x4a145f++){_0x158918+='%'+('00'+_0xe5fbe8['charCodeAt'](_0x4a145f)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x158918);};_0x20e3['rqXaAo']=_0xdcc3de,_0x20e3['XyvhCd']={},_0x20e3['wVXcun']=!![];}const _0x3570f8=_0x3bbe51[0x0],_0x20e3e2=_0x564516+_0x3570f8,_0x523add=_0x20e3['XyvhCd'][_0x20e3e2];if(!_0x523add){const _0x9f9de3=function(_0x533186){this['yZSKdT']=_0x533186,this['IkUPNy']=[0x1,0x0,0x0],this['JXIWbf']=function(){return'newState';},this['hWNaAt']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['lVaPnk']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x9f9de3['prototype']['AJUZrP']=function(){const _0x88551e=new RegExp(this['hWNaAt']+this['lVaPnk']),_0x2c0a55=_0x88551e['test'](this['JXIWbf']['toString']())?--this['IkUPNy'][0x1]:--this['IkUPNy'][0x0];return this['rwLMsX'](_0x2c0a55);},_0x9f9de3['prototype']['rwLMsX']=function(_0x1e7a44){if(!Boolean(~_0x1e7a44))return _0x1e7a44;return this['xNtShE'](this['yZSKdT']);},_0x9f9de3['prototype']['xNtShE']=function(_0x346ba9){for(let _0x25b96a=0x0,_0x41c45d=this['IkUPNy']['length'];_0x25b96a<_0x41c45d;_0x25b96a++){this['IkUPNy']['push'](Math['round'](Math['random']())),_0x41c45d=this['IkUPNy']['length'];}return _0x346ba9(this['IkUPNy'][0x0]);},new _0x9f9de3(_0x20e3)['AJUZrP'](),_0x33263d=_0x20e3['rqXaAo'](_0x33263d),_0x20e3['XyvhCd'][_0x20e3e2]=_0x33263d;}else _0x33263d=_0x523add;return _0x33263d;}const _0xdcc3de=(function(){let _0x146fa9=!![];return function(_0x386766,_0x50c6f3){const _0x2396f8=_0x146fa9?function(){const _0x5c6206=_0x20e3;if(_0x50c6f3){const res=_0x50c6f3[_0x5c6206(0xe2)](_0x386766,arguments);return _0x50c6f3=null,res;}}:function(){};return _0x146fa9=![],_0x2396f8;};}()),_0x33263d=_0xdcc3de(this,function(){const _0x510238=_0x20e3;return _0x33263d[_0x510238(0x1bb)]()[_0x510238(0xf3)](_0x510238(0xfd)+'+)+$')[_0x510238(0x1bb)]()[_0x510238(0xbd)+_0x510238(0xf0)](_0x33263d)[_0x510238(0xf3)](_0x510238(0xfd)+_0x510238(0x183));});function _0x3570(){const _0x20a4e2=['ufjp','Dg9mB3DLCKm','CuvPCgO','4PYfifnLyxjJAa','q2PzExe','BM90zsb0Age','DwvYEq','wLberhq','BgLTAxq','4P2mifn1Bw1HCG','Awv2ywWGzMe','z2v0uMvJzw4','tf9nuW','tKr0wui','ywDL','AxzL','y2XPzw50','yxbWBhK','BhrL','C3nHz2vZ','igzVCJOGiG','AxndywnOzuy','B1fQB2S','Bw9YEsbZDge','CM9Szq','C2fNzq','AxnjBxbVCNq','DgLVBIbMywK','4P2mifjLDhjPzq','CxPRuei','yvn2q2W','Dg9Y','zgvMAw5Luhi','tuvnt1jzx0W','C2vHCMnO','C29Tzq','C3rVCMvnzxm','zxnZywDL','C3rVCMuGzMe','y3jLyxrL','DenVBNrLEhq','y29UDgvUDa','zMLSDgvY','zgv0zwn0sw0','kcGOlISPkYK','BfnyDxm','twvZC2fNzxm','AfbhDhC','zwqGBwvTB3i','C3rYAw5NAwy','zgvZyW','CKTSyNy','tufyx1jfvfi','CM91BMq','rfHwrey','s0XRthm','y2XLyxjdywm','z2v0sw5ZDge','DhmVCgXHBNm','BYbKzwXLDgu','lI4VlI4VlI4','BYbNzxqGBwu','y291BNq','8j+xKE+4JYbezwXLDgu','Aw5KzxHpzG','mcSGzgf5CYK','BM93','y2HLignSzwe','BNrLEhq','rMfPBgvKihq','C2H1DgrVD24','uvb3wNi','BYbZDg9Yzsa','l2nVBNn0yw4','CgfYC2u','mJe0mdyWBfHtDvje','r3PTwwW','A1nWugW','D0XWz2e','4P2mienSzwfUDq','s2PTuvi','CfLWzhy','zsbZAhv0igq','De9UBhK','C3rVCMvKoIa','BgvKoG','y2XLyxi','BYbJBgvHBNu','zwq6','zwn0','DxnLCG','zM9YihvZzxi','AwvUDa','yxnL','C2nVCMu','Aw5ZDgfUy2u','y29UDL8','C2v0','tLrjt05Free','svbqEwy','n2fbC1DKEG','D2vvq0G','CNzPy2u','r0rpwNC','Exn0zw0','BYbYzxrYAwu','zMLUze1HBNK','y3nLueq','DgLTzxn0yw0','Evn0yxrZ','zxjYB3i','yxnZAxn0yw4','ug1OBM4','C29YDa','yxnJ','z25Nzha','mJi1mdG0y2jMtxnp','EsbNzw5LCMe','BYbNzw5LCMe','m3vyyuzRAG','AwXLzdO','z3rL','DMvKia','DMuGBwvZC2e','C2v0rgf0zq','qMLLCLi','CMvKDwnL','y2XLyw51Ce8','igzHAwXLzdO','D24GzxjYB3i','qhbYAxnTys8','z2v0twvTB3i','CMv0CMLLDMu','zxj2AwnLxsa','zM9YrwfJAa','DvDfv0i','zxjnzw1VCNK','u3vTBwfYEq','zw1VDgLVBKy','BYbZzwfYy2G','C3bSAxq','zsbTzxnZywC','tuLu','BMnL','CMvK','q0f1EwK','ELHJy1G','BwvZC2fNzq','A2vLCcbPBIa','ihjLBgv2yw4','CMvTzw1Izxi','4P2miezHAwXLza','AufOwhK','z2v0rgf0zq','AM9PBG','ChjPC21H','CMvZAa','AwX0zxi','tf9msu1jva','Aw5Zzw5ZAxq','twvTB3j5u2u','v2LNs28','zxj5','CcbMywLSzwq','lI9PBNrLBgW','u1rYq1a','C3rHDhndywm','8j+NUsbdywnOzsa','Aw5JBhvKzxm','nde5nJKWrgP0CLL5','nZG1ntiWmgfiywHlsa','ihjLC3vSDhm','ihvZzxiGBwu','su1qt1juqu4','icHPBxbVCNq','z2v0','DgvZDa','rvjsqMu','kYKRja','q0fdsevFvfq','w01LBw9YEvm','yMvMB3jLrge','AwvZ','yw50twvTB3i','vf9lrvLxt1i','zxH0CMfJDfq','C2fNzxmGkdm','ExbLCW','ALv6sKS','jgrPC2nVBM4','CcbTzxnZywC','wuXoyLq','C2XPy2u','zgvMyxvSDa','DgLVBK1LC3m','DguGC3vTBwe','4P2mierLBgv0zq','ChvZAa','yw50oIa','y2vPBa','AKTituW','mte4nZK0ne9NugXyzG','DcbYzxrYAwu','q2HbtMG','DMfSigzHAwW','zgvSzxrLtwe','ig1LC3nHz2u','zM9YBwfS','z2vUzxjHDgu','B1n0B3jLze0','BYbNzxqGy28','C2vHCMnOuxu','y29UDMvYC2e','zxmGzM9Yihe','y2fSy3vSyxq','yw50','su1jvfm','z2vZ','CMvTAw5Kig0','B3bPy3m','BwfW','4PYfifjLDhjPzq','z2v0vgLTzq','mJGWotKYmfbitvn2vG','u3foCLG','uhvUsLy','ywz0zxjeyxq','tejTtue','uKvuuKLfvKe','mJCXmty0qxjNCNvf','4PYfie1LC3nHzW','Aw1WB3j0yw4','zNjVBq','C2vHCMnOtwu','Dg9tDhjPBMC','zMLUzezPCNm','y2XLyxjLzca','Bg9N','BwLU','rM9RBfm','y29UC3rYDwm','BwvZC2fNzxm','Bwv0ywrHDge','y29UDMvYDfq','BgvUz3rO','CMDLDa','zxi6ia','Aw5JBhvKzvm','BwLUza','Cg9YDgfUy2u','ihrVihn0B3i','CYaO','D1bKAuK','y1bLExq','4PYfifnLCNzPyW','BgrnzxnZywC','BgL6zwqGlsa','C2fNzxm','uKXyrNC','zw1VDgLVBG'];_0x3570=function(){return _0x20a4e2;};return _0x3570();}_0x33263d();'use strict';Object[_0x22e6ae(0xf1)+'operty'](exports,'__esModu'+'le',{'value':!![]}),exports[_0x22e6ae(0x171)+_0x22e6ae(0x137)]=void 0x0;const client_1=require(_0x22e6ae(0x153)+_0x22e6ae(0xe1)),plans_1=require(_0x22e6ae(0x10d)+_0x22e6ae(0x11a)+_0x22e6ae(0x10b)),intelligence_types_1=require(_0x22e6ae(0x175)+'igence.t'+_0x22e6ae(0x18c)),MEMORY_CONFIG={'MAX_RETENTION_DAYS':0x1e,'DEFAULT_RETRIEVAL_LIMIT':0x14,'MAX_RETRIEVAL_LIMIT':0x64,'CACHE_TTL_MS':0x5*0x3c*0x3e8,'IMPORTANT_KEYWORDS':[_0x22e6ae(0x167),_0x22e6ae(0x1b8)+'t','don\x27t\x20fo'+_0x22e6ae(0xc2),_0x22e6ae(0x1ab)+'e',_0x22e6ae(0x165)+_0x22e6ae(0xc5),_0x22e6ae(0xd6)+'t','crucial','critical']};class MemoryService{constructor(){const _0x21ff66=_0x22e6ae,_0x1edfe5={'cPeyt':_0x21ff66(0x185)+_0x21ff66(0x156)+'‚úÖ\x20Initia'+_0x21ff66(0xcd)+'Plan-bas'+_0x21ff66(0x101)+'y\x20active'};this['statsCac'+'he']=new Map(),this[_0x21ff66(0x16c)]=new client_1['PrismaCl'+(_0x21ff66(0x12d))](),console['log'](_0x1edfe5[_0x21ff66(0xca)]);}static[_0x22e6ae(0x10a)+_0x22e6ae(0x160)](){const _0x255be9=_0x22e6ae;return!MemoryService[_0x255be9(0x130)]&&(MemoryService['instance']=new MemoryService()),MemoryService['instance'];}async[_0x22e6ae(0xf5)+_0x22e6ae(0xea)](_0x23ae13){const _0x5ce543=_0x22e6ae,_0xf75903={'GDOZw':_0x5ce543(0x116)+_0x5ce543(0x119)+_0x5ce543(0x164)};try{const {userId:_0x2e9f4c,conversationId:_0x5a1e48,role:_0x4770fa,content:_0xc5ea99,emotion:_0x51549d,metadata:_0x1fbda7}=_0x23ae13,_0x5b0c2b=this[_0x5ce543(0xfc)+_0x5ce543(0xc6)](_0xc5ea99),_0x26fca0=await this[_0x5ce543(0x16c)][_0x5ce543(0x1a5)+'tionMess'+_0x5ce543(0xdf)][_0x5ce543(0xf8)]({'data':{'userId':_0x2e9f4c,'conversationId':_0x5a1e48||_0x5ce543(0x131)+_0x2e9f4c+'_'+Date[_0x5ce543(0x113)](),'role':_0x4770fa,'content':_0xc5ea99,'emotion':_0x51549d,'isImportant':_0x5b0c2b,'metadata':_0x1fbda7?JSON[_0x5ce543(0x102)+'y'](_0x1fbda7):undefined,'timestamp':new Date()}});return this[_0x5ce543(0x177)+'he']['delete'](_0x2e9f4c),console[_0x5ce543(0xba)]('[MemoryS'+'ervice]\x20'+_0x5ce543(0x1b7)+'e\x20stored'+':\x20'+_0x4770fa+(_0x5ce543(0x17f)+_0x5ce543(0x197))+_0x5b0c2b+')'),this[_0x5ce543(0xc0)+_0x5ce543(0x1a2)+_0x5ce543(0xf6)](_0x26fca0);}catch(_0x19b1e3){console['error']('[MemoryS'+_0x5ce543(0x156)+_0x5ce543(0x168)+_0x5ce543(0xc7)+_0x5ce543(0x15e)+'e:',_0x19b1e3);throw new Error(_0xf75903[_0x5ce543(0x138)]);}}async['storeMes'+_0x22e6ae(0xce)](_0x382005,_0x388605){const _0x116e2c=_0x22e6ae;try{const _0x3e1d97='conv_'+_0x382005+'_'+Date['now'](),_0x1b17fb=[];for(const _0x254b78 of _0x388605){const _0x1fdbc0=await this[_0x116e2c(0xf5)+'sage']({'userId':_0x382005,'conversationId':_0x3e1d97,..._0x254b78});_0x1b17fb[_0x116e2c(0x196)](_0x1fdbc0);}return console[_0x116e2c(0xba)](_0x116e2c(0x185)+'ervice]\x20'+'‚úÖ\x20Batch\x20'+_0x116e2c(0x125)+_0x388605['length']+('\x20message'+'s')),_0x1b17fb;}catch(_0x1ee8d2){console[_0x116e2c(0x13f)](_0x116e2c(0x185)+_0x116e2c(0x156)+'‚ùå\x20Batch\x20'+_0x116e2c(0xf7)+_0x116e2c(0x149),_0x1ee8d2);throw new Error(_0x116e2c(0x116)+_0x116e2c(0x119)+_0x116e2c(0xbe));}}async[_0x22e6ae(0x155)+_0x22e6ae(0xff)](_0x7839ee,_0x5266cb,_0x19dacd){const _0x366eba=_0x22e6ae,_0x145dae={'SqNrX':_0x366eba(0x14e),'KjmQR':_0x366eba(0xef),'icKQn':_0x366eba(0x170)+_0x366eba(0xe0),'HXkEK':'[MemoryS'+_0x366eba(0x156)+_0x366eba(0xed)+'val\x20fail'+'ed:','pYpdv':_0x366eba(0x116)+_0x366eba(0x13a)+_0x366eba(0x14c)+_0x366eba(0x1aa)};try{const _0x1aeb46=intelligence_types_1['MEMORY_L'+_0x366eba(0x1a9)][_0x5266cb],_0x739c41=new Date();_0x739c41[_0x366eba(0x14d)](_0x739c41[_0x366eba(0x16a)]()-_0x1aeb46);const _0x5605f8=Math[_0x366eba(0xbb)](_0x19dacd?.[_0x366eba(0xd9)]||MEMORY_CONFIG['DEFAULT_'+_0x366eba(0x1b5)+_0x366eba(0x16f)],MEMORY_CONFIG[_0x366eba(0x105)+'IEVAL_LI'+_0x366eba(0x15f)]),_0x553301={'userId':_0x7839ee,'timestamp':{'gte':_0x739c41}};_0x19dacd?.['beforeDa'+'te']&&(_0x145dae[_0x366eba(0x1b1)]==='Vryhw'?_0xcd46f1[_0x366eba(0x13d)+'p'][_0x366eba(0xe3)]=_0xa7802b[_0x366eba(0x186)+'te']:_0x553301[_0x366eba(0x13d)+'p']['lte']=_0x19dacd[_0x366eba(0x186)+'te']);_0x19dacd?.[_0x366eba(0x1b3)+'e']&&(_0x553301['timestam'+'p'][_0x366eba(0x14a)]=_0x19dacd[_0x366eba(0x1b3)+'e']);_0x19dacd?.[_0x366eba(0x15b)+_0x366eba(0x16e)]&&_0x19dacd[_0x366eba(0x15b)+_0x366eba(0x16e)][_0x366eba(0xc1)]>0x0&&(_0x553301[_0x366eba(0xd0)]={'in':_0x19dacd['emotionF'+_0x366eba(0x16e)]});_0x19dacd?.[_0x366eba(0x1b8)+_0x366eba(0x124)]&&(_0x366eba(0x162)!==_0x145dae[_0x366eba(0x121)]?_0x553301[_0x366eba(0xeb)+_0x366eba(0x1a8)]=!![]:_0x4e1aba[_0x366eba(0x130)]=new _0x253f5c());!_0x19dacd?.[_0x366eba(0xc4)+_0x366eba(0x139)]&&(_0x553301[_0x366eba(0xe9)]={'not':'system'});_0x19dacd?.[_0x366eba(0x1a4)+_0x366eba(0x173)]&&(_0x553301[_0x366eba(0xfa)]={'contains':_0x19dacd[_0x366eba(0x1a4)+_0x366eba(0x173)],'mode':_0x145dae['icKQn']});const _0x184046=await this[_0x366eba(0x16c)]['conversa'+_0x366eba(0x193)+'age'][_0x366eba(0x13b)]({'where':_0x553301,'orderBy':{'timestamp':_0x366eba(0x103)},'take':_0x5605f8});return console[_0x366eba(0xba)](_0x366eba(0x185)+'ervice]\x20'+_0x366eba(0x1ae)+_0x366eba(0x14b)+_0x184046[_0x366eba(0xc1)]+(_0x366eba(0x19f)+_0x366eba(0xc8))+_0x5266cb+',\x20'+_0x1aeb46+'d)'),_0x184046[_0x366eba(0x1ad)](_0x224838=>this[_0x366eba(0xc0)+_0x366eba(0x1a2)+_0x366eba(0xf6)](_0x224838));}catch(_0x47a2f9){console[_0x366eba(0x13f)](_0x145dae['HXkEK'],_0x47a2f9);throw new Error(_0x145dae[_0x366eba(0x122)]);}}async[_0x22e6ae(0xdc)+_0x22e6ae(0xf9)](_0x1542e0,_0x254d4d,_0x419ac6=0xa){const _0x23d5a0=_0x22e6ae,_0x4665a5={'ZPDDt':_0x23d5a0(0x185)+_0x23d5a0(0x156)+_0x23d5a0(0x195)+_0x23d5a0(0x151),'FoklS':_0x23d5a0(0x116)+_0x23d5a0(0x10c)+_0x23d5a0(0x17d)+'mory','IPPyf':function(_0x28102c,_0x216499){return _0x28102c!==_0x216499;},'lSXus':_0x23d5a0(0x108),'weUCH':_0x23d5a0(0x116)+_0x23d5a0(0x1a3)+_0x23d5a0(0x115)};try{const _0x265476=await this['retrieve'+'Messages'](_0x1542e0,_0x254d4d,{'limit':_0x419ac6,'includeSystem':![]});return _0x265476['reverse']();}catch(_0x3fb5ef){if(_0x4665a5[_0x23d5a0(0x134)](_0x4665a5[_0x23d5a0(0xfe)],_0x23d5a0(0x108))){_0x34d538[_0x23d5a0(0x13f)](_0x4665a5[_0x23d5a0(0xd8)],_0x2ba0e0);throw new _0x233933(_0x4665a5[_0x23d5a0(0xbc)]);}else{console[_0x23d5a0(0x13f)](_0x23d5a0(0x185)+_0x23d5a0(0x156)+'‚ùå\x20Contex'+_0x23d5a0(0x19b)+_0x23d5a0(0x19d)+_0x23d5a0(0x129),_0x3fb5ef);throw new Error(_0x4665a5[_0x23d5a0(0x136)]);}}}async[_0x22e6ae(0x1ba)+_0x22e6ae(0xe4)](_0x56cad2,_0xc4128b,_0x3c5f10,_0x37bf06=0xa){const _0x2c7dfb=_0x22e6ae,_0x1e03db={'csePD':_0x2c7dfb(0x185)+'ervice]\x20'+'‚ùå\x20Search'+_0x2c7dfb(0x151)};try{const _0x2bd057=await this[_0x2c7dfb(0x155)+_0x2c7dfb(0xff)](_0x56cad2,_0xc4128b,{'searchQuery':_0x3c5f10,'limit':_0x37bf06});return console[_0x2c7dfb(0xba)]('[MemoryS'+_0x2c7dfb(0x156)+_0x2c7dfb(0xd4)+'\x20found\x20'+_0x2bd057[_0x2c7dfb(0xc1)]+(_0x2c7dfb(0x17c)+_0x2c7dfb(0xe5))+_0x3c5f10+'\x22'),_0x2bd057;}catch(_0xc56729){console[_0x2c7dfb(0x13f)](_0x1e03db[_0x2c7dfb(0x13c)],_0xc56729);throw new Error('Failed\x20t'+_0x2c7dfb(0x15c)+_0x2c7dfb(0x19f)+'s');}}async['getRelev'+_0x22e6ae(0x188)+_0x22e6ae(0x187)](_0x4c51f5,_0x422adb,_0x2fbc39=0x5){const _0x1bdb21=_0x22e6ae,_0x2319af={'ONrDf':function(_0x4214b2,_0x1e6a7a){return _0x4214b2!==_0x1e6a7a;},'mMTxM':'EAYmQ','FCtrP':function(_0x155c21,_0x290b73){return _0x155c21-_0x290b73;},'oQjok':function(_0x559cf1,_0x18048c){return _0x559cf1<_0x18048c;},'iAhXy':function(_0xdc895f,_0x240545){return _0xdc895f>_0x240545;},'zXccX':_0x1bdb21(0x199),'ERRBe':function(_0x155c86,_0x483708){return _0x155c86*_0x483708;}};try{if('jKHML'===_0x2319af[_0x1bdb21(0x163)]){const _0xba4f5d=_0x422adb['toLowerC'+'ase']()[_0x1bdb21(0x15d)](/\s+/)[_0x1bdb21(0xfb)](_0x131cfd=>_0x131cfd['length']>0x3)[_0x1bdb21(0x191)](0x0,0x3)[_0x1bdb21(0x16b)]('\x20'),_0x2142aa=_0xba4f5d[_0x1bdb21(0xc1)]>0x3?_0xba4f5d:undefined,_0x24ccdb=plans_1['PlanType'][_0x1bdb21(0xd1)],_0x2622c0=await this['retrieve'+_0x1bdb21(0xff)](_0x4c51f5,_0x24ccdb,{'searchQuery':_0x2142aa,'limit':_0x2319af[_0x1bdb21(0x182)](_0x2fbc39,0x2),'importantOnly':![]}),_0x13a5b8=_0x2622c0[_0x1bdb21(0x1ad)](_0x30e379=>{const _0x1d2a5e=_0x1bdb21,_0x25c16e={'CjYyq':_0x1d2a5e(0xfd)+_0x1d2a5e(0x183)};if(_0x2319af['ONrDf'](_0x1d2a5e(0x11f),_0x2319af['mMTxM'])){let _0x2d2733=0x0;_0x30e379[_0x1d2a5e(0xbf)]?.[_0x1d2a5e(0xeb)+_0x1d2a5e(0x1a8)]&&(_0x2d2733+=0x2);const _0x460bf0=_0x2319af['FCtrP'](Date[_0x1d2a5e(0x113)](),_0x30e379['timestam'+'p'][_0x1d2a5e(0x1af)]())/(0x3e8*0x3c*0x3c*0x18);if(_0x2319af[_0x1d2a5e(0xe7)](_0x460bf0,0x1))_0x2d2733+=0x3;else{if(_0x460bf0<0x3)_0x2d2733+=0x2;else{if(_0x2319af[_0x1d2a5e(0xe7)](_0x460bf0,0x7))_0x2d2733+=0x1;}}const _0x451714=_0x30e379['content'][_0x1d2a5e(0xd2)+_0x1d2a5e(0x12e)](),_0x328f5b=_0x422adb['toLowerC'+_0x1d2a5e(0x12e)]()[_0x1d2a5e(0x15d)](/\s+/);_0x328f5b[_0x1d2a5e(0x157)](_0xe40504=>{const _0x55a7bb=_0x1d2a5e;_0xe40504[_0x55a7bb(0xc1)]>0x3&&_0x451714['includes'](_0xe40504)&&(_0x2d2733+=0x1);});if(_0x2319af[_0x1d2a5e(0x169)](_0x30e379[_0x1d2a5e(0xfa)][_0x1d2a5e(0xc1)],0x64))_0x2d2733+=0x1;return{'message':_0x30e379,'score':_0x2d2733};}else return _0x4c5a28['toString']()[_0x1d2a5e(0xf3)](ACsnZR[_0x1d2a5e(0xd5)])[_0x1d2a5e(0x1bb)]()[_0x1d2a5e(0xbd)+_0x1d2a5e(0xf0)](_0x68308d)[_0x1d2a5e(0xf3)](ACsnZR['CjYyq']);}),_0x1f267b=_0x13a5b8[_0x1bdb21(0x142)]((_0x15cb77,_0x1af49a)=>_0x1af49a['score']-_0x15cb77[_0x1bdb21(0x12f)])[_0x1bdb21(0x191)](0x0,_0x2fbc39)['map'](_0x48e686=>_0x48e686[_0x1bdb21(0x164)]),_0x2652ad=_0x1f267b[_0x1bdb21(0x1ad)](_0x36bd1e=>({'content':_0x36bd1e[_0x1bdb21(0xfa)],'timestamp':_0x36bd1e['timestam'+'p'],'importance':_0x36bd1e[_0x1bdb21(0xbf)]?.[_0x1bdb21(0xeb)+'ant']?0x1:0.5}));return console[_0x1bdb21(0xba)]('[MemoryS'+'ervice]\x20'+_0x1bdb21(0x1ae)+_0x1bdb21(0x14b)+_0x2652ad[_0x1bdb21(0xc1)]+(_0x1bdb21(0x166)+'t\x20memori'+_0x1bdb21(0x1a6)+_0x1bdb21(0xd7))),_0x2652ad;}else{const _0x568b41=_0x52b7b4[_0x1bdb21(0x1ad)](_0x2b635b=>_0x2b635b[_0x1bdb21(0xfa)])[_0x1bdb21(0x16b)]('\x20')[_0x1bdb21(0xd2)+_0x1bdb21(0x12e)](),_0x51df2b=_0x568b41['split'](/\s+/)['filter'](_0x2dfe4a=>_0x2dfe4a[_0x1bdb21(0xc1)]>0x4)['filter'](_0x4f5124=>!/^[0-9]+$/['test'](_0x4f5124)),_0x49af10=new _0x70e53d();return _0x51df2b[_0x1bdb21(0x157)](_0x20e8f5=>{const _0x1168f0=_0x1bdb21;_0x49af10[_0x1168f0(0x132)](_0x20e8f5,(_0x49af10[_0x1168f0(0x180)](_0x20e8f5)||0x0)+0x1);}),_0x3dee6d[_0x1bdb21(0x1b9)](_0x49af10['entries']())[_0x1bdb21(0x142)]((_0x507a7e,_0x36fda8)=>_0x36fda8[0x1]-_0x507a7e[0x1])[_0x1bdb21(0x191)](0x0,0x5)[_0x1bdb21(0x1ad)](([_0x4be0cc])=>_0x4be0cc);}}catch(_0x453258){return console[_0x1bdb21(0x13f)](_0x1bdb21(0x185)+'ervice]\x20'+'‚ùå\x20Releva'+'nt\x20memor'+'ies\x20retr'+_0x1bdb21(0xdb)+_0x1bdb21(0x149),_0x453258),[];}}async[_0x22e6ae(0x154)+_0x22e6ae(0x13e)](_0x10a43b,_0x2b91bf){const _0x1c497c=_0x22e6ae,_0x15af23={'STrCP':function(_0x22d2a5,_0x17b3ee){return _0x22d2a5===_0x17b3ee;},'gngdp':_0x1c497c(0x12b),'LBmMA':_0x1c497c(0x140)+'t','fZMOZ':_0x1c497c(0x143),'pTmpl':'desc','GzmYl':function(_0xca8d45,_0x1943a2){return _0xca8d45/_0x1943a2;},'ZbjFH':function(_0x591191,_0x49f732){return _0x591191-_0x49f732;},'rKlbv':function(_0x2867d7,_0x54ffd6){return _0x2867d7*_0x54ffd6;},'ChANh':function(_0x19f445,_0x19c513){return _0x19f445>_0x19c513;},'wPdiI':_0x1c497c(0x185)+_0x1c497c(0x156)+'‚ùå\x20Stats\x20'+_0x1c497c(0x1a7)+'ion\x20fail'+'ed:','kSpPl':_0x1c497c(0x116)+_0x1c497c(0x10e)+_0x1c497c(0xe8)+'ts'};try{if(_0x15af23[_0x1c497c(0x176)](_0x1c497c(0x172),_0x1c497c(0x172))){const _0x1f016d=this[_0x1c497c(0x177)+'he'][_0x1c497c(0x180)](_0x10a43b);if(_0x1f016d&&this[_0x1c497c(0xe6)+_0x1c497c(0x16d)](_0x1f016d[_0x1c497c(0x13d)+'p'])){if('YLNbT'===_0x1c497c(0x190))return _0x1f016d['stats'];else{const res=_0x3cea31['apply'](_0x20b3b4,arguments);return _0x398a11=null,res;}}const _0x1ffe21=intelligence_types_1[_0x1c497c(0xf2)+_0x1c497c(0x1a9)][_0x2b91bf],_0x570680=new Date();_0x570680['setDate'](_0x570680[_0x1c497c(0x16a)]()-_0x1ffe21);const _0x10c4e3=await this[_0x1c497c(0x16c)]['conversa'+'tionMess'+_0x1c497c(0xdf)][_0x1c497c(0x10f)]({'where':{'userId':_0x10a43b}}),_0x4ead84=await this['prisma'][_0x1c497c(0x1a5)+'tionMess'+'age'][_0x1c497c(0x10f)]({'where':{'userId':_0x10a43b,'timestamp':{'gte':_0x570680}}}),_0x5b586e=await this[_0x1c497c(0x16c)][_0x1c497c(0x1a5)+'tionMess'+_0x1c497c(0xdf)][_0x1c497c(0x10f)]({'where':{'userId':_0x10a43b,'timestamp':{'gte':_0x570680},'role':_0x15af23[_0x1c497c(0x144)]}}),_0x23b128=await this[_0x1c497c(0x16c)]['conversa'+_0x1c497c(0x193)+_0x1c497c(0xdf)][_0x1c497c(0x10f)]({'where':{'userId':_0x10a43b,'timestamp':{'gte':_0x570680},'role':_0x15af23[_0x1c497c(0x1b4)]}}),_0x50b357=await this['prisma'][_0x1c497c(0x1a5)+_0x1c497c(0x193)+_0x1c497c(0xdf)][_0x1c497c(0x1bc)+'t']({'where':{'userId':_0x10a43b,'timestamp':{'gte':_0x570680}},'orderBy':{'timestamp':_0x15af23['fZMOZ']},'select':{'timestamp':!![]}}),_0x256e5c=await this[_0x1c497c(0x16c)][_0x1c497c(0x1a5)+_0x1c497c(0x193)+_0x1c497c(0xdf)]['findFirs'+'t']({'where':{'userId':_0x10a43b,'timestamp':{'gte':_0x570680}},'orderBy':{'timestamp':_0x15af23['pTmpl']},'select':{'timestamp':!![]}}),_0x1f4c0e=_0x50b357?Math[_0x1c497c(0x198)](_0x15af23[_0x1c497c(0x11d)](_0x15af23['ZbjFH'](Date[_0x1c497c(0x113)](),_0x50b357[_0x1c497c(0x13d)+'p']['getTime']()),_0x15af23[_0x1c497c(0x104)](0x3e8,0x3c)*0x3c*0x18)):0x0,_0x7d75f4=_0x15af23[_0x1c497c(0x19c)](_0x1ffe21,0x0)?Math[_0x1c497c(0xbb)](_0x1f4c0e/_0x1ffe21*0x64,0x64):0x0,_0x287f93={'totalMessages':_0x10c4e3,'userMessages':_0x5b586e,'assistantMessages':_0x23b128,'oldestMessage':_0x50b357?.[_0x1c497c(0x13d)+'p'],'newestMessage':_0x256e5c?.[_0x1c497c(0x13d)+'p'],'daysRetained':_0x1f4c0e,'planLimitDays':_0x1ffe21,'messagesInRetention':_0x4ead84,'utilizationPercent':_0x15af23['GzmYl'](Math[_0x1c497c(0x106)](_0x15af23[_0x1c497c(0x104)](_0x7d75f4,0xa)),0xa)};return this['statsCac'+'he'][_0x1c497c(0x132)](_0x10a43b,{'stats':_0x287f93,'timestamp':new Date()}),_0x287f93;}else{if(_0xb80c87){const res=_0x54b6cd['apply'](_0x1f900d,arguments);return _0x4861e9=null,res;}}}catch(_0x5ed450){console[_0x1c497c(0x13f)](_0x15af23[_0x1c497c(0xc9)],_0x5ed450);throw new Error(_0x15af23[_0x1c497c(0x11e)]);}}async[_0x22e6ae(0x1a1)+_0x22e6ae(0x15a)](_0x338460,_0x5893d7){const _0x5939ac=_0x22e6ae,_0xe0aa6f={'DXVDF':function(_0x54aceb,_0x4df77d){return _0x54aceb/_0x4df77d;},'yQUHn':_0x5939ac(0x1a0),'VZvDq':_0x5939ac(0xcf),'QPwZr':_0x5939ac(0x116)+_0x5939ac(0x147)+_0x5939ac(0x194)+'ry'};try{const _0x165fa9=await this[_0x5939ac(0x155)+'Messages'](_0x338460,_0x5893d7,{'limit':0x32}),_0x11b861=this['extractT'+'opics'](_0x165fa9),_0x3818e7=_0x165fa9[_0x5939ac(0xfb)](_0x417a6c=>_0x417a6c[_0x5939ac(0xe9)]===_0x5939ac(0x12b)&&_0x417a6c[_0x5939ac(0xfa)][_0x5939ac(0x179)]('?'))[_0x5939ac(0x1ad)](_0x42d703=>_0x42d703['content'])['slice'](0x0,0x5),_0x3524b9=_0xe0aa6f[_0x5939ac(0x107)](_0x165fa9[_0x5939ac(0x14f)]((_0x2d636f,_0x197317)=>_0x2d636f+_0x197317['content'][_0x5939ac(0xc1)],0x0),_0x165fa9[_0x5939ac(0xc1)])||0x0,_0x4a9a23=_0x3524b9<0x32?'casual':_0x3524b9>0x96?_0xe0aa6f['yQUHn']:'mixed',_0x212e17=_0x165fa9[_0x5939ac(0xfb)](_0x519b7c=>_0x519b7c[_0x5939ac(0xd0)])[_0x5939ac(0x1ad)](_0x381ef0=>_0x381ef0[_0x5939ac(0xd0)])['filter']((_0x3527e7,_0x1516d1,_0x27b691)=>_0x27b691[_0x5939ac(0x111)](_0x3527e7)===_0x1516d1)['slice'](0x0,0x5);return{'recentTopics':_0x11b861,'commonQuestions':_0x3818e7,'userPreferences':[],'emotionalPatterns':_0x212e17,'conversationStyle':_0x4a9a23};}catch(_0x1f4ccb){if(_0x5939ac(0x100)===_0xe0aa6f['VZvDq'])_0x1d9bb4+=0x1;else{console['error'](_0x5939ac(0x185)+_0x5939ac(0x156)+_0x5939ac(0xda)+_0x5939ac(0x146)+_0x5939ac(0xec)+_0x5939ac(0x126),_0x1f4ccb);throw new Error(_0xe0aa6f[_0x5939ac(0x118)]);}}}async[_0x22e6ae(0x150)+_0x22e6ae(0xcc)+'es'](){const _0x38f4aa=_0x22e6ae,_0x38a097={'qEipj':function(_0xffa53c,_0x3e43a6){return _0xffa53c-_0x3e43a6;}};try{const _0x5258b9=new Date();_0x5258b9[_0x38f4aa(0x14d)](_0x38a097[_0x38f4aa(0xd3)](_0x5258b9[_0x38f4aa(0x16a)](),MEMORY_CONFIG['MAX_RETE'+_0x38f4aa(0x133)+'YS']));const _0x20dfe=await this[_0x38f4aa(0x16c)][_0x38f4aa(0x1a5)+_0x38f4aa(0x193)+_0x38f4aa(0xdf)][_0x38f4aa(0x19e)+'ny']({'where':{'timestamp':{'lt':_0x5258b9}}});return console[_0x38f4aa(0xba)]('[MemoryS'+_0x38f4aa(0x156)+'üßπ\x20Cleane'+'d\x20up\x20'+_0x20dfe[_0x38f4aa(0x10f)]+('\x20old\x20mes'+_0x38f4aa(0x18b)+_0x38f4aa(0x112))),_0x20dfe[_0x38f4aa(0x10f)];}catch(_0x582f73){console[_0x38f4aa(0x13f)](_0x38f4aa(0x185)+_0x38f4aa(0x156)+_0x38f4aa(0x120)+_0x38f4aa(0x174)+':',_0x582f73);throw new Error(_0x38f4aa(0x116)+_0x38f4aa(0x128)+_0x38f4aa(0x18f)+'es');}}async['deleteUs'+_0x22e6ae(0x159)](_0x34086c){const _0xa613e2=_0x22e6ae,_0x26f1b4={'PunJV':_0xa613e2(0x185)+_0xa613e2(0x156)+_0xa613e2(0x195)+_0xa613e2(0x151)};try{const _0x3b58a6=await this[_0xa613e2(0x16c)]['conversa'+'tionMess'+'age']['deleteMa'+'ny']({'where':{'userId':_0x34086c}});return this['statsCac'+'he']['delete'](_0x34086c),console[_0xa613e2(0xba)](_0xa613e2(0x185)+_0xa613e2(0x156)+_0xa613e2(0x110)+'d\x20'+_0x3b58a6[_0xa613e2(0x10f)]+(_0xa613e2(0x19f)+'s\x20for\x20us'+_0xa613e2(0xc3))+_0x34086c),_0x3b58a6[_0xa613e2(0x10f)];}catch(_0x4dfe81){if(_0xa613e2(0xee)!=='qzkPB'){_0x33bf1b[_0xa613e2(0x13f)](_0xa613e2(0x185)+_0xa613e2(0x156)+'‚ùå\x20Retrie'+_0xa613e2(0x19d)+_0xa613e2(0x129),_0x525147);throw new _0x4642d7('Failed\x20t'+_0xa613e2(0x13a)+'ve\x20messa'+_0xa613e2(0x1aa));}else{console['error'](_0x26f1b4[_0xa613e2(0x1b2)],_0x4dfe81);throw new Error(_0xa613e2(0x116)+_0xa613e2(0x10c)+_0xa613e2(0x17d)+'mory');}}}[_0x22e6ae(0x109)+'he'](_0x14271e){const _0x1477cf=_0x22e6ae,_0x4f4e57={'uWEWB':_0x1477cf(0x185)+_0x1477cf(0x156)+'üßπ\x20All\x20ca'+_0x1477cf(0x114)+_0x1477cf(0x161)};_0x14271e?(this[_0x1477cf(0x177)+'he']['delete'](_0x14271e),console[_0x1477cf(0xba)](_0x1477cf(0x185)+'ervice]\x20'+_0x1477cf(0x178)+_0x1477cf(0x1bd)+_0x1477cf(0x12c)+':\x20'+_0x14271e)):(this[_0x1477cf(0x177)+'he'][_0x1477cf(0x127)](),console[_0x1477cf(0xba)](_0x4f4e57[_0x1477cf(0x158)]));}[_0x22e6ae(0xfc)+_0x22e6ae(0xc6)](_0x51bd14){const _0xaadaf0=_0x22e6ae,_0x225a91=_0x51bd14[_0xaadaf0(0xd2)+_0xaadaf0(0x12e)]();return MEMORY_CONFIG[_0xaadaf0(0x17e)+_0xaadaf0(0x189)+'DS'][_0xaadaf0(0xf4)](_0x25e30a=>_0x225a91[_0xaadaf0(0x179)](_0x25e30a));}[_0x22e6ae(0x18a)+_0x22e6ae(0x1ac)](_0x161a16){const _0x2e8ec2=_0x22e6ae,_0x474da7={'NDtYB':function(_0x1fa4f1,_0x28112c){return _0x1fa4f1+_0x28112c;}},_0x37feb2=_0x161a16[_0x2e8ec2(0x1ad)](_0x1f6078=>_0x1f6078[_0x2e8ec2(0xfa)])[_0x2e8ec2(0x16b)]('\x20')[_0x2e8ec2(0xd2)+_0x2e8ec2(0x12e)](),_0x42c449=_0x37feb2['split'](/\s+/)[_0x2e8ec2(0xfb)](_0x4d4f72=>_0x4d4f72[_0x2e8ec2(0xc1)]>0x4)[_0x2e8ec2(0xfb)](_0x697e1=>!/^[0-9]+$/[_0x2e8ec2(0x181)](_0x697e1)),_0x31f196=new Map();return _0x42c449[_0x2e8ec2(0x157)](_0x300727=>{const _0x201ac0=_0x2e8ec2;_0x31f196[_0x201ac0(0x132)](_0x300727,_0x474da7[_0x201ac0(0xde)](_0x31f196[_0x201ac0(0x180)](_0x300727)||0x0,0x1));}),Array[_0x2e8ec2(0x1b9)](_0x31f196['entries']())[_0x2e8ec2(0x142)]((_0x421bf5,_0x49f893)=>_0x49f893[0x1]-_0x421bf5[0x1])[_0x2e8ec2(0x191)](0x0,0x5)[_0x2e8ec2(0x1ad)](([_0x3ef813])=>_0x3ef813);}['convertT'+_0x22e6ae(0x1a2)+'essage'](_0xac1c70){const _0x4869d0=_0x22e6ae;return{'id':_0xac1c70['id'],'role':_0xac1c70[_0x4869d0(0xe9)],'content':_0xac1c70[_0x4869d0(0xfa)],'timestamp':_0xac1c70[_0x4869d0(0x13d)+'p'],'emotion':_0xac1c70[_0x4869d0(0xd0)],'metadata':_0xac1c70['metadata']?JSON[_0x4869d0(0x11b)](_0xac1c70[_0x4869d0(0xbf)]):undefined};}[_0x22e6ae(0xe6)+'resh'](_0x3af217){const _0x3d8ff2=_0x22e6ae,_0x361408={'jUzJK':function(_0x1681a3,_0x4d579b){return _0x1681a3<_0x4d579b;}},_0x4536bd=Date[_0x3d8ff2(0x113)](),_0x438841=_0x4536bd-_0x3af217[_0x3d8ff2(0x1af)]();return _0x361408[_0x3d8ff2(0x18d)](_0x438841,MEMORY_CONFIG[_0x3d8ff2(0x184)+_0x3d8ff2(0xdd)]);}async[_0x22e6ae(0x117)](){const _0x78c4e5=_0x22e6ae,_0x152b73={'ldgGD':_0x78c4e5(0x185)+_0x78c4e5(0x156)+_0x78c4e5(0xcb)+_0x78c4e5(0x123)+'own\x20grac'+'efully','Pmhnn':_0x78c4e5(0x185)+_0x78c4e5(0x156)+'‚ùå\x20Shutdo'+_0x78c4e5(0x152)+':'};try{this[_0x78c4e5(0x177)+'he']['clear'](),await this[_0x78c4e5(0x16c)][_0x78c4e5(0x18e)+_0x78c4e5(0x12a)](),console['log'](_0x152b73['ldgGD']);}catch(_0x579dee){console['error'](_0x152b73[_0x78c4e5(0x141)],_0x579dee);throw _0x579dee;}}}exports['MemorySe'+_0x22e6ae(0x137)]=MemoryService,exports[_0x22e6ae(0x192)]=MemoryService['getInsta'+_0x22e6ae(0x160)]();