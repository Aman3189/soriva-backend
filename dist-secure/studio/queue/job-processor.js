const _0x3ab4c6=_0xf1c5;(function(_0xc07f9e,_0x3cb34a){const _0x50e203=_0xf1c5,_0x3761ba=_0xc07f9e();while(!![]){try{const _0x507fca=parseInt(_0x50e203(0x1ad))/0x1+parseInt(_0x50e203(0x1bf))/0x2+-parseInt(_0x50e203(0x19d))/0x3*(parseInt(_0x50e203(0x19a))/0x4)+-parseInt(_0x50e203(0x1c2))/0x5+parseInt(_0x50e203(0x1cf))/0x6+-parseInt(_0x50e203(0x201))/0x7+parseInt(_0x50e203(0x1ee))/0x8;if(_0x507fca===_0x3cb34a)break;else _0x3761ba['push'](_0x3761ba['shift']());}catch(_0x4c4a1a){_0x3761ba['push'](_0x3761ba['shift']());}}}(_0x4452,0x54fad));const _0x10a374=(function(){let _0x5570b7=!![];return function(_0x2b8966,_0x52d0f1){const _0x5d5ba7=_0x5570b7?function(){if(_0x52d0f1){const res=_0x52d0f1['apply'](_0x2b8966,arguments);return _0x52d0f1=null,res;}}:function(){};return _0x5570b7=![],_0x5d5ba7;};}()),_0x5263a2=_0x10a374(this,function(){const _0x32a94b=_0xf1c5;return _0x5263a2[_0x32a94b(0x1c1)]()[_0x32a94b(0x18d)](_0x32a94b(0x1c3)+_0x32a94b(0x1f8))[_0x32a94b(0x1c1)]()[_0x32a94b(0x1b7)+_0x32a94b(0x1d7)](_0x5263a2)['search'](_0x32a94b(0x1c3)+_0x32a94b(0x1f8));});_0x5263a2();'use strict';Object[_0x3ab4c6(0x18a)+_0x3ab4c6(0x1d3)](exports,'__esModu'+'le',{'value':!![]}),exports[_0x3ab4c6(0x1a5)+_0x3ab4c6(0x1b9)]=exports[_0x3ab4c6(0x205)+'eue']=void 0x0,exports[_0x3ab4c6(0x1ac)+_0x3ab4c6(0x1f7)]=addGenerationJob,exports[_0x3ab4c6(0x1bc)+_0x3ab4c6(0x1bd)]=getJobStatus;const tslib_1=require('tslib'),bullmq_1=require(_0x3ab4c6(0x188)),ioredis_1=tslib_1[_0x3ab4c6(0x19b)+_0x3ab4c6(0x1d9)](require(_0x3ab4c6(0x1a1))),prisma_service_1=require(_0x3ab4c6(0x1a9)+'re/servi'+_0x3ab4c6(0x1d5)+'ma.servi'+'ce'),client_1=require(_0x3ab4c6(0x1c6)+_0x3ab4c6(0x1b6)),connection=new ioredis_1[(_0x3ab4c6(0x1ae))]({'host':process['env'][_0x3ab4c6(0x1da)+'ST']||_0x3ab4c6(0x1dd)+'t','port':parseInt(process[_0x3ab4c6(0x1de)][_0x3ab4c6(0x1a6)+'RT']||_0x3ab4c6(0x1e7)),'maxRetriesPerRequest':null});exports['studioQu'+_0x3ab4c6(0x1b8)]=new bullmq_1['Queue']('studio-g'+_0x3ab4c6(0x1f1)+'ns',{'connection':connection});async function processStudioJob(_0x16f485){const _0x43db59=_0x3ab4c6,_0x248f9f={'YfBsK':function(_0x2a9740,_0x4d1382){return _0x2a9740===_0x4d1382;},'ucUvI':_0x43db59(0x1aa),'mNfjM':function(_0xb52741,_0x115c9a){return _0xb52741!==_0x115c9a;},'quLdv':'ZTQDQ','asViD':'yDtff','UFPwF':_0x43db59(0x1e9),'eSITv':'BANANA_P'+'RO','jQVKp':'Generati'+'on\x20faile'+'d'},{generationId:_0x5913a6,jobType:_0x506ca5,provider:_0x397b4b}=_0x16f485[_0x43db59(0x186)];console[_0x43db59(0x19c)]('[STUDIO\x20'+_0x43db59(0x1db)+_0x43db59(0x1f3)+_0x43db59(0x1a4)+_0x16f485['id']+_0x43db59(0x20a)+_0x397b4b+_0x43db59(0x20a)+_0x506ca5);try{if(_0x248f9f[_0x43db59(0x1a0)]('aAAei',_0x248f9f[_0x43db59(0x198)]))_0x34cb1a['error'](_0x43db59(0x1b4)+'WORKER]\x20'+_0x43db59(0x199),_0x19a6bf);else{const _0x5bb502=await prisma_service_1['prisma'][_0x43db59(0x1e2)+_0x43db59(0x1df)]['findUniq'+'ue']({'where':{'id':_0x5913a6}});if(!_0x5bb502){if(_0x248f9f['mNfjM'](_0x248f9f[_0x43db59(0x1ff)],_0x248f9f[_0x43db59(0x1ff)])){const res=_0x2c863e[_0x43db59(0x1d0)](_0x4e629b,arguments);return _0x2930d2=null,res;}else throw new Error('Generati'+_0x43db59(0x1e3)+_0x5913a6+(_0x43db59(0x1e6)+'nd'));}if(_0x5bb502[_0x43db59(0x195)]===client_1['Generati'+_0x43db59(0x196)][_0x43db59(0x202)+'D'])return console[_0x43db59(0x19c)](_0x43db59(0x1f2)+_0x5913a6+(']\x20Alread'+'y\x20comple'+_0x43db59(0x204))),{'success':!![],'skipped':!![]};if(_0x248f9f[_0x43db59(0x1a0)](_0x5bb502[_0x43db59(0x195)],client_1[_0x43db59(0x1b2)+_0x43db59(0x196)]['FAILED']))return _0x248f9f[_0x43db59(0x1a0)](_0x248f9f[_0x43db59(0x1be)],_0x43db59(0x1fd))?(console[_0x43db59(0x19c)](_0x43db59(0x207)+_0x5913a6+(_0x43db59(0x1bb)+_0x43db59(0x1dc))),{'success':![],'skipped':!![]}):_0x4ff49b[_0x43db59(0x1c1)]()[_0x43db59(0x18d)](_0x43db59(0x1c3)+_0x43db59(0x1f8))[_0x43db59(0x1c1)]()[_0x43db59(0x1b7)+_0x43db59(0x1d7)](_0x3d1ed9)[_0x43db59(0x18d)]('(((.+)+)'+_0x43db59(0x1f8));await prisma_service_1['prisma'][_0x43db59(0x1e2)+_0x43db59(0x1df)][_0x43db59(0x19f)]({'where':{'id':_0x5913a6},'data':{'status':client_1[_0x43db59(0x1b2)+_0x43db59(0x196)]['PROCESSI'+'NG']}});let _0x552724;switch(_0x397b4b){case _0x248f9f[_0x43db59(0x1c5)]:_0x552724=await processIdeogramJob(_0x16f485['data']);break;case _0x248f9f[_0x43db59(0x1e4)]:_0x552724=await processBananaJob(_0x16f485[_0x43db59(0x186)]);break;default:throw new Error(_0x43db59(0x1cd)+_0x43db59(0x1eb)+':\x20'+_0x397b4b);}return await prisma_service_1[_0x43db59(0x208)]['studioGe'+_0x43db59(0x1df)][_0x43db59(0x19f)]({'where':{'id':_0x5913a6},'data':{'status':client_1['Generati'+_0x43db59(0x196)][_0x43db59(0x202)+'D'],'outputUrl':_0x552724[_0x43db59(0x1af)+'l'],'metadata':_0x552724[_0x43db59(0x1c4)]||{},'completedAt':new Date()}}),console[_0x43db59(0x19c)](_0x43db59(0x1f2)+_0x5913a6+(_0x43db59(0x1ab)+_0x43db59(0x1cb))+_0x552724[_0x43db59(0x1af)+'l']),{'success':!![],'outputUrl':_0x552724[_0x43db59(0x1af)+'l']};}}catch(_0x2cf7af){console['error']('âŒ\x20[STUDI'+_0x43db59(0x1cc)+_0x43db59(0x18b)+_0x43db59(0x200)+_0x16f485['id'],_0x2cf7af[_0x43db59(0x194)]),await prisma_service_1[_0x43db59(0x208)]['studioGe'+_0x43db59(0x1df)]['update']({'where':{'id':_0x5913a6},'data':{'status':client_1[_0x43db59(0x1b2)+'onStatus'][_0x43db59(0x1fb)],'errorMessage':_0x2cf7af[_0x43db59(0x194)]||_0x248f9f[_0x43db59(0x1f4)],'completedAt':new Date()}})[_0x43db59(0x193)](()=>{});throw _0x2cf7af;}}async function processIdeogramJob(_0x460d28){const _0x4029bf=_0x3ab4c6,_0x4e1970={'PpURp':_0x4029bf(0x1e9),'zLZbI':_0x4029bf(0x1f9),'pbahe':function(_0x3dca2d,_0x6fc967){return _0x3dca2d||_0x6fc967;},'kAEts':_0x4029bf(0x1e0)},{prompt:_0x10bf88,style:_0x39e1ff,aspectRatio:_0xb7b9e5,negativePrompt:_0x473e3b}=_0x460d28;return console[_0x4029bf(0x19c)](_0x4029bf(0x1ea)+_0x4029bf(0x191)+'ating:\x20\x22'+_0x10bf88?.[_0x4029bf(0x197)+'g'](0x0,0x32)+_0x4029bf(0x1ce)),await new Promise(_0x503639=>setTimeout(_0x503639,0x7d0)),{'outputUrl':'https://'+_0x4029bf(0x192)+_0x4029bf(0x1c7)+_0x4029bf(0x1a8)+_0x4029bf(0x1a7)+_0x4029bf(0x18f)+_0x4029bf(0x1b0),'metadata':{'provider':_0x4e1970[_0x4029bf(0x1ed)],'style':_0x39e1ff||_0x4e1970[_0x4029bf(0x190)],'aspectRatio':_0x4e1970[_0x4029bf(0x1f5)](_0xb7b9e5,_0x4e1970['kAEts'])}};}function _0x4452(){const _0x18a50c=['zgvYlMjHBMe','Dg9Y','zgrLzcbQB2i','rgvMyxvSDa','uKvesvnFse8','uvvfvuvDifa','EsbMywLSzwq','Bg9JywXOB3m','zw52','BMvYyxrPB24','mtOX','zxjYB3i','C3r1zgLVr2u','B24G','zvnjvhy','AwfS','ig5VDcbMB3u','nJm3oq','tYbxt1jlrvi','surft0Dsqu0','w0Leru9huKe','ChjVDMLKzxi','ywrK','uhbvuNa','nJm3odK2mgjrqu9Pta','yxnVBG','w0jbtKfoqsa','zw5LCMf0Aw8','4PYfifS','CM9JzxnZAw4','ALfws3a','CgjHAgu','AM9IvhLWzq','yxrPB25kB2i','kYKRja','yxv0BW','CMvHzhK','rKfjteve','uvvfvuvDiee','Eur0zMy','4P2mifTtvfvesq','Cxvmzhy','BgvKoIa','mZe0nte5oevgshHezq','q09nueXfveu','ChjVz3jLC3m','DgvK','C3r1zgLVuxu','Ahr0Chm6lY8','4P2mifS','ChjPC21H','BMeUChjVl3q','ihWG','zgf0yq','BNnMB3jTAw4','yNvSBg1X','ic0G','zgvMAw5Luhi','iePVyIbMywK','v09ss0vsxsa','C2vHCMnO','zxHWB25LBNq','zc1PBwfNzs4','EKXAyKK','tv0Gr2vUzxi','CgXHy2vOB2W','y2f0y2G','BwvZC2fNzq','C3rHDhvZ','B25tDgf0Dxm','C3vIC3rYAw4','DwnvDKK','rxjYB3i6','mtC1nLjbBxLRsq','x19PBxbVCNq','Bg9N','mta0mu9cvw9uDa','CM9TChq6ici','DxbKyxrL','wwzcC0S','Aw9YzwrPCW','xsbgywLSzwq','wKv4Ewm','zZOG','C3r1zgLVv28','uKvesvnFue8','z2vUzxjHDgu','z3jHBs5HAs8','lI4VlI4Vy28','DhfOqxq','xsbdB21WBgu','ywrKr2vUzxi','mtm4mtmZrhHzrxPi','zgvMyxvSDa','B3v0Chv0vxi','Cg5N','zw5PBMCGzM8','r2vUzxjHDgK','yw5KigXPC3q','w1nuvurjtYa','4PYfifTtvfvesq','y2XPzw50','y29UC3rYDwm','zxvL','CMTLCG','y29TCgXLDgu','xsbbBhjLywq','z2v0sM9Iu3q','yxr1CW','yxnwAuq','mJC4mtzNqKjmrMW','CIbQB2jZ','Dg9tDhjPBMC','mtC3nte0mgnoq1H4Da','kcGOlISPkYK','Bwv0ywrHDge','vuzqD0y','qhbYAxnTys8','zgvYlMLKzw8','z3rNAw4','xsbszwfKEsa','ufjpxsbuCMe','DgvKoIa','tYbrvuvvrv0','vw5RBM93BIa','lI4UiG','mJeZmJa0nNvVA0XKqG','yxbWBhK','8j+AGcbBu1rvreK','CMfUC2zVCM0','B3bLCNr5','zYb3AxrOiha','y2vZl3bYAxm'];_0x4452=function(){return _0x18a50c;};return _0x4452();}async function processBananaJob(_0x24d4e5){const _0x3fb7c1=_0x3ab4c6,_0x347dbb={'Ugfmi':_0x3fb7c1(0x206)+_0x3fb7c1(0x192)+_0x3fb7c1(0x1d6)+_0x3fb7c1(0x209)+_0x3fb7c1(0x1d2)+'ed-image'+'.png','ZExyc':'BANANA_P'+'RO'},{prompt:_0x487d5a,imageBase64:_0x35ffc3,imageMimeType:_0x44825c}=_0x24d4e5;return console[_0x3fb7c1(0x19c)](_0x3fb7c1(0x1f0)+_0x3fb7c1(0x1ca)+_0x3fb7c1(0x187)+_0x3fb7c1(0x1d4)+_0x3fb7c1(0x19e)+_0x487d5a?.[_0x3fb7c1(0x197)+'g'](0x0,0x32)+_0x3fb7c1(0x1ce)),await new Promise(_0x385d4b=>setTimeout(_0x385d4b,0xbb8)),{'outputUrl':_0x347dbb['Ugfmi'],'metadata':{'provider':_0x347dbb[_0x3fb7c1(0x1a3)],'hasSourceImage':!!_0x35ffc3}};}function _0xf1c5(_0x52131d,_0x4cb2e0){_0x52131d=_0x52131d-0x186;const _0x4caec1=_0x4452();let _0x5263a2=_0x4caec1[_0x52131d];if(_0xf1c5['wJeTye']===undefined){var _0x10a374=function(_0x27467d){const _0x51d276='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5c0556='',_0x4580ac='',_0x3843d0=_0x5c0556+_0x10a374;for(let _0x4c62b5=0x0,_0x540cd4,_0x3a2cd5,_0x477b47=0x0;_0x3a2cd5=_0x27467d['charAt'](_0x477b47++);~_0x3a2cd5&&(_0x540cd4=_0x4c62b5%0x4?_0x540cd4*0x40+_0x3a2cd5:_0x3a2cd5,_0x4c62b5++%0x4)?_0x5c0556+=_0x3843d0['charCodeAt'](_0x477b47+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x540cd4>>(-0x2*_0x4c62b5&0x6)):_0x4c62b5:0x0){_0x3a2cd5=_0x51d276['indexOf'](_0x3a2cd5);}for(let _0x5a706e=0x0,_0x56d024=_0x5c0556['length'];_0x5a706e<_0x56d024;_0x5a706e++){_0x4580ac+='%'+('00'+_0x5c0556['charCodeAt'](_0x5a706e)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4580ac);};_0xf1c5['jQrqaz']=_0x10a374,_0xf1c5['qiLDIw']={},_0xf1c5['wJeTye']=!![];}const _0x44527a=_0x4caec1[0x0],_0xf1c5c0=_0x52131d+_0x44527a,_0x106751=_0xf1c5['qiLDIw'][_0xf1c5c0];if(!_0x106751){const _0x351139=function(_0x50d0ac){this['vLYNtv']=_0x50d0ac,this['fkEIey']=[0x1,0x0,0x0],this['uehDvZ']=function(){return'newState';},this['IhgGwG']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['UKAtBy']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x351139['prototype']['ZOLrBL']=function(){const _0x39b883=new RegExp(this['IhgGwG']+this['UKAtBy']),_0x2881c4=_0x39b883['test'](this['uehDvZ']['toString']())?--this['fkEIey'][0x1]:--this['fkEIey'][0x0];return this['EyJoXU'](_0x2881c4);},_0x351139['prototype']['EyJoXU']=function(_0x433532){if(!Boolean(~_0x433532))return _0x433532;return this['nEdoRN'](this['vLYNtv']);},_0x351139['prototype']['nEdoRN']=function(_0x3dd456){for(let _0x4e955a=0x0,_0x2ec5d5=this['fkEIey']['length'];_0x4e955a<_0x2ec5d5;_0x4e955a++){this['fkEIey']['push'](Math['round'](Math['random']())),_0x2ec5d5=this['fkEIey']['length'];}return _0x3dd456(this['fkEIey'][0x0]);},new _0x351139(_0xf1c5)['ZOLrBL'](),_0x5263a2=_0xf1c5['jQrqaz'](_0x5263a2),_0xf1c5['qiLDIw'][_0xf1c5c0]=_0x5263a2;}else _0x5263a2=_0x106751;return _0x5263a2;}async function addGenerationJob(_0x14231e){const _0x2f1909=_0x3ab4c6,_0x3170da=await exports[_0x2f1909(0x205)+_0x2f1909(0x1b8)][_0x2f1909(0x1ec)](_0x14231e[_0x2f1909(0x1f6)],_0x14231e,{'attempts':0x3,'backoff':{'type':_0x2f1909(0x18e)+_0x2f1909(0x1e5),'delay':0x7d0},'removeOnComplete':0x64,'removeOnFail':0x32});return console[_0x2f1909(0x19c)](_0x2f1909(0x1b4)+_0x2f1909(0x1fc)+_0x2f1909(0x1d8)+':\x20'+_0x3170da['id']+_0x2f1909(0x20a)+_0x14231e['provider']),_0x3170da['id'];}async function getJobStatus(_0x35b12a){const _0x177453=_0x3ab4c6,_0x270cc0=await exports[_0x177453(0x205)+'eue']['getJob'](_0x35b12a);if(!_0x270cc0)return null;const _0x1982cf=await _0x270cc0['getState']();return{'jobId':_0x270cc0['id'],'state':_0x1982cf,'data':_0x270cc0[_0x177453(0x186)],'progress':_0x270cc0[_0x177453(0x203)],'failedReason':_0x270cc0['failedRe'+_0x177453(0x1ef)]};}exports[_0x3ab4c6(0x1a5)+_0x3ab4c6(0x1b9)]=new bullmq_1['Worker']('studio-g'+_0x3ab4c6(0x1f1)+'ns',processStudioJob,{'connection':connection,'concurrency':0x5,'limiter':{'max':0xa,'duration':0x3e8}}),exports[_0x3ab4c6(0x1a5)+'rker']['on'](_0x3ab4c6(0x1ba)+'d',_0x46ba59=>{const _0x489354=_0x3ab4c6;console[_0x489354(0x19c)](_0x489354(0x1b5)+'O\x20WORKER'+_0x489354(0x1ab)+_0x489354(0x1cb)+_0x46ba59['id']);}),exports[_0x3ab4c6(0x1a5)+_0x3ab4c6(0x1b9)]['on']('failed',(_0x5e5abf,_0x12617d)=>{const _0x4e1d4e=_0x3ab4c6;console[_0x4e1d4e(0x1e1)](_0x4e1d4e(0x1fe)+'O\x20WORKER'+_0x4e1d4e(0x1a2)+':\x20'+_0x5e5abf?.['id']+_0x4e1d4e(0x189)+_0x12617d[_0x4e1d4e(0x194)]);}),exports['studioWo'+_0x3ab4c6(0x1b9)]['on'](_0x3ab4c6(0x1e1),_0x223316=>{const _0x568ce3=_0x3ab4c6;console[_0x568ce3(0x1e1)](_0x568ce3(0x1b4)+_0x568ce3(0x18c)+'Error:',_0x223316);}),exports['studioWo'+'rker']['on'](_0x3ab4c6(0x1fa),()=>{const _0x28cac0=_0x3ab4c6,_0x29a578={'gtgin':_0x28cac0(0x1d1)+_0x28cac0(0x1e8)+_0x28cac0(0x1c9)+_0x28cac0(0x1b3)+_0x28cac0(0x1b1)+_0x28cac0(0x1c0)};console[_0x28cac0(0x19c)](_0x29a578[_0x28cac0(0x1c8)]);}),exports[_0x3ab4c6(0x1ae)]=exports[_0x3ab4c6(0x1a5)+'rker'];