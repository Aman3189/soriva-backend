function _0x520e(){const _0x10f097=['AMzjBve','ignSzwfYzwq','C2XPy2u','zv0Gr2vUzxi','AfnPDM4','tvv0tw0','z2PHBwG','mte4odq4B25ABxf6','z2v0rNjVBum','DgnOzxm','Bwf4qMf0y2G','AfjdzwO','Bg9HzenVBMy','zw5HyMXLq2e','zv0GvM95ywC','u1rbuLrfuG','yxrPBMCG','rgf5','mhW0Fdj8nxW','Dg9tDhjPBMC','qhnOyxjLzc8','ota5nJq4mgrNse9hra','C3bSAxq','z2v0q29UzMK','ueLFs0vzig4','yxbWBhK','yxrPB24GzMe','zxn0Aw1HDgu','mta1oteXndbSzfftDee','Ahr0Chm6lY8','z2v0q2fJAgu','z2v0','l3yXl2vTyMu','z2v0tw9KzwW','D0nMree','uhjPC21Hq2W','vM95ywDLiee','Bg5XB3C','z3vYyxrPB24','EMDnt0K','BMDZigLUigi','zv0Gu2vYDMK','zv0GvxnHz2u','te0TtdyTDJi','mtG5mdiYmNb2zuTbwa','igvTyMvKzgK','zgLUzYbNzw4','vM95ywDLrw0','yMf0y2HtAxO','rKvkBwy','zv0Grw1Izwq','ufDLt3q','y2fJAgvnAxm','zv0GvxnPBMC','ENDhvLq','y2fJAgviAxq','r19quK9wsuq','ywXPEMvK','z2vHAs5JB20','DM95ywDL','AwXLza','B0TNufy','ihrYywnRAw4','s2v5','y2XLyxi','ANnVBG','zwnR','AwrLCJOG','sfvRtxC','y3jLyxrL','uhjVDMLKzxi','EK5gEfy','yxrJAa','B3qGy29UzMK','B3bLCNr5','zgvIDwC','C0LwwLK','ywnOzq','C3rYAw5NAwy','BgLTAxqGCMu','ihbYB3zPzgu','zhvJzsbIyxq','zgf0yq','mZzqDNbYEgi','Aw9Ul2PZB24','ueLFs0vz','DeTytLy','vg9Rzw5Z','yxbPlM9Wzw4','zNDvzhK','y2HHCKnVzgu','C2LU','ugXHBKXPBwK','u0LtvLm','CfPzuxy','mZqXmJGZnxHKzM1bDq','ig5VDcbHBgW','ANbowhC','DxrPBhmVBg8','r0vAtfG','zwrKAw5NCW','ru5AChK','x3n1Bq','zxjHDgLVBIa','z1nLCNzPy2u','zgLTzw5ZAw8','ue9tva','t3bLBKfjiee','y29UC3rYDwm','y2uGAw5PDgK','rgLTzw5ZAw8','EMuGka','z2v0sw5ZDge','CMvKDwnL','ywLSywjSzq','C2LTCgXLsge','z2vUzxjHDgu','B3DLzcbMB3i','ksbLEgnLzwq','s21ACxK','tg9JywXfBwi','mtfZswzHz2y','DgvKic0GDxm','z3jJB0S','Bwf4rw1Izwq','CLbwvfa','sePwtwK','yxbWBgLJyxq','Aw5NigzHAwW','A0XREgW','ChjVy2vZC0i','y2vPBa','vLLYCuG','t1bftKfjx0e','m3WX','DMfSAwrHDgu','z2v0vg9KyxK','yMvKzgLUzW','zYbMywLSzwq','ywKUy29Tl3y','ChjVDMLKzxi','svLvENm','zMfPBgvK','Dg9Y','BMDtzxj2Awm','z3vYzwq','ihvWzgf0zwq','Dgv4Dhm','uxfkr2O','C2v0sg91CNm','C3rHDhvZvgu','DhjHy2TfBwi','yxrLzca','txPmtxa','zwrKAw5Nltm','zYbUB3qGyxy','sgvHBhrOigm','y29UzMLN','DgvKihbYB3y','zv0Gq2fJAgu','ChvZAa','ywDL','x19LC01Vzhu','DfLSCxm','AgvHBhrOq2G','BYbHy2nLC3m','zv0Gq29UzMK','AgvJAYb0zxm','y2fJAgu','ru1cruresu4','zguGzM9Yig0','s2TxyMC','Aw5Nig1Vy2S','y2HL','AKPAq3a','y2XLyxjdywm','u2L6zq','ywXSB3DLzfa','C2v0','Aw1WBgvTzw4','B3jLlG','zv0Gt3bLBKe','uhr1v04','rgfPBhKGzw0','whHhyNy','Dgv4Da','zgrPBMDZ','BMDZig5VDca','nJu2mJi0mfP1twTkBW','Cgfgt3K','EMf5Dfu','Dw5RuNa','zgLUz3nqzxi','zw52','mJi5mta4B0zcCKLx','B3bLBMfP','zgvSzxrL','C0TxEfi','kcGOlISPkYK','BgvUz3rO','u3rHDhm','tuvvz2O','we12zKe','ms9LBwjLzgq','lwXHCMDL','C2vZ','ywnOzwqGka','BMCGz2vUzxi','BwLU','ywrKvg9dywm','Aw5NCW','DMfSDwu','qMf0y2GGC2K','Dgv4Dc1LBwi','rw1IzwrKAw4','vxnHz2u','ywDNCMvNyxq','zv0Gtg9JywW','AgvHBhrOEq','ueKGzxjYB3i','zxjYB3i','BMzPzW','ks4GvxbNCMe','Aw5JBhvKzxm','w0vTyMvKzgK','CJOG','DM95ywDLlti','vK9zquDfx0e','yxrJAgvZig8','qMvHCMvYia','DxzzDw8','z2v0u3rHDhm','igHPDa','BM93','sfvTtLi','BMnL','r19nt0rfta','C2L6zq','C2vHCMnO','mJfvz1zdzuW','Bg9JywW','kYKRja','ANLWr24','CM92AwrLCNm','CM91BMq','AwvUDa','zNjVBq','Bg9Nz2vY','ihbSyw4Uifu','vhPSuwS','Aw1PDcaO','BMDZigLUia','zw1IzwrKAw4','swDvwxO','yxbPlNzVEwe','vwLoEhy','Bw9KzwW','DxbKyxrLq28','Aw5MBW','z0LUDgvYBMe','t1zNyKi','zgvSyxK','z0nVDw50','Aw5ZDgfUy2u','wfzoBge','z2DLCG','zwrKAw5Nvxm','Bg9JywWTBw8','CYbWBgfUigW','BNjVDKi','Bwv0ywrHDge','t3bLBKfjrw0','y3jLyxrLqMe'];_0x520e=function(){return _0x10f097;};return _0x520e();}const _0x1f2374=_0xf549;(function(_0x4a1ee3,_0x3c7590){const _0x3c6905=_0xf549,_0x35abdd=_0x4a1ee3();while(!![]){try{const _0x929c3e=parseInt(_0x3c6905(0x289))/0x1*(-parseInt(_0x3c6905(0x1c1))/0x2)+parseInt(_0x3c6905(0x1ee))/0x3*(-parseInt(_0x3c6905(0x217))/0x4)+parseInt(_0x3c6905(0x26f))/0x5+parseInt(_0x3c6905(0x23c))/0x6+-parseInt(_0x3c6905(0x22c))/0x7+-parseInt(_0x3c6905(0x1bb))/0x8+parseInt(_0x3c6905(0x263))/0x9*(parseInt(_0x3c6905(0x225))/0xa);if(_0x929c3e===_0x3c7590)break;else _0x35abdd['push'](_0x35abdd['shift']());}catch(_0x29aab8){_0x35abdd['push'](_0x35abdd['shift']());}}}(_0x520e,0xcbd02));const _0x421e67=(function(){let _0x21f36b=!![];return function(_0x1e7a64,_0x461d11){const _0x1ec094=_0x21f36b?function(){const _0x56cf33=_0xf549;if(_0x461d11){const res=_0x461d11[_0x56cf33(0x229)](_0x1e7a64,arguments);return _0x461d11=null,res;}}:function(){};return _0x21f36b=![],_0x1ec094;};}()),_0xa8cd90=_0x421e67(this,function(){const _0x3d1add=_0xf549,_0x48d0bb={'wCfDA':_0x3d1add(0x1c5)+_0x3d1add(0x1f0)};return _0xa8cd90[_0x3d1add(0x223)]()[_0x3d1add(0x1ed)](_0x48d0bb[_0x3d1add(0x232)])[_0x3d1add(0x223)]()[_0x3d1add(0x27c)+_0x3d1add(0x18e)](_0xa8cd90)['search'](_0x48d0bb['wCfDA']);});_0xa8cd90();'use strict';Object['definePr'+_0x1f2374(0x25a)](exports,_0x1f2374(0x1a1)+'le',{'value':!![]}),exports[_0x1f2374(0x1d5)+_0x1f2374(0x278)]=void 0x0;function _0xf549(_0x21c8b2,_0x54f3aa){_0x21c8b2=_0x21c8b2-0x17b;const _0x2019ac=_0x520e();let _0xa8cd90=_0x2019ac[_0x21c8b2];if(_0xf549['elIiYt']===undefined){var _0x421e67=function(_0xae0bd6){const _0x56ebbb='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4903df='',_0x3d98b1='',_0x2e7264=_0x4903df+_0x421e67;for(let _0x2448ec=0x0,_0x10d147,_0xf601c5,_0x31cb7d=0x0;_0xf601c5=_0xae0bd6['charAt'](_0x31cb7d++);~_0xf601c5&&(_0x10d147=_0x2448ec%0x4?_0x10d147*0x40+_0xf601c5:_0xf601c5,_0x2448ec++%0x4)?_0x4903df+=_0x2e7264['charCodeAt'](_0x31cb7d+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x10d147>>(-0x2*_0x2448ec&0x6)):_0x2448ec:0x0){_0xf601c5=_0x56ebbb['indexOf'](_0xf601c5);}for(let _0x26f312=0x0,_0x443209=_0x4903df['length'];_0x26f312<_0x443209;_0x26f312++){_0x3d98b1+='%'+('00'+_0x4903df['charCodeAt'](_0x26f312)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3d98b1);};_0xf549['umVxbM']=_0x421e67,_0xf549['cOztet']={},_0xf549['elIiYt']=!![];}const _0x520ea3=_0x2019ac[0x0],_0xf549c6=_0x21c8b2+_0x520ea3,_0xa1a36d=_0xf549['cOztet'][_0xf549c6];if(!_0xa1a36d){const _0x535ea7=function(_0x2ecfa4){this['sDeXAJ']=_0x2ecfa4,this['teocph']=[0x1,0x0,0x0],this['GTUZRV']=function(){return'newState';},this['SORhJb']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['CftpTY']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x535ea7['prototype']['pYRSHZ']=function(){const _0x46b1ee=new RegExp(this['SORhJb']+this['CftpTY']),_0x59d498=_0x46b1ee['test'](this['GTUZRV']['toString']())?--this['teocph'][0x1]:--this['teocph'][0x0];return this['prrDMF'](_0x59d498);},_0x535ea7['prototype']['prrDMF']=function(_0x28a964){if(!Boolean(~_0x28a964))return _0x28a964;return this['HTjhjf'](this['sDeXAJ']);},_0x535ea7['prototype']['HTjhjf']=function(_0x3dc203){for(let _0x4d715f=0x0,_0x2bcbbb=this['teocph']['length'];_0x4d715f<_0x2bcbbb;_0x4d715f++){this['teocph']['push'](Math['round'](Math['random']())),_0x2bcbbb=this['teocph']['length'];}return _0x3dc203(this['teocph'][0x0]);},new _0x535ea7(_0xf549)['pYRSHZ'](),_0xa8cd90=_0xf549['umVxbM'](_0xa8cd90),_0xf549['cOztet'][_0xf549c6]=_0xa8cd90;}else _0xa8cd90=_0xa1a36d;return _0xa8cd90;}const client_1=require('@prisma/'+'client'),logger_1=require(_0x1f2374(0x224)+_0x1f2374(0x272)+_0x1f2374(0x208)),prisma=new client_1[(_0x1f2374(0x233))+(_0x1f2374(0x1f4))](),PLAN_EMBEDDING_LIMITS={'STARTER':{'maxEmbeddingsPerDay':0x3e8,'maxBatchSize':0xa,'allowedProviders':['local'],'preferredModel':'all-Mini'+_0x1f2374(0x23b)},'PLUS':{'maxEmbeddingsPerDay':0x2710,'maxBatchSize':0x32,'allowedProviders':['local',_0x1f2374(0x24b)],'preferredModel':_0x1f2374(0x1e1)},'PRO':{'maxEmbeddingsPerDay':0x186a0,'maxBatchSize':0x64,'allowedProviders':[_0x1f2374(0x1ef),'voyage',_0x1f2374(0x1c2)],'preferredModel':'voyage-2'},'EDGE':{'maxEmbeddingsPerDay':0x7a120,'maxBatchSize':0xc8,'allowedProviders':[_0x1f2374(0x1ef),'voyage',_0x1f2374(0x1c2)],'preferredModel':'text-emb'+_0x1f2374(0x199)+'-large'},'LIFE':{'maxEmbeddingsPerDay':-0x1,'maxBatchSize':0x1f4,'allowedProviders':[_0x1f2374(0x1ef),'voyage',_0x1f2374(0x1c2)],'preferredModel':_0x1f2374(0x1d4)+_0x1f2374(0x199)+_0x1f2374(0x1cb)}};class EmbeddingService{constructor(){const _0x17c425=_0x1f2374,_0x5e7b5d={'jJZCp':_0x17c425(0x222)+_0x17c425(0x185),'wySDj':_0x17c425(0x1e1),'IYUzs':_0x17c425(0x1df)+_0x17c425(0x18f)+_0x17c425(0x239)+_0x17c425(0x27d)+_0x17c425(0x249)},_0x372e29=_0x5e7b5d[_0x17c425(0x1ad)][_0x17c425(0x226)]('|');let _0x566ffe=0x0;while(!![]){switch(_0x372e29[_0x566ffe++]){case'0':this[_0x17c425(0x19c)]={'provider':_0x17c425(0x24b),'model':_0x5e7b5d['wySDj'],'dimensions':0x400,'batchSize':0x32,'maxTokensPerRequest':0x1f40,'enableCache':!![]};continue;case'1':this['loadConf'+'igFromEn'+'v']();continue;case'2':this[_0x17c425(0x247)+'s']=0x0;continue;case'3':logger_1['logger'][_0x17c425(0x201)](_0x5e7b5d[_0x17c425(0x18c)]);continue;case'4':this[_0x17c425(0x1a7)]=new Map();continue;case'5':this[_0x17c425(0x244)+'ses']=0x0;continue;}break;}}static[_0x1f2374(0x280)+_0x1f2374(0x1ea)](){const _0x326580=_0x1f2374;return!EmbeddingService[_0x326580(0x206)]&&(EmbeddingService['instance']=new EmbeddingService()),EmbeddingService[_0x326580(0x206)];}[_0x1f2374(0x21c)+'igFromEn'+'v'](){const _0xf06434=_0x1f2374,_0x59c47d=process[_0xf06434(0x1c0)][_0xf06434(0x1a8)+_0xf06434(0x248)+'ER'],_0x23a744=process[_0xf06434(0x1c0)][_0xf06434(0x1a8)+'G_MODEL'];if(_0x59c47d)this[_0xf06434(0x19c)][_0xf06434(0x18b)]=_0x59c47d;if(_0x23a744)this['config']['model']=_0x23a744;this[_0xf06434(0x19c)][_0xf06434(0x279)+'ns']=this[_0xf06434(0x231)+_0xf06434(0x27e)+'ns'](this[_0xf06434(0x19c)][_0xf06434(0x1ff)]),logger_1[_0xf06434(0x1f6)][_0xf06434(0x201)](_0xf06434(0x1df)+_0xf06434(0x18f)+_0xf06434(0x245)+_0xf06434(0x260)+_0xf06434(0x1e0)+this[_0xf06434(0x19c)][_0xf06434(0x18b)]+(',\x20model:'+'\x20')+this[_0xf06434(0x19c)][_0xf06434(0x1ff)]);}[_0x1f2374(0x231)+_0x1f2374(0x27e)+'ns'](_0x1f2461){const _0x1b8c18={'voyage-2':0x400,'voyage-large-2':0x600,'text-embedding-3-small':0x600,'text-embedding-3-large':0xc00,'text-embedding-ada-002':0x600,'all-MiniLM-L6-v2':0x180};return _0x1b8c18[_0x1f2461]||0x600;}[_0x1f2374(0x200)+_0x1f2374(0x1dc)](_0x44a974){const _0x164281=_0x1f2374,_0x191c89={'mCtIT':_0x164281(0x1df)+'ngServic'+_0x164281(0x1a5)+_0x164281(0x236)+_0x164281(0x191)};this[_0x164281(0x19c)]={...this['config'],..._0x44a974},logger_1[_0x164281(0x1f6)][_0x164281(0x201)](_0x191c89['mCtIT']);}[_0x1f2374(0x227)+'g'](){return{...this['config']};}async[_0x1f2374(0x284)+_0x1f2374(0x1d5)+'g'](_0x4704c3,_0x13ee9c,_0x254c7a='STARTER'){const _0x46fdb4=_0x1f2374,_0x2d6ccf={'XVNla':_0x46fdb4(0x254),'paFOy':function(_0x4df3a4,_0x157328){return _0x4df3a4!==_0x157328;},'KmZqy':_0x46fdb4(0x21b),'kpIDD':_0x46fdb4(0x1df)+_0x46fdb4(0x18f)+_0x46fdb4(0x19e)+_0x46fdb4(0x1e7)};try{if(_0x13ee9c){if(_0x46fdb4(0x1f1)!==_0x2d6ccf[_0x46fdb4(0x207)])await this[_0x46fdb4(0x186)+_0x46fdb4(0x26c)+'ts'](_0x13ee9c,_0x254c7a,0x1);else{const res=_0x113858[_0x46fdb4(0x229)](_0x578552,arguments);return _0x3f473a=null,res;}}if(this['config'][_0x46fdb4(0x21d)+'che']){if(_0x2d6ccf[_0x46fdb4(0x1bc)](_0x2d6ccf[_0x46fdb4(0x287)],_0x2d6ccf[_0x46fdb4(0x287)]))this['addToCac'+'he'](_0x23f6da[_0x46fdb4(0x1b8)],_0x146540);else{const _0x32950f=this[_0x46fdb4(0x218)+_0x46fdb4(0x25d)](_0x4704c3['text']);if(_0x32950f)return this[_0x46fdb4(0x247)+'s']++,logger_1[_0x46fdb4(0x1f6)][_0x46fdb4(0x25b)](_0x2d6ccf['kpIDD']),_0x32950f;this['cacheMis'+_0x46fdb4(0x1cc)]++;}}const _0x45289b=await this[_0x46fdb4(0x284)+'Embeddin'+_0x46fdb4(0x202)+'l'](_0x4704c3['text'],_0x4704c3[_0x46fdb4(0x20d)]);return this['config'][_0x46fdb4(0x21d)+_0x46fdb4(0x1ac)]&&this[_0x46fdb4(0x1d0)+'he'](_0x4704c3[_0x46fdb4(0x1b8)],_0x45289b),_0x13ee9c&&await this[_0x46fdb4(0x196)+_0x46fdb4(0x209)+_0x46fdb4(0x1a0)](_0x13ee9c,0x1),_0x45289b;}catch(_0x37c307){logger_1[_0x46fdb4(0x1f6)][_0x46fdb4(0x1db)](_0x46fdb4(0x1df)+_0x46fdb4(0x18f)+_0x46fdb4(0x242)+_0x46fdb4(0x23e)+_0x46fdb4(0x277)+_0x46fdb4(0x18d),_0x37c307);throw _0x37c307;}}async['generate'+'BatchEmb'+_0x1f2374(0x274)](_0x8524,_0x402da2,_0x5ae5e1=_0x1f2374(0x21f)){const _0x36988a=_0x1f2374,_0x5de0fd={'erlvd':function(_0x2a13c9,_0x322202){return _0x2a13c9-_0x322202;},'XxGbv':_0x36988a(0x1c4),'FEJmf':_0x36988a(0x1e5),'OVgbB':_0x36988a(0x1df)+_0x36988a(0x18f)+'e]\x20Batch'+'\x20embeddi'+_0x36988a(0x1ce)+_0x36988a(0x22a)+_0x36988a(0x24c)},_0x2ed398=Date[_0x36988a(0x1e8)]();try{const _0x336b84=PLAN_EMBEDDING_LIMITS[_0x5ae5e1]||PLAN_EMBEDDING_LIMITS[_0x36988a(0x21f)],_0x38018f=_0x8524[_0x36988a(0x192)];_0x402da2&&await this[_0x36988a(0x186)+'PlanLimi'+'ts'](_0x402da2,_0x5ae5e1,_0x38018f['length']);const _0x6949fb=Math[_0x36988a(0x1cf)](_0x8524[_0x36988a(0x240)+'e']||this[_0x36988a(0x19c)][_0x36988a(0x240)+'e'],_0x336b84[_0x36988a(0x21a)+_0x36988a(0x1af)]);logger_1[_0x36988a(0x1f6)]['info']('[Embeddi'+_0x36988a(0x18f)+_0x36988a(0x213)+_0x36988a(0x220)+_0x38018f['length']+('\x20embeddi'+_0x36988a(0x238)+_0x36988a(0x1e3)+'f\x20')+_0x6949fb);const _0x5af87e=[],_0x411882=this['createBa'+_0x36988a(0x219)](_0x38018f,_0x6949fb);let _0x40dc43=0x0,_0x528807=0x0;for(const _0x498fae of _0x411882){const _0x589d14=await this[_0x36988a(0x181)+'atch'](_0x498fae,_0x8524[_0x36988a(0x20d)]);_0x5af87e[_0x36988a(0x19f)](..._0x589d14),_0x40dc43++,_0x528807+=this[_0x36988a(0x22b)+_0x36988a(0x267)](_0x498fae),_0x40dc43<_0x411882[_0x36988a(0x1c6)]&&await this['delay'](0x64);}_0x402da2&&await this[_0x36988a(0x196)+_0x36988a(0x209)+_0x36988a(0x1a0)](_0x402da2,_0x38018f[_0x36988a(0x1c6)]);const _0x618d94=_0x5de0fd['erlvd'](Date[_0x36988a(0x1e8)](),_0x2ed398);return logger_1[_0x36988a(0x1f6)]['success'](_0x36988a(0x1df)+_0x36988a(0x18f)+_0x36988a(0x213)+_0x36988a(0x197)+_0x5af87e[_0x36988a(0x1c6)]+(_0x36988a(0x23d)+_0x36988a(0x1fa))+_0x618d94+'ms'),{'embeddings':_0x5af87e,'processingTime':_0x618d94,'batchesProcessed':_0x40dc43,'tokensUsed':_0x528807,'provider':this[_0x36988a(0x19c)][_0x36988a(0x18b)]};}catch(_0x315058){if(_0x5de0fd[_0x36988a(0x1b7)]===_0x5de0fd[_0x36988a(0x241)]){if(_0xd0e0d6){const res=_0x1c04f7['apply'](_0xacd756,arguments);return _0x26b349=null,res;}}else{logger_1[_0x36988a(0x1f6)][_0x36988a(0x1db)](_0x5de0fd[_0x36988a(0x203)],_0x315058);throw _0x315058;}}}async[_0x1f2374(0x284)+_0x1f2374(0x1d5)+_0x1f2374(0x202)+'l'](_0x1d4e23,_0x34d78d){const _0x55827d=_0x1f2374,_0x48f9ed={'zgMOI':'openai'};switch(this[_0x55827d(0x19c)]['provider']){case _0x55827d(0x24b):return this[_0x55827d(0x284)+_0x55827d(0x23f)+_0x55827d(0x188)](_0x1d4e23,_0x34d78d);case _0x48f9ed[_0x55827d(0x237)]:return this['generate'+'OpenAIEm'+_0x55827d(0x188)](_0x1d4e23,_0x34d78d);case _0x55827d(0x1ef):return this[_0x55827d(0x284)+'LocalEmb'+'edding'](_0x1d4e23,_0x34d78d);default:throw new Error('Unsuppor'+_0x55827d(0x19d)+_0x55827d(0x253)+this[_0x55827d(0x19c)][_0x55827d(0x18b)]);}}async['generate'+'VoyageEm'+_0x1f2374(0x188)](_0x1bddc7,_0x1b75af){const _0x172abc=_0x1f2374,_0x257cd8={'QqJGj':function(_0x2d77d7,_0x12f449){return _0x2d77d7===_0x12f449;},'jKbzB':'kvLrS','rPVTP':_0x172abc(0x235),'UiNxv':'eJtEV','GGAAk':_0x172abc(0x22d)+_0x172abc(0x1fd)+_0x172abc(0x24a)+_0x172abc(0x230)+_0x172abc(0x1b9),'MYDeK':_0x172abc(0x27a),'XMvfA':_0x172abc(0x17e)+_0x172abc(0x264),'pZYQv':function(_0x2291a0,_0x5f1384){return _0x2291a0!==_0x5f1384;},'zwGVT':_0x172abc(0x257),'HUmNR':_0x172abc(0x180),'IgUYz':_0x172abc(0x24b),'KkWbg':'[Embeddi'+_0x172abc(0x18f)+_0x172abc(0x21e)+'e\x20embedd'+_0x172abc(0x17f)+'ed'};try{if(_0x257cd8[_0x172abc(0x193)](_0x257cd8['jKbzB'],_0x257cd8[_0x172abc(0x17c)]))throw new _0x52edfd(_0x172abc(0x27b)+'PI\x20error'+':\x20'+_0x3d82a9[_0x172abc(0x195)+'xt']);else{const _0x52fdba=process['env'][_0x172abc(0x1e2)+_0x172abc(0x265)];if(!_0x52fdba){if(_0x257cd8['QqJGj'](_0x257cd8['UiNxv'],_0x257cd8[_0x172abc(0x1fe)]))throw new Error(_0x172abc(0x1e2)+_0x172abc(0x228)+_0x172abc(0x259)+'gured');else return{'provider':this['config'][_0x172abc(0x18b)],'model':this[_0x172abc(0x19c)][_0x172abc(0x1ff)],'dimensions':this[_0x172abc(0x19c)][_0x172abc(0x279)+'ns'],'cache':this['getCache'+_0x172abc(0x1c7)]()};}const _0x940c0f=await fetch(_0x257cd8['GGAAk'],{'method':_0x257cd8['MYDeK'],'headers':{'Content-Type':_0x257cd8[_0x172abc(0x1c9)],'Authorization':_0x172abc(0x1e4)+_0x52fdba},'body':JSON[_0x172abc(0x25e)+'y']({'input':_0x1bddc7,'model':this[_0x172abc(0x19c)]['model']})});if(!_0x940c0f['ok']){if(_0x257cd8[_0x172abc(0x26e)](_0x257cd8[_0x172abc(0x246)],_0x257cd8[_0x172abc(0x1e9)]))throw new Error(_0x172abc(0x234)+'PI\x20error'+':\x20'+_0x940c0f[_0x172abc(0x195)+'xt']);else{const _0x2cd2b5=_0x535ea7?function(){if(_0x4d715f){const res=_0x3371b6['apply'](_0x43e950,arguments);return _0x3f0e27=null,res;}}:function(){};return _0x3dc203=![],_0x2cd2b5;}}const _0x2142d5=await _0x940c0f['json'](),_0x188c12=_0x2142d5[_0x172abc(0x262)][0x0][_0x172abc(0x1fb)+'g'];return{'text':_0x1bddc7,'vector':_0x188c12,'dimensions':_0x188c12[_0x172abc(0x1c6)],'model':this[_0x172abc(0x19c)][_0x172abc(0x1ff)],'provider':_0x257cd8[_0x172abc(0x1fc)],'metadata':_0x1b75af};}}catch(_0x2cc82d){if(_0x257cd8[_0x172abc(0x193)](_0x172abc(0x215),_0x172abc(0x243))){const _0x59d545=_0x5948a7[_0x172abc(0x1c0)][_0x172abc(0x1a8)+_0x172abc(0x248)+'ER'],_0x27792a=_0xa1b490[_0x172abc(0x1c0)]['EMBEDDIN'+_0x172abc(0x1eb)];if(_0x59d545)this['config'][_0x172abc(0x18b)]=_0x59d545;if(_0x27792a)this[_0x172abc(0x19c)][_0x172abc(0x1ff)]=_0x27792a;this[_0x172abc(0x19c)][_0x172abc(0x279)+'ns']=this[_0x172abc(0x231)+_0x172abc(0x27e)+'ns'](this[_0x172abc(0x19c)]['model']),_0x4a5b8f[_0x172abc(0x1f6)][_0x172abc(0x201)](_0x172abc(0x1df)+'ngServic'+_0x172abc(0x245)+_0x172abc(0x260)+_0x172abc(0x1e0)+this['config'][_0x172abc(0x18b)]+(',\x20model:'+'\x20')+this[_0x172abc(0x19c)][_0x172abc(0x1ff)]);}else{logger_1['logger'][_0x172abc(0x1db)](_0x257cd8[_0x172abc(0x1aa)],_0x2cc82d);throw _0x2cc82d;}}}async[_0x1f2374(0x284)+_0x1f2374(0x20e)+_0x1f2374(0x188)](_0x565a74,_0x23bf4f){const _0x433c93=_0x1f2374,_0x1dcb89={'jpNXw':'OPENAI_A'+_0x433c93(0x228)+'ot\x20confi'+_0x433c93(0x190),'jfImQ':_0x433c93(0x27a),'ZPANg':_0x433c93(0x24d),'tKXNV':_0x433c93(0x1c2),'HJVMi':_0x433c93(0x1df)+'ngServic'+_0x433c93(0x1b4)+'I\x20embedd'+'ing\x20fail'+'ed'};try{const _0x226cf4=process[_0x433c93(0x1c0)][_0x433c93(0x184)+_0x433c93(0x265)];if(!_0x226cf4)throw new Error(_0x1dcb89[_0x433c93(0x271)]);const _0x56af13=await fetch(_0x433c93(0x22d)+_0x433c93(0x268)+_0x433c93(0x18a)+_0x433c93(0x1ca)+_0x433c93(0x1d1),{'method':_0x1dcb89[_0x433c93(0x210)],'headers':{'Content-Type':_0x433c93(0x17e)+_0x433c93(0x264),'Authorization':_0x433c93(0x1e4)+_0x226cf4},'body':JSON['stringif'+'y']({'input':_0x565a74,'model':this[_0x433c93(0x19c)][_0x433c93(0x1ff)]})});if(!_0x56af13['ok']){if(_0x433c93(0x1b5)===_0x1dcb89['ZPANg'])throw new _0x5270f2(_0x1dcb89['jpNXw']);else throw new Error('OpenAI\x20A'+_0x433c93(0x1da)+':\x20'+_0x56af13[_0x433c93(0x195)+'xt']);}const _0x245310=await _0x56af13[_0x433c93(0x251)](),_0x40b6e9=_0x245310[_0x433c93(0x262)][0x0]['embeddin'+'g'];return{'text':_0x565a74,'vector':_0x40b6e9,'dimensions':_0x40b6e9[_0x433c93(0x1c6)],'model':this[_0x433c93(0x19c)][_0x433c93(0x1ff)],'provider':_0x1dcb89[_0x433c93(0x266)],'metadata':_0x23bf4f};}catch(_0x323a90){logger_1[_0x433c93(0x1f6)][_0x433c93(0x1db)](_0x1dcb89[_0x433c93(0x17d)],_0x323a90);throw _0x323a90;}}async[_0x1f2374(0x284)+_0x1f2374(0x288)+'edding'](_0x5dfd18,_0xf4456f){const _0x2b2f8d=_0x1f2374,_0x1a51eb={'AgBdz':_0x2b2f8d(0x24b),'SISVS':function(_0x469033,_0x4988c4){return _0x469033===_0x4988c4;},'hSivn':'TzlQk','ENZpy':function(_0x2d9a52,_0x3a8b66){return _0x2d9a52*_0x3a8b66;},'GEZLX':function(_0x5e6b99,_0x5c10d){return _0x5e6b99+_0x5c10d;},'TVHXl':_0x2b2f8d(0x1ef)};logger_1[_0x2b2f8d(0x1f6)]['warn'](_0x2b2f8d(0x1df)+_0x2b2f8d(0x18f)+_0x2b2f8d(0x1d8)+'\x20embeddi'+_0x2b2f8d(0x1ba)+_0x2b2f8d(0x1b2)+_0x2b2f8d(0x28a)+_0x2b2f8d(0x1ab));const _0x3c143b=this['config']['dimensio'+'ns'],_0x27cff8=Array[_0x2b2f8d(0x1f5)]({'length':_0x3c143b},(_0x3e9f06,_0x29e346)=>{const _0x173caa=_0x2b2f8d;if(_0x1a51eb[_0x173caa(0x26d)](_0x1a51eb[_0x173caa(0x214)],_0x173caa(0x1f8)))return _0x1a51eb[_0x173caa(0x275)](Math[_0x173caa(0x26b)](_0x1a51eb[_0x173caa(0x273)](_0x5dfd18[_0x173caa(0x26a)+'At'](_0x29e346%_0x5dfd18[_0x173caa(0x1c6)]),_0x29e346)),0.5);else this[_0x173caa(0x19c)]={'provider':_0x1a51eb['AgBdz'],'model':_0x173caa(0x1e1),'dimensions':0x400,'batchSize':0x32,'maxTokensPerRequest':0x1f40,'enableCache':!![]},this[_0x173caa(0x1a7)]=new _0x3b2ddf(),this['cacheHit'+'s']=0x0,this['cacheMis'+_0x173caa(0x1cc)]=0x0,_0x2dfc57['logger'][_0x173caa(0x201)](_0x173caa(0x1df)+_0x173caa(0x18f)+_0x173caa(0x239)+_0x173caa(0x27d)+_0x173caa(0x249)),this[_0x173caa(0x21c)+'igFromEn'+'v']();});return{'text':_0x5dfd18,'vector':_0x27cff8,'dimensions':_0x3c143b,'model':_0x2b2f8d(0x20a)+'ck','provider':_0x1a51eb['TVHXl'],'metadata':_0xf4456f};}[_0x1f2374(0x20f)+_0x1f2374(0x219)](_0x34e8ee,_0x85343d){const _0x282627=_0x1f2374,_0x9417fe={'REsWi':function(_0x41930f,_0x46e2b){return _0x41930f+_0x46e2b;}},_0x1ebb5d=[];for(let _0x5c757e=0x0;_0x5c757e<_0x34e8ee[_0x282627(0x1c6)];_0x5c757e+=_0x85343d){_0x1ebb5d['push'](_0x34e8ee[_0x282627(0x212)](_0x5c757e,_0x9417fe['REsWi'](_0x5c757e,_0x85343d)));}return _0x1ebb5d;}async['processB'+_0x1f2374(0x258)](_0x11f854,_0x2e1d31){const _0x150252=_0x1f2374,_0x276b38=[],_0x132b0f=_0x11f854['map'](_0x230b12=>this[_0x150252(0x284)+_0x150252(0x1d5)+'gInterna'+'l'](_0x230b12,_0x2e1d31)),_0x57d420=await Promise['all'](_0x132b0f);return _0x276b38['push'](..._0x57d420),_0x276b38;}[_0x1f2374(0x22b)+_0x1f2374(0x267)](_0x58a0c4){const _0x28b724=_0x1f2374,_0x57d4d1=_0x58a0c4[_0x28b724(0x281)]((_0x1a8495,_0x3785cd)=>_0x1a8495+_0x3785cd[_0x28b724(0x1c6)],0x0);return Math[_0x28b724(0x182)](_0x57d4d1/0x4);}[_0x1f2374(0x204)](_0xb8dad2){return new Promise(_0x57484e=>setTimeout(_0x57484e,_0xb8dad2));}[_0x1f2374(0x22e)+_0x1f2374(0x24f)](_0x4fdaf0){const _0x4efc10=_0x1f2374,_0x51fe38=this['simpleHa'+'sh'](_0x4fdaf0);return this[_0x4efc10(0x19c)]['provider']+':'+this[_0x4efc10(0x19c)][_0x4efc10(0x1ff)]+':'+_0x51fe38;}[_0x1f2374(0x283)+'sh'](_0x74ad90){const _0x2a888b=_0x1f2374,_0x479d6e={'tYlqs':function(_0x255324,_0x5edcbb){return _0x255324===_0x5edcbb;},'grcoK':'MEUgj','fwUdy':function(_0x21e4a8,_0x409497){return _0x21e4a8+_0x409497;},'hcTJq':function(_0x33962b,_0x3b0779){return _0x33962b-_0x3b0779;},'ZJmxi':function(_0x50a86b,_0x1cd1e3){return _0x50a86b<<_0x1cd1e3;}};let _0x2be21c=0x0;for(let _0x32d807=0x0;_0x32d807<_0x74ad90[_0x2a888b(0x1c6)];_0x32d807++){if(_0x479d6e[_0x2a888b(0x1a2)](_0x479d6e[_0x2a888b(0x28b)],_0x2a888b(0x1c8))){const _0x29cb23=_0x74ad90['charCode'+'At'](_0x32d807);_0x2be21c=_0x479d6e[_0x2a888b(0x269)](_0x479d6e['hcTJq'](_0x479d6e['ZJmxi'](_0x2be21c,0x5),_0x2be21c),_0x29cb23),_0x2be21c=_0x2be21c&_0x2be21c;}else return{...this[_0x2a888b(0x19c)]};}return Math['abs'](_0x2be21c)['toString'](0x24);}[_0x1f2374(0x218)+_0x1f2374(0x25d)](_0x4f33df){const _0x3b9442=_0x1f2374,_0x331043=this['getCache'+_0x3b9442(0x24f)](_0x4f33df);return this[_0x3b9442(0x1a7)][_0x3b9442(0x22f)](_0x331043)||null;}[_0x1f2374(0x1d0)+'he'](_0x556303,_0x4cbc19){const _0x54b4a8=_0x1f2374,_0x545191={'xBCSq':function(_0x66064b,_0x575b99){return _0x66064b>_0x575b99;}},_0x3cb98c=this['getCache'+_0x54b4a8(0x24f)](_0x556303);if(_0x545191['xBCSq'](this['cache'][_0x54b4a8(0x1ec)],0x2710)){const _0x2cf17a=this[_0x54b4a8(0x1a7)]['keys']()['next']()[_0x54b4a8(0x1d2)];_0x2cf17a&&this[_0x54b4a8(0x1a7)][_0x54b4a8(0x1c3)](_0x2cf17a);}this[_0x54b4a8(0x1a7)][_0x54b4a8(0x1b1)](_0x3cb98c,_0x4cbc19);}[_0x1f2374(0x1ae)+'he'](){const _0x512cc9=_0x1f2374;this[_0x512cc9(0x1a7)][_0x512cc9(0x250)](),this[_0x512cc9(0x247)+'s']=0x0,this[_0x512cc9(0x244)+_0x512cc9(0x1cc)]=0x0,logger_1[_0x512cc9(0x1f6)][_0x512cc9(0x201)](_0x512cc9(0x1df)+'ngServic'+_0x512cc9(0x19e)+_0x512cc9(0x211));}['getCache'+'Stats'](){const _0xe3e0f2=_0x1f2374,_0x233046={'gjamh':function(_0x5e47e2,_0x127357){return _0x5e47e2*_0x127357;}},_0x33f436=this[_0xe3e0f2(0x247)+'s']+this[_0xe3e0f2(0x244)+_0xe3e0f2(0x1cc)],_0x8e379d=_0x33f436>0x0?this[_0xe3e0f2(0x247)+'s']/_0x33f436*0x64:0x0;return{'size':this[_0xe3e0f2(0x1a7)][_0xe3e0f2(0x1ec)],'hits':this[_0xe3e0f2(0x247)+'s'],'misses':this[_0xe3e0f2(0x244)+'ses'],'hitRate':Math[_0xe3e0f2(0x1f3)](_0x233046[_0xe3e0f2(0x216)](_0x8e379d,0x64))/0x64};}async[_0x1f2374(0x186)+'PlanLimi'+'ts'](_0x1211d4,_0x5c9ba6,_0x1d5600){const _0x56ed5b=_0x1f2374,_0x33bb50={'FtXsM':function(_0x357750,_0x4a3fa1){return _0x357750>_0x4a3fa1;},'zaytU':function(_0x8f8ade,_0x2ad4e6){return _0x8f8ade>_0x2ad4e6;}},_0x11fb8f=PLAN_EMBEDDING_LIMITS[_0x5c9ba6]||PLAN_EMBEDDING_LIMITS[_0x56ed5b(0x21f)];if(!_0x11fb8f[_0x56ed5b(0x1b0)+_0x56ed5b(0x1f2)][_0x56ed5b(0x1de)](this[_0x56ed5b(0x19c)]['provider']))throw new Error(_0x56ed5b(0x256)+'\x20'+this[_0x56ed5b(0x19c)][_0x56ed5b(0x18b)]+(_0x56ed5b(0x270)+_0x56ed5b(0x285)+'\x20')+_0x5c9ba6+(_0x56ed5b(0x1f7)+'pgrade\x20t'+_0x56ed5b(0x1a4)+'.'));if(_0x11fb8f[_0x56ed5b(0x17b)+_0x56ed5b(0x1bf)+_0x56ed5b(0x221)]!==-0x1){const _0x8221d1=await this[_0x56ed5b(0x187)+_0x56ed5b(0x1d6)](_0x1211d4);if(_0x33bb50['FtXsM'](_0x8221d1+_0x1d5600,_0x11fb8f[_0x56ed5b(0x17b)+_0x56ed5b(0x1bf)+_0x56ed5b(0x221)]))throw new Error(_0x56ed5b(0x1b6)+'bedding\x20'+_0x56ed5b(0x25f)+_0x56ed5b(0x1cd)+_0x8221d1+'/'+_0x11fb8f['maxEmbed'+_0x56ed5b(0x1bf)+_0x56ed5b(0x221)]+(_0x56ed5b(0x1dd)+_0x56ed5b(0x1a9)+_0x56ed5b(0x1b3)));}if(_0x33bb50[_0x56ed5b(0x1bd)](_0x1d5600,_0x11fb8f[_0x56ed5b(0x21a)+_0x56ed5b(0x1af)]))throw new Error(_0x56ed5b(0x1d3)+_0x56ed5b(0x27f)+_0x1d5600+(_0x56ed5b(0x286)+_0x56ed5b(0x20b)+_0x56ed5b(0x1f9))+_0x11fb8f[_0x56ed5b(0x21a)+_0x56ed5b(0x1af)]+(').\x20Upgra'+'de\x20or\x20re'+_0x56ed5b(0x261)+'ch\x20size.'));}async['getToday'+_0x1f2374(0x1d6)](_0x4cfebd){const _0x307a3f=_0x1f2374,_0x4f81e1={'unkRp':_0x307a3f(0x1df)+'ngServic'+_0x307a3f(0x1a5)+_0x307a3f(0x236)+'\x20updated','MzLMp':function(_0x431e6e,_0x427514){return _0x431e6e!==_0x427514;},'Xicis':_0x307a3f(0x183),'sIVZY':'LfMxN'};try{if(_0x4f81e1[_0x307a3f(0x198)](_0x4f81e1['Xicis'],'Wfwfy')){const _0x23065c=new Date();_0x23065c[_0x307a3f(0x194)](0x0,0x0,0x0,0x0);const _0x1cb08d=await prisma['embeddin'+'gUsage'][_0x307a3f(0x1d7)+'e']({'where':{'userId':_0x4cfebd,'createdAt':{'gte':_0x23065c}},'_sum':{'embeddingCount':!![]}});return _0x1cb08d[_0x307a3f(0x276)]['embeddin'+_0x307a3f(0x205)]||0x0;}else return!_0x1f3aa7[_0x307a3f(0x206)]&&(_0xb3ee9f[_0x307a3f(0x206)]=new _0x5a903a()),_0x5cf870['instance'];}catch(_0x574c8c){if(_0x4f81e1[_0x307a3f(0x25c)]==='LfMxN')return logger_1['logger'][_0x307a3f(0x25b)](_0x307a3f(0x1df)+_0x307a3f(0x18f)+_0x307a3f(0x23a)+_0x307a3f(0x24e)+_0x307a3f(0x19a)+_0x307a3f(0x282)),0x0;else this[_0x307a3f(0x19c)]={...this['config'],..._0x29200e},_0x243098[_0x307a3f(0x1f6)][_0x307a3f(0x201)](_0x4f81e1[_0x307a3f(0x1be)]);}}async[_0x1f2374(0x196)+_0x1f2374(0x209)+_0x1f2374(0x1a0)](_0x269290,_0x2b805d){const _0x5be2df=_0x1f2374;try{await prisma[_0x5be2df(0x1fb)+'gUsage'][_0x5be2df(0x255)]({'data':{'userId':_0x269290,'embeddingCount':_0x2b805d,'provider':this[_0x5be2df(0x19c)][_0x5be2df(0x18b)],'model':this[_0x5be2df(0x19c)]['model']}});}catch(_0x1f80e1){logger_1[_0x5be2df(0x1f6)][_0x5be2df(0x25b)]('[Embeddi'+'ngServic'+_0x5be2df(0x23a)+_0x5be2df(0x24e)+_0x5be2df(0x189),_0x1f80e1);}}async[_0x1f2374(0x1a3)+_0x1f2374(0x252)](){const _0x51d31d=_0x1f2374,_0x1b90b0={'OJCCt':_0x51d31d(0x1df)+_0x51d31d(0x18f)+'e]\x20Healt'+'h\x20check\x20'+_0x51d31d(0x18d),'nrovB':'unhealth'+'y'};try{const _0x503870=_0x51d31d(0x19b)+_0x51d31d(0x1a6)+'t';return await this[_0x51d31d(0x284)+_0x51d31d(0x1d5)+_0x51d31d(0x202)+'l'](_0x503870),{'status':_0x51d31d(0x1d9),'provider':this[_0x51d31d(0x19c)][_0x51d31d(0x18b)],'model':this[_0x51d31d(0x19c)][_0x51d31d(0x1ff)]};}catch(_0xd3bb18){return logger_1[_0x51d31d(0x1f6)]['error'](_0x1b90b0['OJCCt'],_0xd3bb18),{'status':_0x1b90b0[_0x51d31d(0x20c)],'provider':this[_0x51d31d(0x19c)][_0x51d31d(0x18b)],'model':this[_0x51d31d(0x19c)]['model']};}}[_0x1f2374(0x1e6)](){const _0x3dca06=_0x1f2374;return{'provider':this[_0x3dca06(0x19c)][_0x3dca06(0x18b)],'model':this[_0x3dca06(0x19c)]['model'],'dimensions':this['config']['dimensio'+'ns'],'cache':this[_0x3dca06(0x22e)+_0x3dca06(0x1c7)]()};}}exports[_0x1f2374(0x1d5)+_0x1f2374(0x278)]=EmbeddingService,exports['default']=EmbeddingService[_0x1f2374(0x280)+_0x1f2374(0x1ea)]();