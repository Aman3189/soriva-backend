function _0x5c42(){const _0x116ee6=['zgLK','C2vZ','mZqXmJbnyuD0ALO','ihrVA2vUCW','vxnLCKfJy2u','y2fJAgu','mZm4mZuYn3bKAgrVDW','zw52','EKLOsMG','s2LAEha','yw5RAw5N','BK5KyMy','wLLKALC','y291Bgq','yMX6EKm','BwfW','AhLICMLK','BIb1CgrHDgu','zxjDienHy2G','DMvYBgfW','CMvZDwX0CYa','D2vYzq','Awv2ywWGzMe','zw50CMLLCW','zcbYzxn1Bhq','AwnLigLUAxq','yxjJAa','zw5HyMXLuMu','rgvMyxvSDa','v0D1u3m','DgHL','C2XPy2u','Bg9HzenVBMy','cGPBu291CMm','BwLU','BgvUz3rO','EwLUzYbYzs0','CMfUA2LUzY4','yw5K','BNrLEhq','Bwv0ywrHDge','yxbWBhLszxi','ELbbCMK','zu1LDgHVza','zxjDieH5yNi','thDcC0K','zcbKEw5HBwK','Dw5RCW','CgfNzu51Bwi','zsbOAxqG4PYt','DwX0CW','CM91BMq','Aw4G','CxvLCNK','BMzPzW','DMfSAwrHDgu','DgLTzxn0yw0','y2fJAgvfEha','Aw5N','BfrPBwu','lcbdAhvUAYa','zxjYB3i','vfL0DMe','qhbYAxnTys8','BfrPBwvZ','ihzLy3rVCIa','B2n1BwvUDca','lcbqywDLia','nZmZntyZowfqy2nssG','zxnZAw5Nihe','tvfeAum','DwvYEtOGiG','zxjDie11Bhq','uKfhx01jtL8','zMLSDgvY','t0fdruO','Aw5ty29Yzq','yxbWBhLiEwi','mJG0otbvu2ryqNC','y2GGzMfPBgu','v2zwqwO','u1vns1q','C3rvC2vKq2e','B3jKihnLyxi','CMLKu2vHCMm','BM93','lI9LBwjLzgq','vKnxqMG','z2v0u3rHDhm','zxjDifbYB2m','odi2EfnTDMzQ','z1nLCNzPy2u','DMvJDg9Yihi','zxL3B3jKCYa','AM9PBG','ywnJzxnZq28','ugPwCeW','uvfcDM8','y2XPzw50','x19PBxbVCNq','B3jL','suDTzgO','C3vIC3rYAw4','y29UDgvUDa','zcWGDxnPBMC','zxjDifn0yxq','vg9Rzw5Z','w1jLDhjPzxy','y29Yza','z2LUywWGB3i','Aw5NlNnLCNy','v2L0AeHPC3q','zxH0CMfJDeS','zxrYAwv2ywW','zM9YBwf0q2G','zMLUzfvUAxe','Dgv4Da','DuToEK8','s2v5','AgvHBhrOEq','C01prLu','yLDwz1G','Bwf4q2fJAgu','AgfK','sKPvDLi','DMfSDwvZ','BNqGCMv0CMK','Awv2zwqG','BMnL','C29YDa','y29UDMvYC2e','z2v0q2fJAgu','yunAtvq','yNjPzfnLyxi','zxrHzgf0yq','D2HPy2G','u1rpuf9xt1i','CgfYC2vfBNy','AwDODa','C3vJy2vZCW','BffIBNy','AgvdBgvHBNu','Aw5KzxHpzG','BLv2vLO','zw5HyMXLshK','zMLSzw5HBwu','yxjL','zxn1BhrZ','Cg9ZAxrPB24','AwD1CMf0Aw8','Aw5ZDgfUy2u','CMnO','vgLTzq','BwLNAhq','Dvrtuhm','EuDjrem','C2HVDwXK','zw1IzwrKAw4','zxjDifjLlxi','CMLLDMfSCW','Dg9gAxHLza','D2fYBG','Dgv4DfDPBMq','u2nVCMu','zgvY','sgLZDg9YEq','qKXtuM8','rMXVyxq','thnMCfi','zw5Pzwq','u2L6zq','oefxvffjtG','C3rHDhm','zxn0Aw1HDgu','zxj2AwnL','zxL3B3jKCW','EhnZwgS','y2vPBa','C2vTyw50Awm','qLjZzgW','DMvJDg9Yu2m','zg9JDw1LBNq','DMvJDg9Yu3q','DxbSB2fKzwq','y2fSBhK','s0LorW','ve9lru5t','Bg9Nz2vY','CujWvLu','uMjKA0q','DMvJDg9YuMu','y2HPBMC','CMv0CMLLDMu','y29UzMLN','y2fJAgvtAxO','zhnAt0K','mJuYzMrczw5w','yxbWBhK','AwDgCM9Trw4','C2LUzYbVCMK','igzYB20Gzw4','CMfUA2LUzW','A2v5D29Yze8','DwvYEvDPDgG','Bwf4','CMv0CMLLDMe','y2fJAgvnAxm','mtu4otbUrfzsCKe','r09kCKe','z2v0sw5ZDge','ANjuB0O','CMvKDwnL','y1zdrfm','z2DLCG','C2HVDwXKvxm','kYKRja','C2v0','yw5RAw5Nigy','Aw5JBhvKzu0','C3rHCNrdywm','Axn0AwnZihi','zw5Pzwq6ieq','BMf0u2S','Aw5MBW','zxjDifjLDhi','yxrPB24GzMe','DxbKyxrLq28','uKfhx0voqui','sfPVueq','A0verLC','qhnOyxjLzc8','lI92zwn0B3i','zcbVCIb1BMe','ywXS','zxjDieTLExC','EuHLzLO','zxjDiefJy2u','ywnOzq','igrVy3vTzw4','swTcAey','x19LC01Vzhu','AgfZ','CLDdvfK','C2vHCMnO','DxrPBhmVBg8','sufAzNC','B3j5','zNjVBq','y2fJAgviAxq','uKfhx01bwf8','A0zTz2K','CMvZzxrtDge','lI4UiG','zMLSDgvYqNK','B1Lnvu8','yMvLBG','CMvZDwX0','ndmYotu2meP5DfDHvW','BM90igzVDw4','C3mGDMfSAwq','AhLICMLKu2u','qM9VBa','v25Tv2i','Axj5u2vJB24','AfLque8','CMvYyw5Rv2u','EwLUzYbOEwi','C2L6zq','B3bl','Dg90ywXszxq','Dw11BfK','uKfhx1rpuf8','DxnLCKLK','zgvMyxvSDe0','CLnLCNzPy2u','y2H1BMTjBMq','t1Hyrvu','D29Zr1q','uKDhr2W','zgvMyxvSDfq','yNv0','B3bLCNr5','u0TLEei','zgv0zxjTAw4','AgvHBhrOq2G','z2v0q29UzMK','rv9tsvPf','yxnL','BwvUDhm','zfbjz3e','CMLKihnLyxi','C0Powvq','zxzPy3rmzwe','Dg9WsW','B25SEq','z2vUzxjHDgu','Dw5RrM9Yq28','AdOG','zcbMB3iGDxm','ywrKvg9dywm','CvD2C2m','lxn0B3jLlNm','ANPWt1m','yxzLCMfNzvi','zgvSzxrL','uhjPC21Hq2W','zxjDifnLCNy','BwLUu2nVCMu','EhruB2TLBNm','zsbJBgvHCMu','AwXLza','mtaXodiYng9UvwXMvG','C3bSAxq','mteXotL3D1bIBvC','zxjDiefWCgW','AwqGC2vHCMm','qwnJzxnZigq','DgHPCW','AxbSzurVy3u','zxzHBcbMCM8','u0npuKu','Dg9mB3DLCKm','sw50','zw5Oyw5Jzve','kcGOlISPkYK','BejSsg8','AxjkvKO','D2L0Aa','z2v0rNjVBum','CgvYzM9YBuS','zxjDienVBNq','zg9LCW','zxH0CMfJDe0','As1KB2n1Bwu','CvDpqK8','ywLSzwqSihu','DxrOB3jPEMu','y2HLrw50CNK','tevFq0fdseK','rw1IzwrKAw4','sLjkuK8','zwn0B3jtzwe','zxH0CMfJDgu','zwnnB2O','ugjfEg8','y3rvy0O','zw5HyMXLq2e','C2nVCMu','DxbxuwW','Dw50','Bwf4q29UDgu','BwvYz2vszxm','y2H1BMTZ','zM9Y','BwvUDca','lcb1C2LUzYa','zvjLCMfUA2K','zxjDienVBMy','CMvYyw5R','y2XLyxi','zgvMyxvSDa','Agf2zq','Be5qCK4','zwfYy2G','ChvZAa','zxzHBcbMywK'];_0x5c42=function(){return _0x116ee6;};return _0x5c42();}const _0xc02a2b=_0x50aa;function _0x50aa(_0x354aa6,_0x547529){_0x354aa6=_0x354aa6-0x1b7;const _0x1d366e=_0x5c42();let _0xc76e5e=_0x1d366e[_0x354aa6];if(_0x50aa['abGPTd']===undefined){var _0x36edbf=function(_0x1d38ad){const _0x4923d4='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4ff528='',_0x3e70c5='',_0x4d18bf=_0x4ff528+_0x36edbf;for(let _0x593d91=0x0,_0x261dd9,_0x41c42f,_0x4ebf1e=0x0;_0x41c42f=_0x1d38ad['charAt'](_0x4ebf1e++);~_0x41c42f&&(_0x261dd9=_0x593d91%0x4?_0x261dd9*0x40+_0x41c42f:_0x41c42f,_0x593d91++%0x4)?_0x4ff528+=_0x4d18bf['charCodeAt'](_0x4ebf1e+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x261dd9>>(-0x2*_0x593d91&0x6)):_0x593d91:0x0){_0x41c42f=_0x4923d4['indexOf'](_0x41c42f);}for(let _0x2d7e53=0x0,_0x102b62=_0x4ff528['length'];_0x2d7e53<_0x102b62;_0x2d7e53++){_0x3e70c5+='%'+('00'+_0x4ff528['charCodeAt'](_0x2d7e53)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3e70c5);};_0x50aa['PrXjht']=_0x36edbf,_0x50aa['SMwTzL']={},_0x50aa['abGPTd']=!![];}const _0x5c4253=_0x1d366e[0x0],_0x50aa7d=_0x354aa6+_0x5c4253,_0x1447ed=_0x50aa['SMwTzL'][_0x50aa7d];if(!_0x1447ed){const _0x8bf014=function(_0x3ee003){this['GzgryP']=_0x3ee003,this['zwoGRJ']=[0x1,0x0,0x0],this['FcbEat']=function(){return'newState';},this['zXUCNo']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['ERGtnc']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x8bf014['prototype']['wdCGXa']=function(){const _0x2b7884=new RegExp(this['zXUCNo']+this['ERGtnc']),_0x4eed64=_0x2b7884['test'](this['FcbEat']['toString']())?--this['zwoGRJ'][0x1]:--this['zwoGRJ'][0x0];return this['blPWkf'](_0x4eed64);},_0x8bf014['prototype']['blPWkf']=function(_0x2cec98){if(!Boolean(~_0x2cec98))return _0x2cec98;return this['lhArjk'](this['GzgryP']);},_0x8bf014['prototype']['lhArjk']=function(_0x4992c2){for(let _0x150e05=0x0,_0x592767=this['zwoGRJ']['length'];_0x150e05<_0x592767;_0x150e05++){this['zwoGRJ']['push'](Math['round'](Math['random']())),_0x592767=this['zwoGRJ']['length'];}return _0x4992c2(this['zwoGRJ'][0x0]);},new _0x8bf014(_0x50aa)['wdCGXa'](),_0xc76e5e=_0x50aa['PrXjht'](_0xc76e5e),_0x50aa['SMwTzL'][_0x50aa7d]=_0xc76e5e;}else _0xc76e5e=_0x1447ed;return _0xc76e5e;}(function(_0x51b3c4,_0x128d46){const _0x2d10f=_0x50aa,_0x36204c=_0x51b3c4();while(!![]){try{const _0xc7e92c=parseInt(_0x2d10f(0x2f4))/0x1+-parseInt(_0x2d10f(0x217))/0x2*(parseInt(_0x2d10f(0x2f6))/0x3)+-parseInt(_0x2d10f(0x2be))/0x4+parseInt(_0x2d10f(0x1bf))/0x5*(-parseInt(_0x2d10f(0x281))/0x6)+parseInt(_0x2d10f(0x1c3))/0x7*(-parseInt(_0x2d10f(0x268))/0x8)+-parseInt(_0x2d10f(0x201))/0x9+parseInt(_0x2d10f(0x28c))/0xa*(parseInt(_0x2d10f(0x20b))/0xb);if(_0xc7e92c===_0x128d46)break;else _0x36204c['push'](_0x36204c['shift']());}catch(_0xf5e885){_0x36204c['push'](_0x36204c['shift']());}}}(_0x5c42,0xe1b9f));const _0x36edbf=(function(){const _0x2c33fd=_0x50aa,_0x2d0366={'jzpOS':function(_0x10c418,_0x2d5cc8){return _0x10c418===_0x2d5cc8;},'IGmdj':_0x2c33fd(0x1c9)};let _0x2ab643=!![];return function(_0x492871,_0x102374){const _0x5a044b=_0x2c33fd;if(_0x2d0366[_0x5a044b(0x2eb)](_0x2d0366[_0x5a044b(0x222)],_0x5a044b(0x1c9))){const _0x299c81=_0x2ab643?function(){const _0x413eaf=_0x5a044b,_0x3f0666={'eXLQj':_0x413eaf(0x228)+_0x413eaf(0x205)+_0x413eaf(0x30a)+_0x413eaf(0x23b)+'eval\x20fai'+'led'};if(_0x102374){if(_0x2d0366['jzpOS']('yGIDC',_0x413eaf(0x258))){const res=_0x102374[_0x413eaf(0x282)](_0x492871,arguments);return _0x102374=null,res;}else{_0x2a5a5a['logger'][_0x413eaf(0x1fa)](_0x3f0666['eXLQj'],_0x1f82e6);throw _0x1e3765;}}}:function(){};return _0x2ab643=![],_0x299c81;}else{const res=_0x1f0cad[_0x5a044b(0x282)](_0x1b239d,arguments);return _0x2e18ac=null,res;}};}()),_0xc76e5e=_0x36edbf(this,function(){const _0x522bfd=_0x50aa,_0x450696={'QQBvo':_0x522bfd(0x301)+_0x522bfd(0x294)};return _0xc76e5e['toString']()[_0x522bfd(0x2b0)](_0x450696[_0x522bfd(0x21e)])['toString']()['construc'+'tor'](_0xc76e5e)[_0x522bfd(0x2b0)](_0x450696[_0x522bfd(0x21e)]);});_0xc76e5e();'use strict';Object['definePr'+_0xc02a2b(0x2d6)](exports,_0xc02a2b(0x2ad)+'le',{'value':!![]}),exports['Retrieve'+_0xc02a2b(0x2cf)]=void 0x0;const tslib_1=require('tslib'),vector_store_service_1=tslib_1[_0xc02a2b(0x220)+'Default'](require(_0xc02a2b(0x2a4)+_0xc02a2b(0x2ea)+_0xc02a2b(0x26b))),embedding_service_1=tslib_1[_0xc02a2b(0x220)+_0xc02a2b(0x1d9)](require(_0xc02a2b(0x213)+_0xc02a2b(0x22b)+'ice')),logger_1=require(_0xc02a2b(0x2a3)+_0xc02a2b(0x2b1)+_0xc02a2b(0x292)),client_1=require(_0xc02a2b(0x1fc)+_0xc02a2b(0x21f)),prisma=new client_1[(_0xc02a2b(0x2ee))+'ient']();class RetrieverService{constructor(){const _0x270409=_0xc02a2b,_0x48673f={'lNPrN':_0x270409(0x1db),'vKigw':_0x270409(0x244),'RGGGl':_0x270409(0x1e3),'OXXEU':_0x270409(0x304),'BRsdl':_0x270409(0x31e),'qBpVU':'that','irJVJ':_0x270409(0x2fa),'VCWBh':_0x270409(0x24f),'kEDFW':_0x270409(0x2bc),'RPadW':'will','sJNYT':'would','yHefZ':_0x270409(0x1ca),'doZCW':_0x270409(0x259)};this[_0x270409(0x27e)]={'defaultTopK':0x5,'defaultMinScore':0.7,'maxContextTokens':0xfa0,'maxCacheSize':0x64,'cacheExpirySeconds':0x12c,'enableCaching':!![],'enableReranking':!![],'enableHybridSearch':![],'rerankWeight':{'vectorScore':0.6,'keywordOverlap':0.3,'positionScore':0.1}},this['cache']=new Map(),this[_0x270409(0x269)]={'totalRetrievals':0x0,'cacheHits':0x0,'cacheMisses':0x0,'retrievalTimes':[]},this[_0x270409(0x245)+'DS']=new Set([_0x48673f[_0x270409(0x1b9)],'is','at',_0x48673f['vKigw'],'on','a','an',_0x48673f[_0x270409(0x2d3)],'or',_0x270409(0x2d5),'in',_0x48673f[_0x270409(0x2d1)],'to',_0x48673f[_0x270409(0x270)],'of','as','by',_0x48673f[_0x270409(0x279)],_0x48673f[_0x270409(0x303)],'it','from','be',_0x48673f[_0x270409(0x214)],'was',_0x270409(0x1d2),_0x48673f[_0x270409(0x2a2)],_0x270409(0x1b8),_0x270409(0x2ae),_0x270409(0x238),'do',_0x270409(0x308),_0x270409(0x1bd),_0x48673f['RPadW'],_0x48673f[_0x270409(0x2e0)],_0x48673f[_0x270409(0x2a8)],_0x48673f['doZCW'],'may',_0x270409(0x256)]),this['vectorSt'+_0x270409(0x221)]=vector_store_service_1[_0x270409(0x1b7)],this[_0x270409(0x25a)+'gService']=embedding_service_1[_0x270409(0x1b7)],this[_0x270409(0x1dd)+'igFromEn'+'v'](),this['startCac'+_0x270409(0x24a)+'p'](),logger_1['logger'][_0x270409(0x29c)](_0x270409(0x228)+_0x270409(0x2ef)+_0x270409(0x1d6)+'ialized');}static[_0xc02a2b(0x28e)+_0xc02a2b(0x23d)](){const _0x307ac1=_0xc02a2b;return!RetrieverService[_0x307ac1(0x253)]&&(RetrieverService['instance']=new RetrieverService()),RetrieverService[_0x307ac1(0x253)];}[_0xc02a2b(0x1dd)+_0xc02a2b(0x283)+'v'](){const _0x16aa89=_0xc02a2b,_0x37e5bb={'Geqts':_0x16aa89(0x2cc)+'K','jrToJ':_0x16aa89(0x2b6)+'CONTEXT_'+_0x16aa89(0x277),'kFmgi':'RAG_CACH'+_0x16aa89(0x2db),'ctUcJ':_0x16aa89(0x228)+_0x16aa89(0x322)+_0x16aa89(0x252)+'n\x20loaded'+_0x16aa89(0x285)+'vironmen'+'t'},_0x5dc4cf={'defaultTopK':this[_0x16aa89(0x246)+'Int'](_0x37e5bb['Geqts'],this['config'][_0x16aa89(0x2d4)+_0x16aa89(0x2c9)]),'defaultMinScore':this[_0x16aa89(0x246)+_0x16aa89(0x264)](_0x16aa89(0x206)+_0x16aa89(0x2fd),this[_0x16aa89(0x27e)]['defaultM'+_0x16aa89(0x209)]),'maxContextTokens':this['parseEnv'+_0x16aa89(0x2ff)](_0x37e5bb[_0x16aa89(0x28f)],this[_0x16aa89(0x27e)][_0x16aa89(0x31b)+_0x16aa89(0x2f1)]),'maxCacheSize':this[_0x16aa89(0x246)+'Int'](_0x37e5bb[_0x16aa89(0x2b7)],this[_0x16aa89(0x27e)][_0x16aa89(0x237)+_0x16aa89(0x267)]),'cacheExpirySeconds':this[_0x16aa89(0x246)+_0x16aa89(0x2ff)]('RAG_CACH'+'E_EXPIRY',this[_0x16aa89(0x27e)][_0x16aa89(0x1f6)+_0x16aa89(0x2c4)+'ds']),'enableCaching':this[_0x16aa89(0x246)+_0x16aa89(0x2c2)](_0x16aa89(0x2a0)+_0x16aa89(0x30f)+'NG',this[_0x16aa89(0x27e)][_0x16aa89(0x317)+_0x16aa89(0x27c)]),'enableReranking':this[_0x16aa89(0x246)+_0x16aa89(0x2c2)](_0x16aa89(0x2a0)+'LE_RERAN'+_0x16aa89(0x276),this['config'][_0x16aa89(0x1d8)+_0x16aa89(0x286)]),'enableHybridSearch':this[_0x16aa89(0x246)+_0x16aa89(0x2c2)](_0x16aa89(0x2a0)+'LE_HYBRI'+'D',this[_0x16aa89(0x27e)]['enableHy'+_0x16aa89(0x242)+'ch'])};this[_0x16aa89(0x27e)]={...this[_0x16aa89(0x27e)],..._0x5dc4cf},logger_1[_0x16aa89(0x278)][_0x16aa89(0x29c)](_0x37e5bb[_0x16aa89(0x316)]);}[_0xc02a2b(0x246)+_0xc02a2b(0x2ff)](_0x431809,_0x8a5c92){const _0x263bca=_0xc02a2b,_0x1c0edc=process[_0x263bca(0x1c4)][_0x431809];return _0x1c0edc?parseInt(_0x1c0edc,0xa):_0x8a5c92;}[_0xc02a2b(0x246)+_0xc02a2b(0x264)](_0x27df36,_0x25fc1d){const _0x23b1bf=_0xc02a2b,_0x44e1b8=process[_0x23b1bf(0x1c4)][_0x27df36];return _0x44e1b8?parseFloat(_0x44e1b8):_0x25fc1d;}['parseEnv'+'Bool'](_0x115ec9,_0xdd8405){const _0x2d6e8e=_0xc02a2b,_0x1da8df={'sMOFU':function(_0x134215,_0x5544dc){return _0x134215!==_0x5544dc;},'hiIze':'true'},_0x503b92=process['env'][_0x115ec9];return _0x1da8df[_0x2d6e8e(0x235)](_0x503b92,undefined)?_0x503b92===_0x1da8df['hiIze']:_0xdd8405;}[_0xc02a2b(0x29f)+_0xc02a2b(0x1f3)](_0x1529c4){const _0x2b18c0=_0xc02a2b;this[_0x2b18c0(0x27e)]={...this[_0x2b18c0(0x27e)],..._0x1529c4},logger_1[_0x2b18c0(0x278)][_0x2b18c0(0x29c)](_0x2b18c0(0x228)+_0x2b18c0(0x322)+'iguratio'+_0x2b18c0(0x1ce)+_0x2b18c0(0x1eb)+'cally');}[_0xc02a2b(0x2da)+'g'](){const _0x3876a1=_0xc02a2b;return{...this[_0x3876a1(0x27e)]};}async[_0xc02a2b(0x27d)](_0x519a02){const _0x5a7bbb=_0xc02a2b,_0x3d5713={'nNdbf':function(_0x1ed711,_0x252260){return _0x1ed711-_0x252260;},'JRJRO':_0x5a7bbb(0x228)+'er]\x20Retr'+_0x5a7bbb(0x1d3)+_0x5a7bbb(0x2f3)},_0x1d0d99=Date['now']();this[_0x5a7bbb(0x269)][_0x5a7bbb(0x2ca)+_0x5a7bbb(0x25c)]++;try{logger_1[_0x5a7bbb(0x278)][_0x5a7bbb(0x29c)](_0x5a7bbb(0x228)+_0x5a7bbb(0x216)+_0x5a7bbb(0x202)+_0x5a7bbb(0x204)+_0x519a02[_0x5a7bbb(0x1f2)][_0x5a7bbb(0x223)+'g'](0x0,0x32)+_0x5a7bbb(0x2b9));if(this[_0x5a7bbb(0x27e)][_0x5a7bbb(0x317)+_0x5a7bbb(0x27c)]){const _0x505e0b=this['getFromC'+_0x5a7bbb(0x2aa)](_0x519a02);if(_0x505e0b)return this[_0x5a7bbb(0x269)][_0x5a7bbb(0x2b5)+'s']++,logger_1[_0x5a7bbb(0x278)]['info'](_0x5a7bbb(0x228)+_0x5a7bbb(0x1cf)+_0x5a7bbb(0x1ee)),{..._0x505e0b,'cached':!![]};this[_0x5a7bbb(0x269)][_0x5a7bbb(0x28b)+_0x5a7bbb(0x1be)]++;}await this[_0x5a7bbb(0x1f4)+_0x5a7bbb(0x1c1)+'ss'](_0x519a02[_0x5a7bbb(0x2cd)],_0x519a02[_0x5a7bbb(0x272)+'Id']);const _0x739221=this[_0x5a7bbb(0x300)+_0x5a7bbb(0x288)+_0x5a7bbb(0x262)](_0x519a02[_0x5a7bbb(0x1f2)],_0x519a02[_0x5a7bbb(0x23f)+'tionHist'+_0x5a7bbb(0x2b3)]),_0x4c55a0=await this['embeddin'+_0x5a7bbb(0x218)][_0x5a7bbb(0x2e4)+_0x5a7bbb(0x310)+'g']({'text':_0x739221}),_0x53471a=_0x4c55a0['vector'];let _0x2cbb13=await this['performV'+_0x5a7bbb(0x312)+_0x5a7bbb(0x254)](_0x53471a,_0x519a02['userId'],_0x519a02['document'+'Id'],_0x519a02[_0x5a7bbb(0x2e2)]);_0x2cbb13=this[_0x5a7bbb(0x2ba)+_0x5a7bbb(0x260)](_0x2cbb13,_0x519a02[_0x5a7bbb(0x2f0)]);this[_0x5a7bbb(0x293)+'eHybridS'+_0x5a7bbb(0x1ba)](_0x519a02)&&(_0x2cbb13=await this[_0x5a7bbb(0x20a)+_0x5a7bbb(0x211)+'h'](_0x519a02['query'],_0x2cbb13,_0x519a02[_0x5a7bbb(0x2cd)],_0x519a02['document'+'Id']));this[_0x5a7bbb(0x293)+_0x5a7bbb(0x321)+'ng'](_0x519a02)&&(_0x2cbb13=await this[_0x5a7bbb(0x1e6)+_0x5a7bbb(0x1c7)](_0x519a02['query'],_0x2cbb13));const _0x4108c5=await this['formatCh'+'unks'](_0x2cbb13,_0x519a02[_0x5a7bbb(0x297)+_0x5a7bbb(0x243)]),_0x3092b6={'chunks':_0x4108c5,'totalFound':_0x2cbb13[_0x5a7bbb(0x1e0)],'query':_0x519a02['query'],'retrievalTime':_0x3d5713[_0x5a7bbb(0x1c8)](Date[_0x5a7bbb(0x212)](),_0x1d0d99),'method':this[_0x5a7bbb(0x2d8)+_0x5a7bbb(0x1e8)](_0x519a02),'cached':![]};return this[_0x5a7bbb(0x27e)]['enableCa'+'ching']&&this[_0x5a7bbb(0x2e8)+'he'](_0x519a02,_0x3092b6),this[_0x5a7bbb(0x269)][_0x5a7bbb(0x28a)+_0x5a7bbb(0x1fd)]['push'](_0x3092b6['retrieva'+_0x5a7bbb(0x1f8)]),logger_1[_0x5a7bbb(0x278)][_0x5a7bbb(0x248)](_0x5a7bbb(0x228)+_0x5a7bbb(0x29d)+_0x5a7bbb(0x23c)+_0x4108c5['length']+('\x20chunks\x20'+_0x5a7bbb(0x1f1))+_0x3092b6[_0x5a7bbb(0x28a)+_0x5a7bbb(0x1f8)]+'ms'),_0x3092b6;}catch(_0x3135a9){logger_1[_0x5a7bbb(0x278)]['error'](_0x3d5713[_0x5a7bbb(0x311)],_0x3135a9);throw _0x3135a9;}}async['performV'+_0xc02a2b(0x312)+_0xc02a2b(0x254)](_0x5eb4aa,_0x58d169,_0x1fdd8d,_0x569af3){const _0x31c72f=_0xc02a2b,_0x3e7d96={'vector':_0x5eb4aa,'topK':_0x569af3||this[_0x31c72f(0x27e)]['defaultT'+_0x31c72f(0x2c9)],'includeMetadata':!![],'includeVectors':![]};return await this[_0x31c72f(0x273)+_0x31c72f(0x221)][_0x31c72f(0x1f2)](_0x3e7d96,_0x58d169,_0x1fdd8d);}['filterBy'+_0xc02a2b(0x260)](_0x1132de,_0x55dbc5){const _0x2b166e=_0xc02a2b,_0x460186=_0x55dbc5??this[_0x2b166e(0x27e)][_0x2b166e(0x2ce)+_0x2b166e(0x209)];return _0x1132de[_0x2b166e(0x207)](_0x132c84=>_0x132c84[_0x2b166e(0x318)]>=_0x460186);}[_0xc02a2b(0x293)+'eHybridS'+'earch'](_0x7bb223){const _0xe853e=_0xc02a2b;return _0x7bb223[_0xe853e(0x2c1)+'arch']??this[_0xe853e(0x27e)][_0xe853e(0x24d)+'bridSear'+'ch'];}async[_0xc02a2b(0x20a)+_0xc02a2b(0x211)+'h'](_0x1a4489,_0xe38eaf,_0x5abb84,_0x237a73){const _0xd608ab=_0xc02a2b,_0x581035={'lBlHo':_0xd608ab(0x228)+_0xd608ab(0x322)+_0xd608ab(0x252)+_0xd608ab(0x1ce)+_0xd608ab(0x1eb)+_0xd608ab(0x275),'lQbnv':'[Retriev'+'er]\x20Appl'+_0xd608ab(0x2c7)+_0xd608ab(0x2df)+'ch...','OACEJ':function(_0x4b0f41,_0x2e01be){return _0x4b0f41===_0x2e01be;},'oYMUO':function(_0x3e7b67,_0xd61bae){return _0x3e7b67!==_0xd61bae;},'SUMKT':_0xd608ab(0x30b),'dsZOI':_0xd608ab(0x228)+'er]\x20Hybr'+_0xd608ab(0x2f8)+'h\x20failed'+_0xd608ab(0x320)+_0xd608ab(0x219)+'esults'};try{logger_1[_0xd608ab(0x278)][_0xd608ab(0x29c)](_0x581035[_0xd608ab(0x249)]);const _0x495616=this[_0xd608ab(0x22d)+_0xd608ab(0x26c)](_0x1a4489);if(_0x581035[_0xd608ab(0x208)](_0x495616[_0xd608ab(0x1e0)],0x0)){if(_0x581035[_0xd608ab(0x2bb)](_0xd608ab(0x265),_0x581035[_0xd608ab(0x20e)]))return logger_1[_0xd608ab(0x278)][_0xd608ab(0x25e)]('[Retriev'+'er]\x20No\x20k'+_0xd608ab(0x21a)+_0xd608ab(0x313)+_0xd608ab(0x225)+_0xd608ab(0x1fe)+'results\x20'+'only'),_0xe38eaf;else this[_0xd608ab(0x27e)]={...this[_0xd608ab(0x27e)],..._0x4c6fa4},_0x52db10[_0xd608ab(0x278)][_0xd608ab(0x29c)](_0x581035[_0xd608ab(0x302)]);}const _0x3aae20=await this[_0xd608ab(0x306)+'eywordSe'+_0xd608ab(0x1d7)](_0x495616,_0x5abb84,_0x237a73),_0x51f087=this[_0xd608ab(0x31c)+_0xd608ab(0x1ef)](_0xe38eaf,_0x3aae20);return logger_1[_0xd608ab(0x278)]['success'](_0xd608ab(0x228)+_0xd608ab(0x1e9)+_0xd608ab(0x2f8)+_0xd608ab(0x2e6)+_0x51f087[_0xd608ab(0x1e0)]+('\x20combine'+_0xd608ab(0x1d5)+'s')),_0x51f087;}catch(_0x4cb9f2){return logger_1[_0xd608ab(0x278)][_0xd608ab(0x25e)](_0x581035[_0xd608ab(0x280)],_0x4cb9f2),_0xe38eaf;}}[_0xc02a2b(0x22d)+_0xc02a2b(0x26c)](_0x24cef2){const _0x36502e=_0xc02a2b;return _0x24cef2[_0x36502e(0x2fe)+_0x36502e(0x2dc)]()['replace'](/[^\w\s]/g,'')[_0x36502e(0x2f5)](/\s+/)[_0x36502e(0x207)](_0x49292f=>_0x49292f[_0x36502e(0x1e0)]>0x2&&!this[_0x36502e(0x245)+'DS'][_0x36502e(0x2ae)](_0x49292f))[_0x36502e(0x1dc)](0x0,0xa);}async[_0xc02a2b(0x306)+'eywordSe'+_0xc02a2b(0x1d7)](_0x3da141,_0x122230,_0x36ee5e){const _0x2ec03a=_0xc02a2b,_0x2a14b4={'aCZMT':function(_0x39bd69,_0x6c6580){return _0x39bd69>_0x6c6580;},'IAZfw':'uYUSr','zIhJh':'desc','Peyml':_0x2ec03a(0x228)+_0x2ec03a(0x2a7)+_0x2ec03a(0x210)+_0x2ec03a(0x20c)+'d'};try{if(_0x2a14b4[_0x2ec03a(0x2b2)]!==_0x2a14b4[_0x2ec03a(0x2b2)]){const _0x1dc1d7={'IkBhF':function(_0x3409c9,_0x2f86e3){const _0x18ad56=_0x2ec03a;return _0x2a14b4[_0x18ad56(0x241)](_0x3409c9,_0x2f86e3);},'PjVpL':function(_0x93a098,_0x1ee4d8){return _0x93a098===_0x1ee4d8;},'cVCDS':function(_0x437592,_0x5588bf){return _0x437592-_0x5588bf;},'rWCTY':function(_0xa643d8,_0x12b823){return _0xa643d8/_0x12b823;},'NxOYH':function(_0x14f111,_0x90df74){return _0x14f111+_0x90df74;},'HZoPD':function(_0x3a845e,_0x51e04b){return _0x3a845e*_0x51e04b;}};try{_0x372125[_0x2ec03a(0x278)]['info'](_0x2ec03a(0x228)+_0x2ec03a(0x2f7)+_0x2ec03a(0x1e1)+_0x2ec03a(0x1e2)+'..');const _0x1ebece=_0x317d4b[_0x2ec03a(0x2fe)+_0x2ec03a(0x2dc)](),_0x3588a0=new _0x126d97(this['extractK'+_0x2ec03a(0x26c)](_0xd16804));return _0x594aef['map'](_0x33184d=>{const _0x2fcfae=_0x2ec03a,_0x24b930=_0x33184d[_0x2fcfae(0x1e5)]?.['text']?.[_0x2fcfae(0x2fe)+_0x2fcfae(0x2dc)]()||'',_0x43f9f6=this[_0x2fcfae(0x22d)+'eywords'](_0x24b930),_0x2e27e2=_0x43f9f6[_0x2fcfae(0x207)](_0x2451f6=>_0x3588a0[_0x2fcfae(0x2ae)](_0x2451f6))[_0x2fcfae(0x1e0)],_0x25cd5e=_0x1dc1d7[_0x2fcfae(0x2ac)](_0x3588a0[_0x2fcfae(0x2c8)],0x0)?_0x2e27e2/_0x3588a0['size']:0x0,_0x2f9b03=_0x24b930[_0x2fcfae(0x24b)](_0x1ebece),_0xa8d618=_0x1dc1d7[_0x2fcfae(0x21d)](_0x2f9b03,-0x1)?0x0:_0x36d848[_0x2fcfae(0x289)](0x0,_0x1dc1d7[_0x2fcfae(0x291)](0x1,_0x1dc1d7[_0x2fcfae(0x2af)](_0x2f9b03,_0x24b930['length']))),_0xd8ed2=this[_0x2fcfae(0x27e)]['rerankWe'+'ight'],_0x18ba67=_0x1dc1d7['NxOYH'](_0x1dc1d7['HZoPD'](_0x33184d[_0x2fcfae(0x318)],_0xd8ed2[_0x2fcfae(0x271)+_0x2fcfae(0x221)])+_0x1dc1d7[_0x2fcfae(0x2a1)](_0x25cd5e,_0xd8ed2['keywordO'+_0x2fcfae(0x1d0)]),_0xa8d618*_0xd8ed2[_0x2fcfae(0x251)+_0x2fcfae(0x260)]);return{..._0x33184d,'score':_0x4648fd[_0x2fcfae(0x1df)](_0x18ba67,0x1)};})[_0x2ec03a(0x23e)]((_0x143e7d,_0xe1e36d)=>_0xe1e36d[_0x2ec03a(0x318)]-_0x143e7d[_0x2ec03a(0x318)]);}catch(_0x5eeb34){return _0x302634[_0x2ec03a(0x278)][_0x2ec03a(0x25e)](_0x2ec03a(0x228)+_0x2ec03a(0x25b)+_0x2ec03a(0x296)+'ailed,\x20u'+_0x2ec03a(0x284)+_0x2ec03a(0x22a)+_0x2ec03a(0x261),_0x5eeb34),_0x3590e4;}}else{const _0x140524={'userId':_0x122230,'OR':_0x3da141[_0x2ec03a(0x1cc)](_0x34b8b8=>({'text':{'contains':_0x34b8b8,'mode':'insensit'+'ive'}}))};_0x36ee5e&&(_0x140524[_0x2ec03a(0x272)+'Id']=_0x36ee5e);const _0x29524a=await prisma[_0x2ec03a(0x27b)+_0x2ec03a(0x229)]['findMany']({'where':_0x140524,'take':0xa,'orderBy':{'createdAt':_0x2a14b4[_0x2ec03a(0x1c5)]}});return _0x29524a[_0x2ec03a(0x1cc)](_0x57e7e0=>({'id':_0x57e7e0['id'],'score':0.5,'metadata':_0x57e7e0[_0x2ec03a(0x1e5)]}));}}catch(_0x3b3a49){return logger_1[_0x2ec03a(0x278)][_0x2ec03a(0x1fa)](_0x2a14b4['Peyml'],_0x3b3a49),[];}}['mergeRes'+_0xc02a2b(0x1ef)](_0x3144d8,_0x15547c){const _0x338095=_0xc02a2b,_0x3cb99d={'umulY':_0x338095(0x239)},_0x4ef90b=new Map();for(const _0x523025 of _0x3144d8){_0x3cb99d[_0x338095(0x2cb)]!==_0x338095(0x239)?(_0x4b561b=_0xae7011[_0x338095(0x21c)+'unt'],_0x1697f0=_0x5b2ea7):_0x4ef90b['set'](_0x523025['id'],_0x523025);}for(const _0x5c49a3 of _0x15547c){const _0xb0851a=_0x4ef90b['get'](_0x5c49a3['id']);_0xb0851a?_0xb0851a[_0x338095(0x318)]=Math['min'](_0xb0851a[_0x338095(0x318)]+0.15,0x1):_0x4ef90b[_0x338095(0x295)](_0x5c49a3['id'],_0x5c49a3);}return Array[_0x338095(0x2b4)](_0x4ef90b[_0x338095(0x23a)]())[_0x338095(0x23e)]((_0x50a363,_0x2989cc)=>_0x2989cc[_0x338095(0x318)]-_0x50a363[_0x338095(0x318)]);}[_0xc02a2b(0x293)+_0xc02a2b(0x321)+'ng'](_0x1e77a5){const _0x128ef0=_0xc02a2b;return _0x1e77a5[_0x128ef0(0x323)]??this[_0x128ef0(0x27e)][_0x128ef0(0x1d8)+_0x128ef0(0x286)];}async[_0xc02a2b(0x1e6)+'anking'](_0x4e972c,_0x3097aa){const _0x5cc776=_0xc02a2b,_0x22ff6a={'ecMoj':function(_0x2b2e83,_0x29b8a2){return _0x2b2e83>_0x29b8a2;},'blzzC':function(_0x183ef6,_0x35d219){return _0x183ef6/_0x35d219;},'zPAri':function(_0x2c7abe,_0x167204){return _0x2c7abe*_0x167204;},'natSk':function(_0x194c08,_0x4be67a){return _0x194c08===_0x4be67a;},'GOJrA':_0x5cc776(0x2c3),'hYPPO':'[Retriev'+'er]\x20Appl'+'ying\x20re-'+_0x5cc776(0x1e2)+'..','WGuSs':_0x5cc776(0x1c6)};try{if(_0x22ff6a[_0x5cc776(0x29b)](_0x22ff6a[_0x5cc776(0x28d)],_0x5cc776(0x257)))return this[_0x5cc776(0x1c2)][_0x5cc776(0x2ed)](_0x2916de),null;else{logger_1[_0x5cc776(0x278)][_0x5cc776(0x29c)](_0x22ff6a[_0x5cc776(0x2c5)]);const _0x4a6a66=_0x4e972c[_0x5cc776(0x2fe)+_0x5cc776(0x2dc)](),_0x1245bf=new Set(this['extractK'+'eywords'](_0x4e972c));return _0x3097aa[_0x5cc776(0x1cc)](_0x4c3c35=>{const _0x3577bf=_0x5cc776,_0x3f6e07=_0x4c3c35[_0x3577bf(0x1e5)]?.['text']?.[_0x3577bf(0x2fe)+_0x3577bf(0x2dc)]()||'',_0x45e40a=this[_0x3577bf(0x22d)+'eywords'](_0x3f6e07),_0x1939af=_0x45e40a[_0x3577bf(0x207)](_0x59fac4=>_0x1245bf[_0x3577bf(0x2ae)](_0x59fac4))['length'],_0x45a321=_0x22ff6a[_0x3577bf(0x314)](_0x1245bf[_0x3577bf(0x2c8)],0x0)?_0x22ff6a[_0x3577bf(0x1cb)](_0x1939af,_0x1245bf[_0x3577bf(0x2c8)]):0x0,_0x5a2169=_0x3f6e07[_0x3577bf(0x24b)](_0x4a6a66),_0x14b2d0=_0x5a2169===-0x1?0x0:Math['max'](0x0,0x1-_0x22ff6a['blzzC'](_0x5a2169,_0x3f6e07[_0x3577bf(0x1e0)])),_0x49c7db=this[_0x3577bf(0x27e)][_0x3577bf(0x2c6)+_0x3577bf(0x247)],_0x2001fb=_0x22ff6a[_0x3577bf(0x1e7)](_0x4c3c35[_0x3577bf(0x318)],_0x49c7db[_0x3577bf(0x271)+_0x3577bf(0x221)])+_0x45a321*_0x49c7db[_0x3577bf(0x287)+_0x3577bf(0x1d0)]+_0x22ff6a[_0x3577bf(0x1e7)](_0x14b2d0,_0x49c7db[_0x3577bf(0x251)+_0x3577bf(0x260)]);return{..._0x4c3c35,'score':Math[_0x3577bf(0x1df)](_0x2001fb,0x1)};})[_0x5cc776(0x23e)]((_0x429b54,_0x58afd8)=>_0x58afd8[_0x5cc776(0x318)]-_0x429b54[_0x5cc776(0x318)]);}}catch(_0x5b7abb){if(_0x22ff6a[_0x5cc776(0x29b)](_0x22ff6a[_0x5cc776(0x1da)],_0x22ff6a[_0x5cc776(0x1da)]))return logger_1[_0x5cc776(0x278)]['warn'](_0x5cc776(0x228)+'er]\x20Re-r'+_0x5cc776(0x296)+_0x5cc776(0x30c)+_0x5cc776(0x284)+_0x5cc776(0x22a)+'der',_0x5b7abb),_0x3097aa;else{const _0x2cfca0=_0x1cd492[_0x5cc776(0x1c4)][_0xffbc48];return _0x2cfca0?_0x53c744(_0x2cfca0):_0x5007cf;}}}[_0xc02a2b(0x300)+_0xc02a2b(0x288)+_0xc02a2b(0x262)](_0x1d5874,_0x563b7a){const _0x94864d=_0xc02a2b,_0x25769b={'uKNzO':_0x94864d(0x228)+_0x94864d(0x1e9)+_0x94864d(0x2f8)+'h\x20failed'+_0x94864d(0x320)+_0x94864d(0x219)+_0x94864d(0x250),'MQDiC':function(_0x365cf6,_0x430e86){return _0x365cf6===_0x430e86;},'oCAbn':function(_0xc621d3,_0x24535a){return _0xc621d3!==_0x24535a;}};if(!_0x563b7a||_0x25769b[_0x94864d(0x203)](_0x563b7a[_0x94864d(0x1e0)],0x0))return _0x25769b['oCAbn'](_0x94864d(0x2d7),_0x94864d(0x2d7))?(_0x752312['logger'][_0x94864d(0x25e)](_0x25769b[_0x94864d(0x232)],_0x580218),_0xfcf5c3):_0x1d5874;const _0x8ac5da=_0x563b7a[_0x94864d(0x1dc)](-0x3),_0x5696c3=_0x8ac5da['map'](_0x5c1c13=>_0x5c1c13[_0x94864d(0x224)])[_0x94864d(0x207)](_0x2a3bf6=>_0x2a3bf6[_0x94864d(0x1e0)]<0xc8);return[..._0x5696c3,_0x1d5874][_0x94864d(0x21b)]('\x20');}async['formatCh'+_0xc02a2b(0x1ec)](_0x38ca86,_0x5bdaa9=!![]){const _0x5dad4c=_0xc02a2b;return _0x38ca86[_0x5dad4c(0x1cc)](_0x4d4eff=>({'id':_0x4d4eff['id'],'content':_0x4d4eff[_0x5dad4c(0x1e5)]?.[_0x5dad4c(0x231)]||'','score':_0x4d4eff[_0x5dad4c(0x318)],'metadata':_0x5bdaa9?this['extractM'+_0x5dad4c(0x243)](_0x4d4eff[_0x5dad4c(0x1e5)]):{},'rerankedScore':_0x4d4eff[_0x5dad4c(0x318)]}));}[_0xc02a2b(0x309)+_0xc02a2b(0x243)](_0x2d570c){const _0x26ef07=_0xc02a2b;return{'documentId':_0x2d570c?.[_0x26ef07(0x272)+'Id']||'','filename':_0x2d570c?.[_0x26ef07(0x24e)]||'unknown','chunkIndex':_0x2d570c?.[_0x26ef07(0x2d0)+'ex']||0x0,'pageNumber':_0x2d570c?.[_0x26ef07(0x1ed)+'er'],'uploadedAt':_0x2d570c?.[_0x26ef07(0x274)+'At']||new Date()['toISOStr'+_0x26ef07(0x1f7)]()};}['buildCon'+_0xc02a2b(0x25f)+'ow'](_0x150000){const _0x2b9a20=_0xc02a2b,_0x30abd5={'RcJwd':function(_0x266b1d,_0x19e2bb){return _0x266b1d+_0x19e2bb;}};let _0xc39397='',_0x59d21d=0x0;const _0x2b90d0=[];for(const _0x5612b5 of _0x150000){const _0x224ad7=this[_0x2b9a20(0x22f)+_0x2b9a20(0x2e5)+_0x2b9a20(0x1e4)](_0x5612b5),_0x334c89=this[_0x2b9a20(0x26a)+'Tokens'](_0x224ad7);if(_0x30abd5['RcJwd'](_0x59d21d,_0x334c89)>this['config']['maxConte'+_0x2b9a20(0x2f1)]){logger_1['logger'][_0x2b9a20(0x25e)](_0x2b9a20(0x228)+_0x2b9a20(0x307)+'ext\x20limi'+'t\x20reache'+'d\x20at\x20'+_0x59d21d+_0x2b9a20(0x1c0));break;}_0xc39397+=_0x224ad7,_0x59d21d+=_0x334c89,_0x2b90d0[_0x2b9a20(0x1bb)]({'filename':_0x5612b5['metadata'][_0x2b9a20(0x24e)],'chunkIndex':_0x5612b5[_0x2b9a20(0x1e5)][_0x2b9a20(0x2d0)+'ex'],'pageNumber':_0x5612b5['metadata'][_0x2b9a20(0x1ed)+'er'],'documentId':_0x5612b5['metadata'][_0x2b9a20(0x272)+'Id']});}return{'content':_0xc39397,'tokenCount':_0x59d21d,'chunkCount':_0x2b90d0[_0x2b9a20(0x1e0)],'sources':_0x2b90d0};}[_0xc02a2b(0x22f)+'unkForCo'+_0xc02a2b(0x1e4)](_0xff9e8c){const _0x340bdf=_0xc02a2b;return _0x340bdf(0x1de)+'e:\x20'+_0xff9e8c['metadata']['filename']+_0x340bdf(0x1f9)+_0xff9e8c['metadata']['chunkInd'+'ex']+(_0xff9e8c[_0x340bdf(0x1e5)]['pageNumb'+'er']?_0x340bdf(0x200)+_0xff9e8c[_0x340bdf(0x1e5)]['pageNumb'+'er']:'')+']\x0a'+_0xff9e8c[_0x340bdf(0x224)];}[_0xc02a2b(0x26a)+_0xc02a2b(0x227)](_0x30ea02){const _0x439b7a=_0xc02a2b;return Math[_0x439b7a(0x26e)](_0x30ea02[_0x439b7a(0x1e0)]/0x4);}[_0xc02a2b(0x240)+_0xc02a2b(0x233)](_0x1cc26d){const _0x545ebf=_0xc02a2b,_0x35a89d={'dPIgq':'all'},_0xb123a9=[_0x1cc26d[_0x545ebf(0x2cd)],_0x1cc26d[_0x545ebf(0x272)+'Id']||_0x35a89d[_0x545ebf(0x2de)],_0x1cc26d[_0x545ebf(0x1f2)],_0x1cc26d['topK']||this[_0x545ebf(0x27e)]['defaultT'+'opK']];return _0xb123a9[_0x545ebf(0x21b)]('::');}[_0xc02a2b(0x305)+_0xc02a2b(0x2aa)](_0x1cb1d4){const _0x2b5466=_0xc02a2b,_0xba9973={'aBVzi':function(_0x3c49a1,_0x4a8be8){return _0x3c49a1/_0x4a8be8;},'wosGT':function(_0x36b5f8,_0x3c0319){return _0x36b5f8>_0x3c0319;}},_0x3e0632=this[_0x2b5466(0x240)+_0x2b5466(0x233)](_0x1cb1d4),_0x41f9a2=this[_0x2b5466(0x1c2)]['get'](_0x3e0632);if(!_0x41f9a2)return null;const _0x2a5057=_0xba9973['aBVzi'](Date[_0x2b5466(0x212)]()-_0x41f9a2['timestam'+'p'],0x3e8);if(_0xba9973[_0x2b5466(0x2d2)](_0x2a5057,this['config'][_0x2b5466(0x1f6)+_0x2b5466(0x2c4)+'ds']))return this[_0x2b5466(0x1c2)]['delete'](_0x3e0632),null;return _0x41f9a2[_0x2b5466(0x21c)+_0x2b5466(0x31a)]++,_0x41f9a2[_0x2b5466(0x2bd)];}[_0xc02a2b(0x2e8)+'he'](_0x3e76ff,_0x22f01e){const _0x4652f2=_0xc02a2b,_0x3787c0=this[_0x4652f2(0x240)+_0x4652f2(0x233)](_0x3e76ff);this[_0x4652f2(0x1c2)][_0x4652f2(0x2c8)]>=this['config']['maxCache'+_0x4652f2(0x267)]&&this[_0x4652f2(0x2e1)+_0x4652f2(0x20f)+_0x4652f2(0x30e)](),this[_0x4652f2(0x1c2)]['set'](_0x3787c0,{'result':_0x22f01e,'timestamp':Date[_0x4652f2(0x212)](),'accessCount':0x1});}[_0xc02a2b(0x2e1)+_0xc02a2b(0x20f)+_0xc02a2b(0x30e)](){const _0x1a42cb=_0xc02a2b,_0x156f13={'VfOji':function(_0x482434,_0x962397){return _0x482434<_0x962397;}};let _0x5392a0=null,_0xc5543=Infinity;for(const [_0x148243,_0x34d9e2]of this[_0x1a42cb(0x1c2)][_0x1a42cb(0x1d4)]()){_0x156f13['VfOji'](_0x34d9e2[_0x1a42cb(0x21c)+_0x1a42cb(0x31a)],_0xc5543)&&(_0xc5543=_0x34d9e2[_0x1a42cb(0x21c)+_0x1a42cb(0x31a)],_0x5392a0=_0x148243);}_0x5392a0&&this[_0x1a42cb(0x1c2)][_0x1a42cb(0x2ed)](_0x5392a0);}[_0xc02a2b(0x298)+_0xc02a2b(0x24a)+'p'](){const _0x42f437={'TYtva':function(_0x6bbdf9,_0x1982d6){return _0x6bbdf9>_0x1982d6;}};setInterval(()=>{const _0x3162f0=_0x50aa,_0x57c253=Date[_0x3162f0(0x212)]();for(const [_0x38d10b,_0x20cbaa]of this['cache']['entries']()){const _0x29319b=(_0x57c253-_0x20cbaa[_0x3162f0(0x1f5)+'p'])/0x3e8;_0x42f437[_0x3162f0(0x1fb)](_0x29319b,this[_0x3162f0(0x27e)][_0x3162f0(0x1f6)+'irySecon'+'ds'])&&this[_0x3162f0(0x1c2)][_0x3162f0(0x2ed)](_0x38d10b);}},0xea60);}['clearCac'+'he'](){const _0x5256a5=_0xc02a2b;this[_0x5256a5(0x1c2)][_0x5256a5(0x324)](),logger_1[_0x5256a5(0x278)]['info'](_0x5256a5(0x228)+'er]\x20Cach'+_0x5256a5(0x2f2)+'d');}async['validate'+_0xc02a2b(0x1c1)+'ss'](_0x2c874a,_0x15c029){const _0x3a6297=_0xc02a2b,_0x4e67ca={'upWQl':_0x3a6297(0x2f9)+_0x3a6297(0x29a)+_0x3a6297(0x1ff)+_0x3a6297(0x2bf)+_0x3a6297(0x2a5)+_0x3a6297(0x30d)+'d','LwBsI':function(_0x2b6ea2,_0x30b359){return _0x2b6ea2===_0x30b359;},'RbdkD':_0x3a6297(0x20d),'HewKv':_0x3a6297(0x2f9)+_0x3a6297(0x266)};if(!_0x15c029)return;try{const _0x351e96=await prisma['document'][_0x3a6297(0x230)+'ue']({'where':{'id':_0x15c029},'select':{'userId':!![]}});if(!_0x351e96||_0x351e96['userId']!==_0x2c874a){logger_1[_0x3a6297(0x278)][_0x3a6297(0x1fa)](_0x3a6297(0x228)+_0x3a6297(0x2a9)+'ss\x20denie'+_0x3a6297(0x2e7)+'er\x20'+_0x2c874a+('\x20to\x20docu'+_0x3a6297(0x31f))+_0x15c029);throw new Error(_0x4e67ca[_0x3a6297(0x319)]);}}catch(_0x1036bf){if(_0x4e67ca[_0x3a6297(0x1ea)]('sAzGe',_0x4e67ca[_0x3a6297(0x27a)]))return _0x5c2ac1[_0x3a6297(0x278)][_0x3a6297(0x25e)]('[Retriev'+'er]\x20No\x20k'+_0x3a6297(0x21a)+_0x3a6297(0x313)+_0x3a6297(0x225)+'\x20vector\x20'+_0x3a6297(0x1d1)+_0x3a6297(0x2e3)),_0x2c197c;else{logger_1[_0x3a6297(0x278)][_0x3a6297(0x1fa)]('[Retriev'+'er]\x20Acce'+_0x3a6297(0x2c0)+_0x3a6297(0x29e)+_0x3a6297(0x2f3),_0x1036bf);throw new Error(_0x4e67ca['HewKv']);}}}async[_0xc02a2b(0x27d)+'FromMult'+_0xc02a2b(0x2fb)+_0xc02a2b(0x2dd)](_0x18adc0,_0x419050,_0x5e3e0d,_0x1f16a1=0x3){const _0x14b16f=_0xc02a2b,_0x9c5e38={'fUUuT':_0x14b16f(0x228)+_0x14b16f(0x205)+'i-docume'+'nt\x20retri'+_0x14b16f(0x1bc)+'led'},_0x1be2f8=Date[_0x14b16f(0x212)]();try{logger_1[_0x14b16f(0x278)][_0x14b16f(0x29c)]('[Retriev'+_0x14b16f(0x205)+_0x14b16f(0x30a)+_0x14b16f(0x23b)+_0x14b16f(0x2fc)+'m\x20'+_0x5e3e0d[_0x14b16f(0x1e0)]+(_0x14b16f(0x2ab)+'ts'));const _0x29343e=[],_0x13f66f=_0x5e3e0d['map'](_0x38b26a=>this['retrieve']({'query':_0x18adc0,'userId':_0x419050,'documentId':_0x38b26a,'topK':_0x1f16a1,'includeMetadata':!![]})),_0x4cb5c2=await Promise[_0x14b16f(0x2a6)](_0x13f66f);for(const _0x160f2f of _0x4cb5c2){_0x29343e[_0x14b16f(0x1bb)](..._0x160f2f[_0x14b16f(0x31d)]);}_0x29343e['sort']((_0x45ab9a,_0x1961bf)=>_0x1961bf[_0x14b16f(0x318)]-_0x45ab9a[_0x14b16f(0x318)]);const _0x1e85b2=_0x29343e['slice'](0x0,this[_0x14b16f(0x27e)][_0x14b16f(0x2d4)+_0x14b16f(0x2c9)]);return{'chunks':_0x1e85b2,'totalFound':_0x29343e['length'],'query':_0x18adc0,'retrievalTime':Date['now']()-_0x1be2f8,'method':_0x14b16f(0x26f),'cached':![]};}catch(_0x565a21){logger_1[_0x14b16f(0x278)]['error'](_0x9c5e38['fUUuT'],_0x565a21);throw _0x565a21;}}async['retrieve'+_0xc02a2b(0x22c)+_0xc02a2b(0x2b3)](_0x3c33a6,_0xa0356e,_0x306eb7,_0x971173){const _0x43dbc3=_0xc02a2b;return await this[_0x43dbc3(0x27d)]({'query':_0x3c33a6,'userId':_0xa0356e,'documentId':_0x971173,'conversationHistory':_0x306eb7,'topK':this[_0x43dbc3(0x27e)][_0x43dbc3(0x2d4)+_0x43dbc3(0x2c9)],'rerank':!![]});}[_0xc02a2b(0x2d8)+_0xc02a2b(0x1e8)](_0x167a0b){const _0xb9bef=_0xc02a2b;if(_0x167a0b[_0xb9bef(0x2c1)+'arch']||this[_0xb9bef(0x27e)][_0xb9bef(0x24d)+_0xb9bef(0x242)+'ch'])return _0xb9bef(0x1cd);return _0xb9bef(0x26f);}[_0xc02a2b(0x215)](){const _0xee5384=_0xc02a2b,_0x519ce4={'PbExo':function(_0xd4ba64,_0x1993d6){return _0xd4ba64>_0x1993d6;},'BLSRo':function(_0x44c936,_0x1039b5){return _0x44c936/_0x1039b5;}},_0x73b686=_0x519ce4[_0xee5384(0x315)](this[_0xee5384(0x269)][_0xee5384(0x28a)+'lTimes'][_0xee5384(0x1e0)],0x0)?_0x519ce4[_0xee5384(0x263)](this['stats'][_0xee5384(0x28a)+_0xee5384(0x1fd)][_0xee5384(0x290)]((_0x261980,_0x2916a2)=>_0x261980+_0x2916a2,0x0),this[_0xee5384(0x269)][_0xee5384(0x28a)+_0xee5384(0x1fd)]['length']):0x0;return{'totalRetrievals':this[_0xee5384(0x269)][_0xee5384(0x2ca)+'rievals'],'cacheHits':this[_0xee5384(0x269)][_0xee5384(0x2b5)+'s'],'cacheMisses':this[_0xee5384(0x269)]['cacheMis'+_0xee5384(0x1be)],'averageRetrievalTime':Math[_0xee5384(0x1f0)](_0x73b686),'cacheSize':this['cache']['size'],'config':this[_0xee5384(0x2da)+'g']()};}async[_0xc02a2b(0x2d9)+'eck'](){const _0x3da32d=_0xc02a2b,_0x34f32d={'bWVgX':function(_0x3ef8f0,_0x1441a4){return _0x3ef8f0*_0x1441a4;},'dyeVI':function(_0x490f31,_0x5ca05d){return _0x490f31/_0x5ca05d;},'xssXk':_0x3da32d(0x234),'qWvsc':'unhealth'+'y','nUvVZ':function(_0x2cb920,_0xa06de2){return _0x2cb920(_0xa06de2);}};try{const _0x2b490a=this[_0x3da32d(0x215)](),_0x41abb7=_0x2b490a[_0x3da32d(0x2ca)+_0x3da32d(0x25c)]>0x0?_0x34f32d[_0x3da32d(0x236)](_0x34f32d['dyeVI'](_0x2b490a['cacheHit'+'s'],_0x2b490a[_0x3da32d(0x2ca)+_0x3da32d(0x25c)]),0x64):0x0;return{'status':_0x34f32d[_0x3da32d(0x26d)],'details':{'cacheSize':_0x2b490a[_0x3da32d(0x27f)+'e'],'cacheHitRate':_0x41abb7[_0x3da32d(0x25d)](0x2)+'%','averageRetrievalTime':_0x2b490a[_0x3da32d(0x2ec)+_0x3da32d(0x22e)+_0x3da32d(0x255)]+'ms','totalRetrievals':_0x2b490a[_0x3da32d(0x2ca)+_0x3da32d(0x25c)]}};}catch(_0x3c622a){return{'status':_0x34f32d[_0x3da32d(0x2e9)],'details':{'error':_0x34f32d[_0x3da32d(0x24c)](String,_0x3c622a)}};}}[_0xc02a2b(0x2b8)+'ts'](){const _0x133404=_0xc02a2b;this[_0x133404(0x269)]={'totalRetrievals':0x0,'cacheHits':0x0,'cacheMisses':0x0,'retrievalTimes':[]},logger_1[_0x133404(0x278)][_0x133404(0x29c)](_0x133404(0x228)+_0x133404(0x226)+_0x133404(0x299)+'eset');}}exports['Retrieve'+_0xc02a2b(0x2cf)]=RetrieverService,exports[_0xc02a2b(0x1b7)]=RetrieverService[_0xc02a2b(0x28e)+_0xc02a2b(0x23d)]();